function ReplaceWith(e){var r=this.parentNode,t=arguments.length,o=+(r&&"object"==typeof e);if(r){for(;t-- >o;)r&&"object"!=typeof arguments[t]&&(arguments[t]=document.createTextNode(arguments[t])),r||!arguments[t].parentNode?r.insertBefore(this.previousSibling,arguments[t]):arguments[t].parentNode.removeChild(arguments[t]);o&&r.replaceChild(this,e)}}[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("after")||Object.defineProperty(e,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),r=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;r.appendChild(t?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(r,this.nextSibling)}})}),Element.prototype.replaceWith||(Element.prototype.replaceWith=ReplaceWith),CharacterData.prototype.replaceWith||(CharacterData.prototype.replaceWith=ReplaceWith),DocumentType.prototype.replaceWith||(DocumentType.prototype.replaceWith=ReplaceWith),String.prototype.startsWith||(String.prototype.startsWith=function(e,r){return r=r||0,this.indexOf(e,r)===r}),String.prototype.endsWith||(String.prototype.endsWith=function(e,r){return(void 0===r||r>this.length)&&(r=this.length),this.substring(r-e.length,r)===e});let _Lyte={version:"3.7.0-BETA1",$:{consoleTime:[]},registeredMixins:{},registeredServices:{},requiredServices:{},toBeInjectedServices:{},_registeredComponents:{},_keywords:{component:["init","didConnect","didDestroy","constructor","onError","actions","methods","data"],adapter:["namespace","actionNamespace","host","withCredentials","buildURL","methodForRequest","headersForRequest","reloadRecord","reloadRecord","reloadAll","processRequest","parseResponse","parseRequest","super"],serializer:["normalize","normalizeResponse","serialize","serializeKey","deserializeKey","extractMeta","payloadKey","serializeRecord","normalizeRecord","super"],route:["getDependencies","getResources","beforeModel","model","afterModel","redirect","renderTemplate","afterRender","beforeExit","didDestroy","queryParams","title","routeName","component","parent","currentModel","forceFetch","setTitle","setQueryParams","getQueryParams","setDynamicParam","getDynamicParam","removeFromCache","refresh","transitionTo","replaceWith","actions"],is:function(e,r){var t=["component","adapter","serializer","route"];r&&(t=[r]);for(var o=t.length,a=0;a<o;a++){var i=this[t[a]];if(i)if(-1!=i.indexOf(e))return!0}return!1}},Mixin:{},Service:{},debug:!1,performance:!1,toBeRegistered:[],browser:{},registeredCustomComponent:{},Globals:{}};window.isLyteWidgetParent?(_widgetLyte=_Lyte,_Lyte.isWidgetBuild=!0,window.__lyteConfig.isWidgetBuild=!0):Lyte=_Lyte;class IdleTaskScheduler{constructor(e){this.idleCallback=this.idleCallback.bind(this),this.timeout=50,this.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.tasks=new Map,this.idleCallbackRequested=!1,this.delayInit=!1,this.useRequestIdleCallback=!0,this.priorityQueue=[],this.processTime={},this.perf=!1,void 0!=e&&(void 0!==e.useRequestIdleCallback&&(this.useRequestIdleCallback=e.useRequestIdleCallback),void 0!==e.delayInit&&(this.delayInit=e.delayInit),void 0!==e.timeout&&(this.timeout=e.timeout),void 0!==e.priorityQueue&&(this.priorityQueue=e.priorityQueue),void 0!==e.perf&&(this.perf=e.perf))}isGenerator(e){return null!==e&&"object"==typeof e&&"function"==typeof e.next&&"function"==typeof e[Symbol.iterator]}init(e){1==this.delayInit&&(void 0!==e&&(void 0!==e.useRequestIdleCallback&&(this.useRequestIdleCallback=e.useRequestIdleCallback),void 0!==e.timeout&&(this.timeout=e.timeout),void 0!==e.perf&&(this.perf=e.perf)),this.delayInit=!1,this.tasksScheduler())}getUniqueKey(e){for(var r;void 0==r||this.tasks.has(r);)r=void 0,r=this.generateUniqueKey(e);return r}generateUniqueKey(e){let r="",t=this.chars.length;for(let o=0;o<e;o++)r+=this.chars.charAt(Math.floor(Math.random()*t));return r}enqueueTask(e,r,t){if(t||(t=this.getUniqueKey(6)),!this.tasks.has(t))return this.tasks.set(t,{handler:e,data:r}),this.tasksScheduler(),t;console.error("Task with id-"+t+" is alreaded queued for execution.")}deleteTask(e){if(e){var r=this.tasks.get(e);if(this.tasks.delete(e),this.priorityQueue.length){var t=this.priorityQueue.indexOf(e);-1!=t&&this.priorityQueue.splice(t,1)}return r}}getPriorityQObj(){var e,r,t=0;if(this.priorityQueue.length){for(var o=this.priorityQueue.length;t<o;){if(e=this.priorityQueue[t],this.tasks.has(e)){r=this.tasks.get(e);break}t++}if(r)return{id:e,obj:r,ind:t}}return!1}dequeueTask(e){if(e){var r=this.tasks.get(e);return this.tasks.delete(e),r}if(this.tasks.size||this.priorityQueue.length){var t,o,a,i,s=this.getPriorityQObj(),n=!1;if(!1!==s)e=s.id,a=s.obj,i=s.ind,n=!0;else{if(!this.tasks.size)return;e=(r=this.tasks.entries().next().value)[0],a=r[1]}if(this.currentTask={id:e,handler:a.handler},Lyte.extendEventListeners(this.currentTask),this.isGenerator(a.handler)){if(0!=(t=a.handler.next()).done)return this.currentTask.triggerEvent("done",e),n&&this.priorityQueue.splice(i,1),this.tasks.delete(e),this.dequeueTask();if("function"==typeof(o=t.value))return o}else this.currentTask.triggerEvent("done",e),n&&this.priorityQueue.splice(i,1),this.tasks.delete(e);return a}}tasksScheduler(){0==this.delayInit&&(this.tasks.size?0==this.idleCallbackRequested&&("requestIdleCallback"in window&&this.useRequestIdleCallback?(this.idleCallbackRequested=!0,requestIdleCallback(this.idleCallback)):this.requestIdleCallback(this.idleCallback)):"cancelIdleCallback"in window&&this.useRequestIdleCallback&&cancelIdleCallback(this.idleCallback))}idleCallback(e){for(var r,t=e.timeRemaining();t>0&&this.tasks.size;){if(r=this.dequeueTask(),this.perf)var o=performance.now();if("function"==typeof r&&r(),"object"==typeof r){var a=r.data||[];"function"==typeof r.handler&&r.handler(...a)}if(this.perf){var i=performance.now(),s=this.currentTask.id;this.processTime[s]=(this.processTime.hasOwnProperty(s)?this.processTime[s]:0)+(i-o)}t=e.timeRemaining()}this.idleCallbackRequested=!1,this.tasksScheduler()}requestIdleCallback(e){var r=this;setTimeout(function(){setTimeout(function(){var t=Date.now();e({timeRemaining:function(){var e=Date.now()-t;return e>r.timeout?0:r.timeout-e}})},1)},50)}}!function(e){var r=e.$.userAgent=window.userAgent=navigator.userAgent,t=new Map;if(r.match(/rv:11\.0/) && navigator.userAgent.match(/Trident/)&&(e.browser.ie=!0,window.action=function(){}),r.match("Edge")){var o=createElement("div");o.innerHTML="<template><div>c</div></template>",o.querySelector("template").childNodes.length?e.browser.ie=!0:e.browser.edge=!0,o.remove()}e.Globals.set=function(r,t){e.Component.set(e.__gl,r,t)},e.Globals.get=function(r){return e.Component._get(e.__gl,r)},Object.defineProperty(e.Service,"__Lyte__",{value:e}),Object.defineProperty(e.Mixin,"__Lyte__",{value:e}),Object.defineProperty(e.$,"__Lyte__",{value:e}),e.Mixin.__Lyte__.requiredMixins={},e.oldProxy="undefined"!=typeof $Lt&&$Lt.oldProxy?$Lt.oldProxy:void 0,e.$.assetsDiv=document.createElement("div"),e.$.assetsDiv.setAttribute("id","lyteAssetsDiv"),e.assetsDivContainer=document.head,e.$.widgetWrapper=document.createElement("shadow-wrapper"),e.$.widgetWrapper.attachShadow({mode:"open"}),e.$.widgetWrapper.setAttribute("id","widgetWrapperDiv"),e.domContentLoaded=function(e){"complete"===document.readyState||"interactive"===document.readyState?e():window.addEventListener("DOMContentLoaded",function(){e()})},e.createApplication=function(r,t){t.init&&t.init.apply(e)},e.registerErrorCodes=function(r){Object.assign(e.errorCodes,r)},e.establishObserverBindings=function(r,t,o,a){var i=this,s=a&&t?a._fldGrps.JsonPathWatch:i.constructor._deepWatchProperties;t&&(i=t);for(var n=0;n<r.length;n++){for(var d=r[n].properties,l={},c=!1,p={},f=0;f<d.length;f++){var y,u=!1;if("string"==typeof d[f]){if(-1!=d[f].search(/^\$\./g)){var v,h=d[f].match(/[^\$.][^\.]*/g)[0];-1!=h.search(/\[[0-9*]\]/g)&&(h=h.split(/\[[0-9*]\]/g)[0]),void 0==s[h]&&(s[h]=[]),void 0==p[h]&&(p[h]=[]);var m="^\\$\\."+h+"\\.?";m=new RegExp(m),v=d[f].replace(m,"$."),s[h].includes(v)||s[h].push(v),p[h].includes(v)||p[h].push(v),h+=".*",l.hasOwnProperty(h)?c=!0:(y=e.getProperty.call(this,h,t,o),l[h]=!0,c=!1)}else if(-1!==d[f].indexOf(".[]"))u=!0,y=e.getProperty.call(this,d[f].substring(0,d[f].indexOf(".[]")),t,o);else{if(-1!==d[f].indexOf(".*")){var $=d[f].split(".")[0];if(!!!(!t&&this.component.__data[$]&&this.component.__data[$].watch||t&&a&&a.fieldList&&a.fieldList[$]&&a.fieldList[$].watch))continue}y=e.getProperty.call(this,d[f],t,o)}c||(y._observers||Object.defineProperty(y,"_observers",{value:new Set,enumerable:!1,writable:!0,configurable:!0}),y._observers.add({callee:i,observer:r[n],isArrayObserver:u}))}else e.warn("ERR27",JSON.stringify(d[f]),r[n].fnName,this.tagName)}r[n].Jpath=p,l={}}},e.getProperty=function(e,r,t){let o=e.match(/([^[\].]+|\[\])/g),a=this;r?(a=t,t[o[0]]||(t[o[0]]={}),a=t[o[0]]):(a._properties[o[0]]||(a._properties[o[0]]={}),a=a._properties[o[0]]),Object.defineProperty(a,"_path",{enumerable:!1,value:o[0]});for(let e=1;e<o.length;e++)(o[e].startsWith("'")||o[e].startsWith('"'))&&(o[e]=o[e].substring(1,o[e].length-1)),a[o[e]]||(a[o[e]]={},Object.defineProperty(a[o[e]],"_path",{enumerable:!1,value:a._path+"."+o[e]})),a=a[o[e]];return a},e.getErrorMessage=function(r){var t=Array.from(arguments).slice(1);return e.errorCodes[r]?e.errorCodes[r].replace(/{(\d+)}/g,function(e,r){return t[r]}):r},e.error=function(){var r=arguments[0],t=r.stack;r=t?r:Error(e.getErrorMessage.apply(e,arguments)),e.onerror&&e.onerror.call(this,r,arguments[1]),e.triggerEvent("error",r,arguments[1]);var o=r.stack&&-1==r.stack.indexOf(r.message);t&&!o&&(r=JSON.parse(JSON.stringify(r,Object.getOwnPropertyNames(r)))),arguments[1]?console.error(r.stack?o?r:r.stack:r.message,arguments[1]):console.error(r.stack?o?r:r.stack:r.message)},e.warn=function(){var r=arguments[0];r=r.stack?JSON.parse(JSON.stringify(r,Object.getOwnPropertyNames(r))):Error(e.getErrorMessage.apply(e,arguments)),console.warn(r.stack?-1!=r.stack.indexOf(r.message)?r.stack.replace("Error: ",""):r:r.message)};var a={},i=Function.prototype;function s(e){return e.match(/\.[a-zA-Z]+(?=\?|$)/)}function s(e){return e.match(/\.[a-zA-Z]+(?=\?|$)/)}i.on||(i.on=function(){return e.warn("'.on()' method with the argument '"+arguments[0]+"' cannot be executed outside component scope."),{type:"callBack",value:"observer"===this.type?this.value:this,properties:arguments,observes:"observer"===this.type?this:void 0}}),i.observes||(i.observes=function(){return e.warn("'.observes()' method with the arguments '"+arguments[0]+"' cannot be executed outside component scope."),{type:"observer",value:this,properties:arguments,on:e._onObj,lyteOn:e._onObj}}),i.computed||(i.computed=function(){return e.warn("'.computed()' method with the arguments '"+arguments[0]+"' cannot be executed outside component scope."),{type:"computed",value:this,properties:arguments}}),e._onObj=function(){return{type:"callBack",value:"observer"===this.type?this.value:this,properties:arguments,observes:"observer"===this.type?this:void 0}},e._observesObj=function(){return{type:"observer",value:this,properties:arguments,on:e._onObj,lyteOn:e._onObj}},e._computedObj=function(){return{type:"computed",value:this,properties:arguments}},e._preRegister=function(){e._actualFnProtoOn=Function.prototype.on,e._actualFnProtoObserves=Function.prototype.observes,e._actualFnProtoComputed=Function.prototype.computed;let r=Function.prototype;r.on=r.lyteOn=e._onObj,r.observes=r.lyteObserves=e._observesObj,r.computed=r.lyteComputed=e._computedObj},e._postRegister=function(){let r=Function.prototype;r.on=e._actualFnProtoOn,r.observes=e._actualFnProtoObserves,r.computed=e._actualFnProtoComputed},Object.defineProperty(e.Mixin,"register",{get:function(){return e._preRegister(),e.registerMixinWrapper},enumerable:!0}),e.registerMixinWrapper=function(){try{e.registerMixin.apply(e,arguments),e._postRegister()}catch(r){e._postRegister()}},e.registerMixin=function(r,t){var o;if(e.registeredMixins[r]=t,o=a[r])for(var i in o)e.$.requiredMixins[i](t,o[i],i)},e.Mixin.get=function(r){return e.registeredMixins[r]},e.$.instantiateService=function(r,o){var a=e.registeredServices[r];if(1==a.singleton){if(t.has(r))return t.get(r);var i=new a(o);return t.set(r,i),i}return new a(o)},e.Service.register=function(r,t,o){if(e.registeredServices.hasOwnProperty(r))e.warn("Service -"+r+" is already registered");else{if(!e._keywords.is(r)){var a=t;o&&(a.singleton=o),e.registeredServices[r]=a;var i=e.requiredServices[r];return i&&i.size&&i.forEach(function(t){var o=a;t.isGlobal&&(o=e.__gS[t.key]=e.__gS[t.key]||e.$.instantiateService(r,t.data)),t.cB(o,t.key,t.name,r)}),a}e.warn("Service name-"+r+" should not be a keyword used in Lyte")}},e.Service.getInjected=function(r){if(e.__gS.hasOwnProperty(r))return e.__gS[r]},e.$.requiredServices=function(r,t,o,a,i,s,n){var d=e.requiredServices[t],l=d||(e.requiredServices[t]=new Map),c=e.$.genMapId(l);return l.set(c,{key:r,cB:o,type:a,name:i,serviceName:t,isGlobal:s,data:n}),t+"-"+c},e.$.lazyRegisterService=function(e,r){var t=r.scope,o=r.name,a=t[r.type][o];a&&(a[r.key]=e)},e.$.injectServices={},Object.defineProperty(e,"__gS",{value:{}}),e.injectServices=function(r){var t={};Array.isArray(r)||(r=[r]),r.forEach(function(r){if(r&&"object"==typeof r){var o=r.as,a=r.service,i=r.data;e._keywords.is(o)?e.warn("Service cannot be used in any keywords of Lyte."):e.toBeInjectedServices.hasOwnProperty(o)?e.warn("A service has already been injected in the key named, ",o):(e.toBeInjectedServices[o]=a,t[o]={service:a,data:i},e.registeredServices[a]&&(e.__gS[o]=e.$.instantiateService(a,i)))}else"string"==typeof r?e.toBeInjectedServices.hasOwnProperty(r)?e.warn("A service has already been injected in the key named, ",r):(e.toBeInjectedServices[r]=r,t[r]={service:r},e.registeredServices[r]&&(e.__gS[r]=e.$.instantiateService(r))):e.warn("Invalid data passed to injectServices",r)});var o=e.$.injectServices;for(var a in o)for(var i in t)o[a](i,t[i].service,a,e.__gS[i],void 0,t[i].data)},e.$.genMapId=function(e){for(var r=Math.floor(1e10*Math.random()+1);e.get(r);)r=Math.floor(1e10*Math.random()+1);return r.toString()},e.$.toRemoveFromRequiredServices=function(r){var t=r.split("-"),o=t[t.length-1],a=o.length,i=r.substr(0,r.length-(a+1)),s=e.requiredServices[i];s&&s.delete(o)},e.toBeUsedServices=function(r){var t={},o=r.services;return o&&o.forEach(function(o){if("string"==typeof o)t[o]=o;else if(o&&"object"==typeof o){var a=o.as,i=o.service;e._keywords.is(a,r.type)?e.warn("Service cannot be used in any keywords of Lyte."):t[a]=i}}),t},e.extendService=function(r){var t,o=e.toBeUsedServices(r);for(var a in o)if(t=o[a],r.isGlobal&&e.__gS.hasOwnProperty(a)||!r.isGlobal&&e.registeredServices.hasOwnProperty(t)){var i=r.ins;r.isGlobal?e.__gS[a]:e.$.instantiateService(t);Array.isArray(i)||(i=[r.ins]),i.forEach(function(o){o[a]=r.isGlobal?e.__gS[a]:e.$.instantiateService(t)})}else e.$.requiredServices(a,t,r.callback,r.type,r.name,r.isGlobal,r.data)},e.$.requiredMixins=function(e,r,t){var o=a[e]?a[e]:a[e]={};o[t]?o[t].push(r):o[t]=[r]},e.Mixin.exists=function(r){return!!e.registeredMixins[r]},e.log=function(r,t,o){e.debug&&(o?console.log("%c"+r,"color:"+o):console.log(r))},e.time=function(r){var t;e.performance&&(-1!=(t=e.$.consoleTime.indexOf(r))?(e.$.consoleTime.splice(t,1),console.timeEnd(r)):(e.$.consoleTime.push(r),console.time(r)))},e.isRecord=function(e){return!!(e&&e.$&&e.$.hasOwnProperty("isModified"))},e.isComponent=function(e){return!!(e&&e.$node&&e.__data)},e.$.reqFiles={},e.injectResources=function(r,t,o,a){var i=[],n=[];return t=t||function(){},o=o||function(){},new Promise(function(l,c){!function r(o,a){var i;o?(Array.isArray(o)||(o=[o]),o.length||a(),i=-o.length,o.forEach(function(o){"string"==typeof o?function(r,o,a){e.$.reqFiles[r]?e.$.reqFiles[r].push(a):(e.$.reqFiles[r]=[a],o&&"error"!=o.event.type?(-1!=e.removeFromCache.arr.indexOf(r)&&e.removeFromCache.arr.splice(e.removeFromCache.arr.indexOf(r),1),d.call(o.tag,r,o.event,!0),a()):function(r,o){var a,i=t.internal||{},n=s(r);if(i.file=r,null==n)return void e.error("Type of file is not specified in injectResources.");(a=document.createElement("link")).setAttribute("href",r),i.tag=a,".css"==n?a.setAttribute("as","style"):a.setAttribute("as","script");a.setAttribute("rel","preload"),a.onerror=a.onload=function(e){o.call(this,e),this.onerror=this.onload=void 0},e.triggerEvent("onBeforeInject",i),e.$.assetsDiv.appendChild(a)}(r,function(o){e.injectResources.respObj[r]=this,e.$.reqFiles[r].forEach(function(e){e()}),d.call(this,r,o),t.call(this,o)}))}(o,e.injectResources.availableTags[o],function(){n()}):Array.isArray(o)?new Promise(function(e){r(o,e)}).then(function(){n()}):(i--,new Promise(function(e){r(o.parent,e)}).then(function(){n()}),new Promise(function(e){r(o.child,e)}).then(function(){n()}))})):a();function n(){0==++i&&a()}function d(r,t,o){delete e.$.reqFiles[r],o||(e.injectResources.availableTags[r]&&(e.injectResources.availableTags[r].tag.remove(),delete e.injectResources.respObj[r]),e.injectResources.availableTags[r]={tag:this,event:t,type:t.type})}}(r,function(){a&&a.defer?(a.defer({injectJS:d,files:r,errorFiles:n}),l()):d(r,function(){o(i,n),n.length?c(i,n):l(i,n)})}.bind(this))});function d(r,t,o){var a;function l(){0==++a&&t(i,n)}o=o||[],r?(Array.isArray(r)||(r=[r]),r.length||t(i,n),a=-r.length,r.forEach(function(r){if("string"==typeof r){var t=s(r);!t||".js"!=t&&".css"!=t||-1!=o.indexOf(r)?l():(o.push(r),function(r,t){var o=e.injectResources.respObj[r];if(!o||e.injectResources.availableTags[r]&&"preload"!=e.injectResources.availableTags[r].tag.getAttribute("rel")){var a=e.injectResources.availableTags[r];"error"==a.type?n.push(a.event):i.push(a.event),t()}else{var d,l=s(r);".js"==l?((d=document.createElement("script")).setAttribute("type","text/javascript"),d.setAttribute("src",r)):".css"==l&&((d=document.createElement("link")).setAttribute("type","text/css"),d.setAttribute("rel","stylesheet"),d.setAttribute("href",r)),o.getAttributeNames().forEach(function(e){-1==["href","as","rel"].indexOf(e)&&d.setAttribute(e,o.getAttribute(e))}),d.onerror=d.onload=function(o){"error"==o.type?n.push(o):i.push(o),delete e.injectResources.respObj[r],e.injectResources.availableTags[r].tag.remove(),e.injectResources.availableTags[r]={tag:d,event:o,type:"error"==o.type?"error":"load"},t(),d.onerror=d.onload=void 0},e.$.assetsDiv.appendChild(d)}}(r,function(){l()}))}else Array.isArray(r)?d(r,function(){l()}):(a--,d(r.parent,function(){d(r.child,function(){l()}),l()}))})):t(i,n)}},e.injectResources.availableTags=[],e.injectResources.respObj=[],e.$.replaceOldInjectResource=function(){e.injectResources=function(r,t,o){var a=[],i=[];return t=t||function(){},o=o||function(){},new Promise(function(o){!function r(o,n){var d;o?(Array.isArray(o)||(o=[o]),o.length||n(),d=-o.length,o.forEach(function(o){"string"==typeof o?function(r,o,n){e.$.reqFiles[r]?e.$.reqFiles[r].push(n):(e.$.reqFiles[r]=[n],o&&"error"!=o.event.type?(-1!=e.removeFromCache.arr.indexOf(r)&&e.removeFromCache.arr.splice(e.removeFromCache.arr.indexOf(r),1),c.call(o.tag,o.event,!0),n()):function(r,o){var n=s(r);if(tag=document.createElement({".js":"script",".css":"link"}[n]),!n)return void e.error("Type of file is not specified in injectResources.");".css"==n?(tag.setAttribute("href",r),tag.setAttribute("type","text/css"),tag.setAttribute("rel","stylesheet")):tag.setAttribute("src",r);tag.onerror=tag.onload=function(e){"error"==e.type?i.push(e):a.push(e),o&&o.call(this,e)};var d=t.internal||{};d.file=r,d.tag=tag,e.triggerEvent("onBeforeInject",d),e.$.assetsDiv.appendChild(tag)}(r,function(o){e.$.reqFiles[r].forEach(function(e){e()}),c.call(this,o),t.call(this,o)}))}(o,e.injectResources.availableTags[o],function(){l()}):Array.isArray(o)?new Promise(function(e){r(o,e)}).then(function(){l()}):new Promise(function(e){r(o.parent,e)}).then(function(){new Promise(function(e){r(o.child,e)}).then(function(){l()})})})):n();function l(){0==++d&&n()}function c(r,t){var o=this.getAttribute("src")||this.getAttribute("href");delete e.$.reqFiles[o],t||(e.injectResources.availableTags[o]&&e.injectResources.availableTags[o].tag.remove(),this.onerror=this.onload=void 0,e.injectResources.availableTags[o]={tag:this,event:{type:r.type}})}}(r,o)}).then(function(){o(a,i)})},e.injectResources.availableTags=[],e.injectResources.respObj=[]},e.removeFromCache=function(r){e.removeFromCache.assign(r),e.removeFromCache.arr.length&&(e.removeFromCache.arr.forEach(function(r){e.injectResources.availableTags[r]&&(e.injectResources.availableTags[r].tag.remove(),delete e.injectResources.availableTags[r],delete e.injectResources.respObj[r])}),e.removeFromCache.arr=[])},e.removeFromCache.arr=[],e.removeFromCache.assign=function(r){r="*"==r?Object.keys(e.injectResources.availableTags):Array.isArray(r)?r:[r],e.removeFromCache.arr=e.removeFromCache.arr.concat(r)},e.$.prefetchSupport=!1;try{if(!e.browser.ie){var n=document.createElement("link");e.$.prefetchSupport=n.relList.supports("prefetch")&&n.relList.supports("preload")}}catch(e){}function d(){e.assetsDivContainer.appendChild(e.$.assetsDiv)}e.$.prefetchSupport||(console.log("Prefetch is not supported. Falling back to old implementation"),e.$.replaceOldInjectResource()),e.checkProperty=function(r,t,o,a,i,s,n,d,l){switch(r){case"type":if(e.Transform.hasOwnProperty(a)&&void 0!==t&&null!==t){var c=e.Transform[a],p=!0;if(Array.isArray(t)){if("array"!=e.Transform[a].extends)return{code:"ERR03",message:e.errorCodes.ERR03,expected:a};c.hasOwnProperty("items")&&(p=e.checkProperty("items",t,o,c.items))}else if("object"==typeof t&&"object"==e.Transform[a].extends&&c.hasOwnProperty("properties"))p=e.checkProperty("properties",t,o,c.properties);else if(e.Transform[a].extends!=typeof t)return{code:"ERR03",message:e.errorCodes.ERR03,expected:a};if(!0!==p)return p}else if(void 0!==t&&null!==t)if(Array.isArray(t)){if("array"!=a)return{code:"ERR03",message:e.errorCodes.ERR03,expected:a}}else if(a!=typeof t)return{code:"ERR03",message:e.errorCodes.ERR03,expected:a};break;case"mandatory":let i=a;if("object"==typeof a&&l&&1==a.skipValidationOnInit&&(i=!1),i&&(void 0==t||null==t||""===t))return{code:"ERR02",message:e.errorCodes.ERR02};break;case"maximum":if("number"==typeof t&&t>a)return{code:"ERR04",message:e.errorCodes.ERR04,expected:a};break;case"minimum":if("number"==typeof t&&t<a)return{code:"ERR05",message:e.errorCodes.ERR05,expected:a};break;case"maxLength":case"maxItems":if(t&&t.length>a)return{code:"ERR06",message:e.errorCodes.ERR06,expected:a};break;case"minLength":case"minItems":if(t&&t.length<a)return{code:"ERR07",message:e.errorCodes.ERR07,expected:a};break;case"pattern":if("string"==typeof t&&!new RegExp(a).test(t))return{code:"ERR08",message:e.errorCodes.ERR08,expected:a};break;case"uniqueItems":if(Array.isArray(t)&&a)for(var f=[],y=0;y<t.length;y++){var u=t[y];if(-1!=f.indexOf(u))return{code:"ERR09",message:e.errorCodes.ERR09};f.push(u)}break;case"constant":if(Array.isArray(t)){if(!($=t.length==a.length&&t.every(function(e,r){return e===a[r]})))return{code:"ERR10",message:e.errorCodes.ERR10,expected:a}}else if("object"==typeof t){if(!($=store.adapter.$.compareObjects(t,a)))return{code:"ERR10",message:e.errorCodes.ERR10,expected:a}}else if(t&&t!=a)return{code:"ERR10",message:e.errorCodes.ERR10,expected:a};break;case"items":if(Array.isArray(t))for(y=0;y<t.length;y++){a.any&&Array.isArray(a)||(a=[a]);for(var v=a.length,h=(p=!0,0);h<v;h++){c=a[h];for(var r in c){if(!0!==($=e.checkProperty(r,t[y],y,c[r],c))){!0===p&&($.path=$.path?y+"."+$.path:$.path,p=$);break}}}if(!0!==p)return p}break;case"properties":if("object"==typeof t&&!Array.isArray(t))for(var o in t)if(a.hasOwnProperty(o)){var m=a[o];m.any&&Array.isArray(m)||(m=[m]);for(v=m.length,p=!0,y=0;y<v;y++){c=m[y];for(var r in c){if(1!=($=e.checkProperty(r,t[o],o,c[r],c))){!0===p&&($.path=$.path?o+"."+$.path:o.toString(),p=$);break}}}if(!0!==p)return p}break;case"validation":var $;if(1!=($=e.customValidator[a].apply(s,[o,t,d])))return $;break;case"instanceof":if(!("object"!=typeof t||Array.isArray(t)||t instanceof a))return{code:"ERR30",message:e.errorCodes.ERR30,property:o,instanceof:a}}return!0},e.checkNestedProp=function(r,t,o,a,i,s,n,d,l){var c;if(e.Transform[o.type]&&((o=e.Transform[o.type]).type=o.extends),0!=t.length){if("array"==o.type)o.items&&!isNaN(t[0])&&"object"==typeof o.items&&(t=t.slice(1),e.checkNestedProp(r,t,o.items,a,i,s,n,d,l));else if("object"==o.type&&o.properties&&o.properties.hasOwnProperty(t[0])){var p=t[0];t=t.slice(1),e.checkNestedProp(r,t,o.properties[p],a,i,s,n,d,l)}}else if(o&&(o.properties||o.items)&&!d.hasOwnProperty("warn")){var f={__data:{}};o.properties?f.__data[s]=o.properties[s]:o.items&&a.index?f.__data[a.index]=o:f.__data[s]=o.items;var y=e.validate(i,s,n,f),u=a.attr?a.attr:a.key,v=a.path.split("."),h=void 0==a.index&&s?a.path+(""!=a.path?".":"")+s:void 0!=a.index?a.path+(""!=a.path?".":"")+a.index:a.path;if(y&&"object"==(void 0===y?"undefined":typeof y)&&y.code){y.value=n,y.path=""!=a.path?a.path:s,a.isRec&&l&&void 0==a.key&&""!=a.path&&(u=a.path.split(".")[0],v.shift(),v=1==v.length&&v[0]==s?[]:v),a.Error&&a.Error[u]?a.Error[u].code&&a.Error[u].nested?a.Error[u].nested:a.Error[u].nested={}:a.Error[u]={nested:{}},a.Error[u].code="ERR34",a.Error[u].message=e.errorCodes.ERR34,c=a.Error[u].nested,a._cmpErr[u]||(a._cmpErr[u]={}),a._cmpErr[u].code="ERR34",a._cmpErr[u].message=e.errorCodes.ERR34;var m=a._cmpErr[u].path?a._cmpErr[u].path:[];""!=a.path&&v.forEach(function(e){c=c&&!c[e]?c[e]={}:c[e]}),void 0!=a.index?c[a.index]=y:c[s]=y,m.includes(h)||m.push(h),a._cmpErr[u].path=m}else{a.isRec&&l&&void 0==a.key&&(u=a.path.split(".")[0],v.shift(),v=1==v.length&&v[0]==s?[s]:v),c=a.Error[u]&&a.Error[u].nested?a.Error[u].nested:void 0;var $=a._cmpErr[u]||void 0;if($&&$.path&&$.path.includes(h)){var g=$.path.indexOf(h);$.path.splice(g,1)}if(c){a.index;var b=!0;h.split(".").forEach(function(e){c[e]&&c[e].code?(delete c[e],b=!(!c||0!=Object.keys(c).length)):c=c[e]}),1==b&&a.Error[u]&&a._cmpErr[u]&&(delete a.Error[u],delete a._cmpErr[u])}}(d.value&&d.value.hasOwnProperty("code")&&y.code||!d.value)&&(d.value=y)}a.index&&delete a.index},e.types=["string","object","number","boolean","array"],e.attr=function(r,t){var o={};if(o.type=r,void 0==t&&(t={}),-1==e.types.indexOf(r)&&!e.Transform.hasOwnProperty(r))throw new Error("Not a valid field type - "+r);return Object.assign(o,t),o},window.prop=e.attr,e.defineRelation=function(e,r,t){var o={type:"relation",relType:r,relatedTo:e};return t&&(o.opts=t),o},e.belongsTo=function(e,r){return this.defineRelation(e,"belongsTo",r)},e.hasMany=function(e,r){return this.defineRelation(e,"hasMany",r)},e.Transform={},e.customValidator={},e.registerDataType=function(r,t){this.Transform.hasOwnProperty(r)?e.warn("Custom Field Type - "+r+" -  already exists."):void 0!=t.extends&&-1!=e.types.indexOf(t.extends)?this.Transform[r]=t:e.error("Not a valid field type - "+t.extends)},e.registerValidator=function(r,t){this.customValidator.hasOwnProperty(r)?e.warn("Custom Validator with name - "+r+" - already exists"):this.customValidator[r]=t},e.patterns={email:/^([A-Za-z0-9._%\-'+/]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,22})$/,url:/(^(ht|f)tp(s?):\/\/[0-9a-zA-Z][-.\w]*(:[0-9])*(\/?)([a-zA-Z0-9\-.?,:'/\\+=&amp;%$#_[\]@!()*;~]*)?$)/,ampm:/^(AM|PM|am|pm)$/,hour:/^(0?[0-9]|1[0-9]|2[0-4])$/,minute:/^(0?[0-9]|[1-5][0-9]|60)$/,boolean:/^(true|false|TRUE|FALSE)$/,alphaNumeric:/([a-zA-Z0-9])+/,alphabetsOnly:/([a-zA-Z])+/,numeric:/([0-9])+/,phoneNo:/^[0-9a-zA-Z+.()\-;\s]+$/},e.validate=function(r,t,o,a,i){var s=a.__data[t],n=!1,d=s?s.type:void 0,l=s;if(l){l.any&&Array.isArray(l)||(l=[l]);for(var c=l.length,p=!0,f=0;f<c;f++){var y=l[f];for(var u in y)!0!==(n=e.checkProperty(u,o,t,y[u],y,r,d,void 0,i))&&!0===p&&(p=n)}if(!0!==p)return p}return!1},e.registerPattern=function(e,r){this.patterns[e]=r},e.errorCodes={ERR01:"Primary key cannot be modified",ERR02:"Mandatory field cannot be empty",ERR03:"Type of value does not match the specified data type",ERR04:"Value is greater than the maximum value allowed",ERR05:"Value is less than the minimum value allowed",ERR06:"Length of string/array is greater than the maximum limit allowed",ERR07:"Length of string/array is less than the minimum limit allowed",ERR08:"String does not match the specified pattern",ERR09:"Values in array are not unique",ERR10:"Value is not equal to the specified constant",ERR11:"Model of related field is not defined",ERR12:"Model of backward relation is not defined",ERR13:"Record not found",ERR14:"Model does not match the related field model",ERR15:"Error in creating a record as a relation",ERR16:"Record with primary key already exists",ERR17:"Value cannot be changed because record has been deleted",ERR18:"Action not defined",ERR19:"Model not defined",ERR20:"Key not specified",ERR21:"'belongsTo' relationship expects a single object/id",ERR22:"Type not specified for polymorphic relation",ERR23:"Primary Key value not present",ERR24:"Error while relating record",ERR25:"Backward relation not present",ERR26:"Primary key value cannot be undefined or null",ERR27:"Observer can observe only string data type value, '{0}' value cannot be observed in the function named '{1}' in the component '{2}'",ERR28:"Unloaded record cannot be saved",ERR29:"Property not defined in the object",ERR30:"Error in variables declaration for Query",ERR31:"Query not registered for the Model",ERR32:"Property not defined in the object",ERR33:"Property's value is not an instanceof the mentioned class",ERR34:"Type definition for nested properties / items does not match with the value",ERR35:"A datatype mismatch has occurred for custom DataType '{0}'"},e.registeredGlobalEvents=e.__lyteRegisteredEvents={},e.__lyteRegisteredEventsGlobal={},e.triggerEvent=function(e){var r,t,o;"object"==typeof e&&e.global?(t=e.args,r=Array.prototype.slice.call(t,1),eventName=t[0],o="__lyteRegisteredEventsGlobal"):(r=Array.prototype.slice.call(arguments,1),eventName=arguments[0],o="__lyteRegisteredEvents");var a=!1,i=this[o][eventName];if(i)for(var s=0;s<i.listeners.length;s++){var n=i.listeners[s];if(n)if(!1===n.apply(this,r)){a=!0;break}}else i=this[o][eventName]={listeners:[]};var d=new CustomEvent(eventName,{detail:r});a||document.dispatchEvent(d)},e.triggerGlobalEvent=function(){return e.triggerEvent({global:!0,args:Array.from(arguments)})},e.addEventListener=function(r,t,o){if("function"==typeof t){var a=o&&o.global?"__lyteRegisteredEventsGlobal":"__lyteRegisteredEvents",i=this[a][r];return i||(i=this[a][r]={listeners:[]}),r+"-"+(i.listeners.push(t)-1)}e.error("Second parameter to Lyte.Component.addGlobalEventListener() must be a function")},e.removeEventListener=function(r,t){let o;if(r&&-1!=(o=r.lastIndexOf("-"))){var a=r.split("-");if(t){a=r.split("-");if(!(i=this[t&&t.global?"__lyteRegisteredEventsGlobal":"__lyteRegisteredEvents"][a[0]])||!i.listeners[a[1]])return void e.error("No such listener registered");i.listeners[a[1]]=null}else{var i,s=r.substring(0,o),n=r.substring(o+1);if(!(i=this.__lyteRegisteredEvents[s])||!i.listeners[n])return void e.error("No such listener registered");i.listeners[n]=null}}else e.error("listener unique id not specified / invalid")},e.extendEventListeners=function(r){r&&"object"==typeof r&&!r.hasOwnProperty("__lyteRegisteredEvents")&&Object.defineProperties(r,{__lyteRegisteredEvents:{value:{}},addEventListener:{value:e.addEventListener},removeEventListener:{value:e.removeEventListener},triggerEvent:{value:e.triggerEvent}})},e.deepCopyObject=function(r){for(var t,o,a,i,s,n,d=[{source:r,target:Array.isArray(r)?[]:Object.create(Object.getPrototypeOf(r))}],l=[r],c=d[0].target,p=[c];t=d.shift();){for(o=Object.keys(t.source),a=0;a<o.length;a++)(i=Object.getOwnPropertyDescriptor(t.source,o[a]))&&(i.value&&"object"==typeof i.value?(s=i.value,i.value=Array.isArray(s)?[]:s instanceof Set?new Set:Object.create(Object.getPrototypeOf(s)),-1==(n=l.indexOf(s))?(l.push(s),p.push(i.value),Object.defineProperty(t.target,o[a],i),d.push({source:s,target:i.value})):(i.value=p[n],Object.defineProperty(t.target,o[a],i))):Object.defineProperty(t.target,o[a],i));e.isRecord(t.source)&&(Object.defineProperty(t.target,"$",{value:{}}),t.target.$.isNew=t.source.$.isNew,t.target.$.isModified=t.source.$.isModified,t.target.$.isDeleted=t.source.$.isDeleted,t.target.$.pK=t.source.$.pK,t.target.$._attributes=t.source.$._attributes,t.target.$.isCloned=!0,t.target.$.model={_name:t.source.$.model._name},t.source.$.hasOwnProperty("deepNest")&&(t.target.$.deepNest=t.source.$.deepNest),t.source.$.hasOwnProperty("partialType")&&(t.target.$.partialType=t.source.$.partialType)),Array.isArray(t.source)&&t.source.partial&&Object.defineProperty(t.target,"partial",{value:t.source.partial})}return c},e.nestScpId=1,e.nestScp={},e.__nestRef__={},e.__nestScp__=new Map,e.establishObjectBinding=function(r,t,o,a,i,s){var n,d,l,c=r.__component__&&r.__component__.component.__data?r.__component__.component.__data[t]:void 0;if(o){if(r&&!r.$&&r._scp)Array.from(r._scp.keys()).forEach(function(r){var t=e.nestScp[r];n=store.modelFor(t.model)});else n=r.$.model;var p=!1;if(d=n&&n.fieldList&&n.fieldList.hasOwnProperty(t)?n.fieldList[t]:{}){var f=e.Transform[d.type];f&&(f.hasOwnProperty("properties")||f.hasOwnProperty("items"))&&(p=!0)}if(!(d&&"relation"!==d.type&&d.watch||p)){if(r._scp)Array.from(r._scp.keys()).forEach(function(o){var a=r._scp.get(o).paths,i=e.nestScp[o]||void 0;for(var n in s=i&&i.watch?i.watch:s,a){var d=n?n.split("."):[];d.push(t),e.bindObj(r,t,o,d,new Map,void 0,c,s,!0)}});return}c=d}a&&r._scp&&r._scp.size&&Array.from(r._scp.keys()).forEach(function(o){var a=r._scp.get(o).paths,i=e.nestScp[o]||void 0;for(var n in s=i&&i.watch?i.watch:s,a){var d=n?n.split("."):[];d.push(t),e.bindObj(r,t,o,d,new Map,void 0,c,s,!0)}});var y=!1;if(c&&e.Transform[c.type]){var u=e.Transform[c.type];(u.hasOwnProperty("properties")||u.hasOwnProperty("items"))&&(c=e.Transform[c.type],y=!0)}if((!o||d.watch||d.properties||d.items||s||y)&&r[t]){var v;r&&r.__component__?(r.__component__.__scpObj||Object.defineProperty(r.__component__,"__scpObj",{value:{}}),r.__component__,v=r.__component__.__scpObj):e.isRecord(r)&&(r.$.__scpObj||Object.defineProperty(r.$,"__scpObj",{value:{}}),r,v=r.$.__scpObj);var h=v;if(v){var m=!1,$=!1;if(o)if(r[t]&&!e.__nestScp__.has(r[t]))l={model:n._name,attr:t,pK:r.$.pK,Error:{}},m=!0;else{var g=e.__nestScp__.get(r[t]),b=e.__nestRef__[g]=e.__nestRef__[g]||new Map,_=e.$.genMapId(b);b.set(_,!0),e.setRecBindMap(e.nestScp[g],{model:n._name,attr:t,pK:r.$.pK,Error:{}}),h[t]=g+"_"+_}else if(r[t]&&!e.__nestScp__.has(r[t])){var R=[];(O={}).key=t,O.dtype=r.__component__.component.__data[t],O._cmpErr=r.errors,O.Error={},R.push(O),l={data:r[t],PropsInfo:R},O.dtype.watch&&(l.watch=!0),$=!0}else{g=e.__nestScp__.get(r[t]);var k=e.nestScp[g];if(k){k.PropsInfo||(k.PropsInfo=[]);var O,w=k.PropsInfo;(O={}).key=t,O.Error={},O._cmpErr=r.errors,O.dtype=r.__component__.component.__data[t],O.dtype.watch&&(k.watch=!0),w.push(O)}b=e.__nestRef__[g]=e.__nestRef__[g]||new Map,_=e.$.genMapId(b);b.set(_,!0),h[t]=g+"_"+_}if(l){var P=e.nestScpId++;b=e.__nestRef__[P]=e.__nestRef__[P]||new Map,_=e.$.genMapId(b);b.set(_,!0),e.__nestScp__.set(r[t],P),m&&(e.nestScp[P]={},e.setRecBindMap(e.nestScp[P],l),e.nestScp[P].Error=l.Error),$&&(e.nestScp[P]=l),e.nestScp[P]._data=r[t],h[t]=h[t]||P+"_"+_;e.bindObj(r,t,P,[],new Map,void 0,c,s)}}}},e.removeNestScp2Bind=function(e,r){if((e=e.model).has(r.model)){var t=e.get(r.model);if(t.has(r.pK)){var o=t.get(r.pK);o.has(r.attr)&&o.delete(r.attr),o.size||t.delete(r.pK)}t.size||e.delete(r.model)}},e.setRecBindMap=function(e,r){var t=e.model=e.model||new Map,o=r.model,a=r.pK,i=r.attr;o&&!t.has(o)&&t.set(o,new Map),t=t.get(o),a&&!t.has(a)&&t.set(a,new Map),t=t.get(a),i&&!t.has(i)&&t.set(i,!0)},e.bindObj=function(r,t,o,a,i,s,n,d,l){i=i||new Map;var c=void 0!=t?r[t]:r,p=!1;if(l||a.length||e.__nestScp__.get(r)!==o||delete e.nestScp[o].cyclic,a.length>1&&c&&e.nestScp[o]&&e.nestScp[o].hasOwnProperty("data")&&e.nestScp[o].data===c){if(i.get(c))p=!0;else try{JSON.stringify(c)}catch(e){p=!0}e.checkAndAddBind(c,o,a,p)&&e.estObjScp(c,o,a,p)}else{var f,y;if(n&&(n.hasOwnProperty("items")||n.hasOwnProperty("properties")?(f=n.items||n.properties,y=!0):void 0==d&&1==n.watch&&(d=n.watch)),f=d?void 0:f,Array.isArray(c)){if(i.get(c)?p=!0:(i.set(c,!0),c.forEach(function(r,t){a.push(t),(d||n&&n.hasOwnProperty("items")&&"object"==typeof n.items)&&e.bindObj(c,t,o,a,i,void 0,f,d),a.pop()})),e.checkAndAddBind(c,o,a,p))Array.isArray(d)&&(u=e.checkEstablishingSCP(c,a,d)),(u||"boolean"==typeof d&&d||y)&&e.estObjScp(c,o,a,p)}else if(c&&"object"==typeof c){var u;p=!1;if(i.get(c))p=!0;else for(var v in i.set(c,!0),c)a.push(v),(d||f&&f.hasOwnProperty(v))&&e.bindObj(c,v,o,a,i,void 0,f?f[v]:void 0,d),a.pop();if(e.checkAndAddBind(c,o,a,p))Array.isArray(d)&&(u=e.checkEstablishingSCP(c,a,d)),(u||"boolean"==typeof d&&d||y)&&e.estObjScp(c,o,a,p)}}},e.checkAndAddBind=function(r,t,o,a){if(!r._scp||!r._scp.size)return!0;if(r._scp.size&&(r._scp.has(t)&&r._scp.get(t).paths.hasOwnProperty(o.join("."))))return a&&(e.nestScp[t].cyclic=!0),!1;return!0},e.estObjScp=function(r,t,o,a){r._scp||Object.defineProperty(r,"_scp",{value:new Map,enumerable:!1,configurable:!0});var i=r._scp;i.has(t)||i.set(t,{});var s=i.get(t);o=o?o.join("."):o;(s.paths=s.paths||{})[o]=!0;var n=e.nestScp[t];n.cyclic||1!=a||(n.cyclic=!0)},e.cmpObjs=function(r,t){if(Object.keys(r).length!==Object.keys(t).length)return!1;for(var o in r){if(!t.hasOwnProperty(o))return!1;if(0==e.cmpData(r[o],t[o]))return!1}return!0},e.cmpData=function(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;if(r===t)return!0;for(var o=r.length,a=0;a<o;a++)if(0==e.cmpData(r[a],t[a]))return!1}else{if(r&&t&&"object"==typeof r&&"object"==typeof t)return r===t||e.cmpObjs(r,t);if(r!==t)return!1}return!0},e.nestScpRmPath=function(e,r){if(e&&e.paths)for(var t in e=e.paths)t.startsWith(r+".")&&delete e[t]},e.nestScpRemove=function(r,t,o){var a=r._scp;if(a&&a.size){if(o){e.nestScpRmPath(a.get(t),o);var i=a.get(t),s=i?i.paths:void 0;s&&!Object.keys(s).length&&a.delete(t)}else a.delete(t);a.size||delete r._scp}},e.rmNestScp=function(r,t,o,a,i){if(Array.isArray(r))o.get(r)||(o.set(r,!0),r.forEach(function(r,a){e.rmNestScp(r,t,o,void 0,i)})),e.nestScpRemove(r,t,i);else if(r&&"object"==typeof r){if(!o.get(r))for(var s in o.set(r,!0),r)e.rmNestScp(r[s],t,o,void 0,i);e.nestScpRemove(r,t,i)}},e.removeNestScp=function(r,t,o,a,i,s,n,d){s=s||new Map,t=Number.parseInt(t);var l=e.nestScp[t],c=e.__nestRef__[t];d&&l.model&&e.removeNestScp2Bind(l,d),i?(c&&c.has(o)&&c.delete(o),(!c||c&&!c.size)&&(delete e.__nestRef__[t],e.__nestScp__.has(r)&&e.__nestScp__.delete(r),e.rmNestScp(r,t,s,!0,a),n||delete e.nestScp[t])):e.rmNestScp(r,t,s,!0,a)},e.resolvePromises=function(r){if("string"==typeof r||r instanceof Promise)return r;if(Array.isArray(r))return function(r){var t=[],o=!1;if(r.every(function(e,r){return!(e instanceof Promise||e&&!Array.isArray(e)&&"object"==typeof e&&"function"==typeof e.then)||(o=!0,!1)}),!o)return Promise.resolve(r);return new Promise(function(o,a){Promise.all(r).then(function(e){r.forEach(function(r,o){t[o]=e[o]}),o(t)},function(r){a(r),e.error("Error on resolve promises",r)})})}(r);if("object"==typeof r)return function(r){var t=[],o=[],a=Object.keys(r);if(a.forEach(function(e){var a=r[e];(a instanceof Promise||a&&!Array.isArray(a)&&"object"==typeof a&&"function"==typeof a.then)&&(t.push(e),o.push(a))}),o.length){var i={},s=new Promise(function(s,n){Promise.all(o).then(function(e){a.forEach(function(o){-1!=t.indexOf(o)?i[o]=e[t.indexOf(o)]:i[o]=r[o]}),s(i)},function(r){n(r),e.error("Error on resolve promises",r)})});return s}return Promise.resolve(r)}(r)},"complete"===document.readyState||"interactive"===document.readyState?d():document.addEventListener("DOMContentLoaded",function(e){d()},!0);var l=XMLHttpRequest.prototype.send;function c(r,t,o,a){var i=e.__nodeXHRMap=e.__nodeXHRMap||new Map,s=i.get(t);s||i.set(t,new Map),s=i.get(t);var n=t.lyteState=t.lyteState||[],d=a||o;-1==n.indexOf(d)&&n.push(d),t.setAttribute("lyte-state","");var l=s.get(r);if(l||(s.set(r,[]),l=s.get(r)),a)return l.push({state:a}),{target:t,event:r};l.push({isXHR:!0,xhr:o});var c=function(e){4==o.readyState&&(p(o,r,t),o.removeEventListener("readystatechange",c))};o.addEventListener("readystatechange",c)}function p(r,t,o){var a=e.__nodeXHRMap,i=a.get(o);if(i){var s=i.get(t);if(s&&s){var n=s,d=-1;if(n.every(function(e,t){return!(e&&e.isXHR&&e.xhr==r||"string"==typeof r&&e.state==r)||(d=t,!1)}),-1!=d){n.splice(d,1);var l=o.lyteState.indexOf(r);if(o.lyteState.splice(l,1),!n.length){i.delete(t);var c=o&&Array.isArray(o.lyteState)?o.lyteState.indexOf(r):-1;-1!=c&&o.lyteState.splice(c,1),o&&o.lyteState&&0==o.lyteState.length&&(o.lyteState=null,o.removeAttribute("lyte-state"))}i.size||a.delete(o)}}}}XMLHttpRequest.prototype.send=function(){var r,t=window.event,o=t?t.target:void 0;if(e.getConfig("stateHandling"))if(t)r=t.type,/^(click|dblclick)$/.test(r)&&o&&o.getAttribute&&"false"!=o.getAttribute("lyte-state-handling")&&c(r,o,this);else{var a=e&&e.Router?e.Router.getRouteInstance():void 0;if(a){var i=a.transition?a.transition.ev:void 0;if(i&&i.target&&i.target.getAttribute&&"false"!=i.target.getAttribute("lyte-state-handling"))(e.__transXHRMap=e.__transXHRMap||new Map).set(a.transition,{currentAction:i,XHR:this}),c(i.type,i.target,this)}}l.apply(this,arguments)},e.addEventListener("transitionStart",function(e){var r=e.nextTrans;r&&e.prevTrans&&(window.event&&/^(click|dblclick)$/.test(window.event.type)?(r.ev=window.event,e.prevTrans.ev&&delete e.prevTrans.ev):409!=e.prevTrans.state&&308!=e.prevTrans.state||!e.prevTrans.ev||(r.ev=e.prevTrans.ev,delete e.prevTrans.ev))}),e.addEventListener("afterRouteTransition",function(r){if(r&&r.trans){var t=e.__transXHRMap,o=!1;if(409==r.trans.state||308==r.trans.state){var a=window.event,i=r.trans.ev;if(!a||a&&i&&a!=i&&a.target==i.target&&a.type==i.type?r.trans.nested=!0:o=!0,t){var s=t.get(r.trans);s&&(p(s.XHR,s.currentAction.type,s.currentAction.target),t.delete(r.trans))}}else 200==r.trans.state&&(t&&t.delete(r.trans),o=!0);o&&r.trans.ev&&delete r.trans.ev}}),e.addEventListener("beforeRouteTransition",function(e){e&&e.prevTrans&&e.prevTrans.nested&&(e.trans.ev=e.prevTrans.ev,delete e.prevTrans.ev,e.trans.fromPrevTrans=!0)}),e.setState=function(r){r||console.error("Please provide a state name");var t=window.event;if(/^(click|dblclick)$/.test(t.type)){var o=t.target;if(1==e.getConfig("stateHandling")&&o&&o.getAttribute&&"false"!=o.getAttribute("lyte-state-handling"))if(!o.getAttribute("lyte-state")){var a=e.__stateMap=e.__stateMap||new Map;if(a.get(r))console.error("There is already a open state by the name",r);else{var i=c(t.type,o,void 0,r);a.set(r,i)}}}},e.removeState=function(r){r||console.error("Please provide a state name");var t=e.__stateMap;if(t){var o=t.get(r);o&&(t.delete(r),p(r,o.event,o.target))}},e.setConfig=function(r,t,o){"mutable"==r&&(1==t?e.__gl=e.mut(e.__gl__):0==t&&(e.__gl=e.__gl__));var a=e.__config=e.__config||{};o?Object.defineProperty(a,r,{value:t}):a[r]=t},e.getConfig=function(r){var t=e.__config;if(t)return t[r]},e.establishWatchScope=function(r,t){var o;for(var a in r){var i=a,s=r[a];if(this.component&&this.component.__data&&this.component.__data[i]){o=this.getData(i),s=!!this.component.__data[i].watch||s,"object"==typeof o&&e.establishObjectBinding(this.component.data,a,!1,void 0,void 0,s);var n=this.component.__data;e.nestScp[e.__nestScp__.get(o)]&&(n[a].watch=s)}else if(t){var d=t.fieldList;d[a]&&void 0==d[a].watch&&(d[a].watch=s,t._fldGrps.watch[a]=d[a])}}},e.checkEstablishingSCP=function(r,t,o){if(Array.isArray(o)){var a;if(a=t.join("."),e.checkWatchPath(a,o,!0)&&"object"!=typeof r)return!0;for(var i=Object.keys(r),s=0;s<i.length;s++){var n=i[s],d=""==a?n:a+"."+n;if(e.checkWatchPath(d,o,!0))return!0}}},e.checkWatchPath=function(r,t,o){if("boolean"==typeof t&&!0===t)return!0;if(Array.isArray(t))for(var a=0;a<t.length;a++){var i=t[a],s=-1!=(i=(i=(i=i.replace(/ /g,"")).replace(/\$\.\./g,"..")).replace(/\$\./g,"")).search(/\.\./g)||-1!=i.search(/\[|\\]|\{|\}/g)||i.includes("*");if(r==i)return!0;if(s){if(o&&-1!=i.search(/\.\./)&&"..*"==(i=i.replace(/\.\.\S+/g,"..*")))return!0;if(i=(i=(i=0==(i=0==i.search(/\[/)?i.replace("[",""):i).search(/\.\.\[/)?i.replace("..[",".."):i).replace(/\.*\[/g,".")).replace(/\]/g,""),e.checkWeirdPath(i,r))return!0}}},e.checkWeirdPath=function(e,r){if(r==e)return!0;if(e.includes("..")||e.includes("*")){var t=e;t=(t=(t=(t=(t=t.replace(/\*/g,"$$")).replace(/\.\./g,"::")).replace(/\./g,"\\.")).replace(/\:\:/g,"\\.?.*\\.?")).replace(/\$/g,".*");var o=e.split("."),a=o.length;return""==o[a-2]&&"*"!=o[a-1]&&(t+="$"),!!new RegExp(t).test(r)}};e.ignoreMut=function(e){!0,e(),!1};var f=new WeakMap;e.mut=function(r){if(r&&r.__ltPrx__)return r;if(r&&f.has(r))return f.get(r);if(!r||r&&"Object"!==r.constructor.name&&"Record"!==r.constructor.name&&!Array.isArray(r)&&!r.__ltPrx__)return r;let t=new Proxy(r,{set:function(r,t,o){return Array.isArray(r)?r[t]=o:e.Component.set(r,t,o),!0},get:function(r,t){if("__ltPrx__"===t)return!0;if("__target__"===t)return r;var o=r[t];if(o&&o.__ltPrx__)return o;if(o&&f.has(o))return f.get(o);var a=Object.getOwnPropertyDescriptor(r,t);if(o&&("Object"===o.constructor.name||Array.isArray(o)||o&&o.$&&o.$.hasOwnProperty("isModified"))&&!o.__ltPrx__&&a&&a.configurable){let r=e.mut(o);return f.set(o,r),r}return o}});return f.set(r,t),t},e.immut=function(r,t){var o;t=t||new WeakMap;return r&&Array.isArray(r)?o=Array.from(r):r&&"object"==typeof r&&(o=Object.assign({},r)),t.get(r,o),new Proxy(r,{get:function(r,o){var a;return(a=t.get(r)[o])&&"object"==typeof a&&!t.has(a)?e.immut(a,t):a},set:function(r,o,a){var i=t.get(obj);return e.Component.set(i,o,a),!0}})},Object.defineProperty(e,"__gl__",{value:{}}),e.__gl=e.__gl__}(_Lyte),Lyte.registerErrorCodes({LD01:"Primary key value might be missing in the response data that is received, {0}",LD02:"{0} - {1} is not registered",LD03:"Cannot set the error {0} for {1}",LD04:"No such record to merge, {0}",LD05:"Model( {0} ) of related property - {1} not found in model - {2}",LD06:"Backward relation not present in model( {0} ), for the property {1} of model( {2} )",LD07:"{0} type not handled in handleArrayOperations",LD08:"{0} {1} will be deprecated from next version {2}",LD09:"deserializeKey cannot be processed for payload with more than two keys. Please use payloadKey callback instead or try modifying the same in normalizeResponse callback",LD10:"Response data not in a format lyte data store expects",LD11:"Deprecation Warning! findRecord response payload will not accept an array. It will be deprecated from the next version",LD12:"Response ( {0} ) is not in a format, lyte data store expects",LD13:"Response processing failed in {0} for model-{1} {2}, since invalid data is received in {1}(modelName) key of the data",LD14:"Cannot register {0} - {1}, as it already exists.",LD15:"Primary key value might be missing in the response data that is received, {0}",LD16:"Record merge failed for the record in model - {0} with primaryKey value - {1}, since either the persisted(saved) primary key value for a newly created record is not received from server or not in the proper structure to merge",LD17:"Record with the primary key value already exists",LD18:"No { 0 } present",LD19:"Deprecation Warning! findAll will not accept response payload values other than an array or any empty value. Current implementation which allows this will be deprecated from the next version",LD20:"Record cannot be saved as a state, when it is not either a new or a modified record or in a error state.",LD21:"No such state ( {0} ) saved for the record.",LD22:"For create / createRecord, response with a primary key value should be received",LD23:"PrimaryKey field {1} in {0} cannot have default value",LD24:"Response couldn't be parsed, {0}",LD25:"Cannot create record for the data - {0}",LD26:"Only one baseKey is allowed for a model",LD27:"Record merge failed, since the data passed is invalid - {0}",LD28:"Record merge failed for the model - {0}, since a valid primary key value is not found in the data to be merged - {1}",LD29:"Unloaded record-{0} of the model-{1} is being saved",LD30:"Variable value in query is mandatory for {0}",LD31:"Datatype defined for {0} is mismatch with the value's datatype",LD32:"Query '{0}' was not registered for the model '{1}"});var $Record=function(){Object.assign(this,{inIDB:!1,isPersisted:!0,isUnloaded:!1,isModified:!1,isNew:!1,isDeleted:!1,isError:!1,events:[],validatedOnCreate:!0,error:{}})},Record=function(e,r,t,o){var a=store.modelFor(e),i=t?t.delayPersistence:store.$.getFromCB("adapter",e,"delayPersistence");Object.assign(this,r),Object.defineProperties(this,{$:{writable:!0,value:new $Record}});var s=store.$.getpKVal(this,a);o&&Object.defineProperties(this.$,{isCloned:{value:!0,writable:!1},donor:{value:store.$.peekRecord(e,s)}}),Object.defineProperties(this.$,{pK:{value:s,writable:!0},model:{value:a},_attributes:{value:{},writable:!0},_relationships:{value:{},writable:!0},isDirty:{value:function(){var e,r=this.record;return!!r.$.isModified||!!(e=store.$.isDirty(r,this.model.relations)).length&&e}},undoStack:{value:store.$.genUnRedoStack(),writable:!0},redoStack:{value:store.$.genUnRedoStack(),writable:!0},delayPersistence:{value:i}}),this.$.record=this,a.sort&&!o&&store.$.defProp(this.$,"created_Time",store.$.getCreatedTime(a.cT));var n=store.$.saveParent;n&&this!==n&&store.$.defProp(this.$,"parent",n);var d=a._fldGrps.default,l=a._fldGrps.watch,c=a._fldGrps.hasMany,p=a._fldGrps.nested_prop;for(var f in d){var y=d[f],u=r[f];void 0!==u&&""!==u||(this[f]=store.$.getDefaultVal(this,y.default))}for(var v in l)Lyte.establishObjectBinding(this,v,!0,void 0,void 0,!0);for(var h in p)Lyte.establishObjectBinding(this,h,!0,void 0,void 0,h&&h.watch?h.watch:void 0);for(var m in c){var $=c[m];if(this.hasOwnProperty(m))this[m]=Array.isArray(this[m])?Array.from(this[m]):this[m];else if(store.modelFor($.relatedTo)&&!o){store.$.getFromCB("serializer",$.relatedTo,"initHasManyRelation")&&(this[m]=[])}}var g=a._properties;if(Object.keys(g).length&&(this._bindings||store.$.defProp(this,"_bindings",new Set,!1,!0),this._bindings.add(g),store.$.establishObserverBindings(this,g)),a.deprecate&&a.deprecate.size&&Lyte.__config&&Lyte.__config.deprecateModelFields){var b=new Proxy(this,{get:function(e,r,t){return a.deprecate.has(r)&&Lyte.warn("Property - '"+r+"' of Model-'"+a._name+"' has been deprecated. "),e[r]},set:function(e,r,t){return a.deprecate.has(r)&&Lyte.warn("Property - "+r+" of Model-"+a._name+" has been deprecated."),Reflect.set(...arguments)}});return this.$.record=b,b}};Object.defineProperties($Record.prototype,{get:{value:function(e){var r=this.record[e];return Lyte.Component&&Lyte.Component._get&&(r=Lyte.Component._get(this.record,e)),Lyte.getConfig("mutable")&&(Lyte.isRecord(r)||Array.isArray(r)&&r.model)?Lyte.mut(r):r}},set:{value:function(e,r,t){return this.isDeleted?store.$.setRecErr(this,this.model._pK,"ERR17"):store.$.setData(this,e,r,t),this.record}},getDirtyAttributes:{value:function(){var e=[],r=this._attributes;if(Object.keys(r).length)for(var t in r)e.push(t);return e}},rollBackAttributes:{value:function(e,r){Array.isArray(e)||(e=[e]);for(var t=this.record.$.record,o=[],a=this.model,i=this._attributes,s=0;s<e.length;s++){var n=e[s];if(i.hasOwnProperty(n)){var d=a.fieldList[n],l=i[n];if("relation"==d.type)store.$.rllBckRecArr(l,t,a,d),(t.$.dN&&t.$.dN.hasOwnProperty(n)?t.$.dN[n]:new Map).forEach(function(e,r){store.$.deleteDeepNest(t,n,r)});else store.$.cmpSet(t,n,l,void 0,!0);o.push(n),delete i[n]}store.$.clrRecErr(this,n)}if(Object.keys(this._attributes).length||(this.hasOwnProperty("dN")&&(!this.dN||Object.keys(this.dN).length)||t.$.isNew||store.$.removeParentNesting(t,"modified"),store.$.cmpSet(this,"isModified",!1),store.$.changePersist(t,!0),this.isNew||store.$.deleteFromArray(a.dirty,this.get(a._pK))),o.length>0){var c=[t,o];this.emit("change",c),a.emit("change",c),this.undoStack=store.$.genUnRedoStack(),this.redoStack=store.$.genUnRedoStack()}}},rollBack:{value:function(e,r){var t=this.model,o=(t._pK,new Map);r=!1!==r&&(t._fldGrps.inherit&&Object.keys(t._fldGrps.inherit).length),e?(this.rollBackState(e,r),store.$.removeOnSave(this.model._name,this.record.$.pK)):(r&&store.$.rBinherit(this,o,""),store.$.rollBackRecord(this))}},deleteRecord:{value:function(e){var r=this.model,t=this.record.$.record;e=void 0!==e?e:t.$.delayPersistence?t.$.delayPersistence.delete:void 0;store.$.removeFromStore(r,t.$.pK,void 0,void 0,e)}},destroyRecord:{value:function(e,r,t,o){return this.deleteRecord(t),this.save(e,r,"destroyRecord",void 0,o)}},addEventListener:{value:function(e,r){return store.$.eventListeners.add(this,e,r)}},removeEventListener:{value:function(e){store.$.eventListeners.remove(this,e)}},emit:{value:function(e,r){store.$.eventListeners.emit(this,e,r)}},triggerAction:{value:function(e,r,t,o,a){var i=this.model,s=i.actions;return(s?s[e]:void 0)?store.adapter.$.handleAction(e,i,this.record.$.record,r,t,o,a):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18,data:e})}},save:{value:function(e,r,t,o,a){var i=this;if(this.isCloned){if(this.isUnloaded)return Promise.resolve();i=store.$.savingDonorRecord(this)}var s,n=i.model,d=i.record,l=i.isDirty(),c=t&&t.validateOnSave,p=t&&t.skipValidation,f=n.fieldList;if(!0!==i.isUnloaded)if(i.isDeleted){if(!i.isNew)return store.adapter.$.del(n._name,d,!0,o,e,r,a)}else{if(i.isNew){var y=i;return p||d.$.validatedOnCreate&&!c||(s=store.$.validateRecord(i.record,f)),!p&&(0==s||y&&y.error&&Object.keys(y.error).length>0)?Promise.reject(y.error):store.adapter.$.create(n._name,d,!0,e,r,a)}if(i.isModified||l&&l.length){if(!p&&t&&c&&(s=store.$.validateRecord(i.record,f)),!p&&(0==s||d&&d.$&&d.$.isError))return Promise.reject(d.$.error);var u=store.$.updateJSON(i.record,n,l);return store.adapter.$.put(n._name,u,d,!0,e,r,a)}}else if(Lyte.warn("LD29","object"==typeof d.$.pK?JSON.stringify(d.$.pK):d.$.pK,n._name),store.$.getFromCB("adapter",n._name,"rejectUnloadRecordSave"))return Promise.reject({code:"ERR28",message:Lyte.errorCodes.ERR28,data:d});return Promise.resolve()}},getInitialValues:{value:function(e){var r=!1;e?(Array.isArray(e)||(e=[e]),r=!0):e=this.getDirtyAttributes();for(var t={},o=this.record.$.record,a=this._attributes,i=0;i<e.length;i++)if(void 0!=o[e]&&o[e[i]].add){t[e[i]]=o[e[i]].slice(0);for(var s=a[e[i]],n=o[e[i]].model._pK,d=s.length-1;d>=0;d--)if("added"==s[d]._type)for(var l=0;l<s[d].records.length;l++){var c=store.$.getIndex(t[e[i]],n,s[d].records[l].$.pK);-1!=c&&t[e[i]].splice(c,1)}else if("removed"==s[d]._type)for(l=s[d].records.length-1;l>=0;l--)t[e[i]].splice(s[d]._indices[l],0,s[d].records[l]);else"changed"==s[d]._type&&(t[e[i]]=Array.isArray(s[d].records)?Array.from(s[d].records):s[d].records)}else t[e[i]]=a[e[i]];return r?t[e[0]]:t}},toJSON:{value:function(e,r){var t=!0;return r=!!r,"object"==typeof e&&0==e.inherit&&(t=e.inherit),Object.assign({},store.$.toJSON(this.model._name,this.record.$.record,e||!0,void 0,void 0,t,r))}},undo:{value:function(e,r){var t=this.undoStack._order_.length;for(r=r||(t?t-1:t);t-- >r;)store.$.unredoOp(1,this,e)}},getCurrentState:{value:function(){return this.undoStack._order_.length}},redo:{value:function(e){store.$.unredoOp(2,this,e)}},validate:{value:function(e,r){var t={},o=this.model.fieldList;Array.isArray(e)?e.forEach(function(e,r){o[e]&&(t[e]=o[e])}):"object"==typeof e&&(t=e),0!=Object.keys(t).length&&1!=e||(t=o);var a=this.record,i=store.$.validateRecord(a,t,r);if(r&&i&&"object"==typeof i)return i}},saveState:{value:function(e){if(this.isNew||this.isModified){for(var r,t=this._savedState=this._savedState||{},o=e;!o;)r=Math.floor(1e5*Math.random()+1),o=t.hasOwnProperty(r)?o:r;var a=this.toJSON("state");store.$.defProp(a,"$",{},!1,!0),this.model._arrPk.forEach(function(e){delete a[e]});var i=this.undoStack,s=this.redoStack,n=this._attributes,d=this.dN;if(i&&Object.keys(i).length){var l=i._order_;i=a.$.undoStack=store.$.deepCopyStack(i),store.$.defProp(i,"_order_",Lyte.deepCopyObject(l),!1,!0)}if(s&&Object.keys(s).length){l=s._order_;s=a.$.redoStack=store.$.deepCopyStack(s),store.$.defProp(s,"_order_",Lyte.deepCopyObject(l),!1,!0)}return n&&Object.keys(n).length&&(a.$._attributes=store.$.deepCopyAttrs(this.model,n)),d&&Object.keys(d).length&&(a.$.dN=store.$.deepCopyAttrs(this.model,d)),this._savedState[o]=a,o}Lyte.warn("LD20")}},clearState:{value:function(e){e?delete this._savedState[e]:this._savedState={}}},rollBackState:{value:function(e,r){var t=this._savedState,o=t?t[e]:void 0;o?(this.dN&&(this.dN={}),store.$.setData(this,o,void 0,void 0,{},!0,r,o.$.dN),store.$.updateDn(this.record.$.record),this.undoStack=o.$.undoStack||store.$.genUnRedoStack(),this.redoStack=o.$.redoStack||store.$.genUnRedoStack(),this._attributes=o.$._attributes||{},store.$.checkAttrs(this.record.$.record),delete this._savedState[e]):Lyte.warn("LD21",e)}},hasSavedState:{value:function(e){return!(!this._savedState||!this._savedState.hasOwnProperty(e))}},persist:{value:function(e){var r,t,o=this.model._name,a=this.record.$.record,i={obj:new Map};if(this.isNew)r="create",store.$.toJSON(o,a,void 0,r,i);else if(t=this.isDirty()){var s=store.$.updateJSON(a,this.model,t);store.$.toJSON(o,s,void 0,void 0,i)}var n=i.obj.get(this.pK);store.adapter.$.mergeResponse(a,this.model,void 0,this.pK,n,!0),store.adapter.$.updateIDB(o,r||(a.$.isDeleted||a.$.isUnloaded?"deleteRecord":a.$.isModified||t?"updateRecord":void 0),a)}},clone:{value:function(){var e=this.record.$.record,r=this.record.$.toJSON({type:"isClone"});return store.$.insertIntoStore(e.$.model._name,r,void 0,void 0,void 0,void 0,void 0,{type:"isClone"})}}});var Model=function(e,r){Object.assign(this,{_name:e,fieldList:{id:{type:"string",primaryKey:!0,defined:!1}},relations:{},_properties:{},deprecate:{},_fldGrps:{default:{},hasMany:{},watch:{},inherit:{},nested_prop:{},inverse:{},JsonPathWatch:{}},data:[],dirty:[],_deleted:new Map,events:{}}),store.$.defProp(this.data,"_recMap",new Map);var t=[];for(var o in r)store.$.registerField(this,o,r[o],t);this._pK||(this._pK="id"),this.isComp=!1;var a=this._pK.split(",");a.length>1&&(this.isComp=!0),this._arrPk=a,"undefined"!=typeof Lyte&&(Lyte.establishObserverBindings(t,!0,this._properties,this),Lyte.establishWatchScope(this._fldGrps.JsonPathWatch,this)),store.$.defArrUtls(this.data),store.$.defUtls(this.data,this),store.$.defProp(this,"extends",store.$.extendModel)};Model.prototype.addEventListener=function(e,r){return store.$.eventListeners.add(this,e,r)},Model.prototype.removeEventListener=function(e){store.$.eventListeners.remove(this,e)},Model.prototype.emit=function(e,r){store.$.eventListeners.emit(this,e,r)},Model.prototype.on=function(e,r){return this.addEventListener(e,r)},Model.prototype.setGql=function(e,r,t){store.$.setQuery(this,r,e,t)};var store={model:{},$:{idbOpen:!0,request:{},toRelate:{},idbQueue:[],idbQ:{},idbQ2:{},nestScp:{},nestScpId:1,getAdapter:function(e){if("application"==e.name)return store.adapter[e.name];if(e.model||e.name){var r=e.model||store.model[e.name];if(r&&r.extend&&!store.adapter.hasOwnProperty(r._name))return store.adapter[r.extend];var t=r?r._name:e.name;return store.adapter[t]}},registerModel:function(e,r,t){if(store.model.hasOwnProperty(e))return Lyte.warn("LD14","Model",e),Lyte._postRegister(),{error:Lyte.getErrorMessage("LD14","Model",e),extends:function(){}};try{var o,a,i,s,n,d;if(t&&"object"==typeof t&&(o=t.extends||void 0,a=t.actions||void 0,i=t.idb||void 0,s=t.gql||void 0,n=t.sort||void 0,d=t.deprecate||void 0),o){var l=Object.assign({},store.model[o].fieldList);for(var c in l)"relation"==l[c].type&&delete l[c];r=Object.assign(r,l)}var p=store.model[e]=new Model(e,r);if(o&&store.$.extendModel(o,p),a&&(p.actions=a),i&&(p.idb=i),s&&(p.gql=s),n&&(p.sort=n,p.cT=new Map),d){Array.isArray(d)||(d=[d]);var f=new Map;d.forEach(function(e){f.has(e)||f.set(e,1)}),p.deprecate=f}Lyte._postRegister()}catch(e){Lyte._postRegister()}return p},changePersist:function(e,r){if(!e.$.isUnloaded||e.$.isPeristed!==r)switch(r){case!0:e.$.isNew||e.$.isModified||e.$.isDeleted||store.$.cmpSet(e.$,"isPersisted",!0);break;case!1:(e.$.isNew||e.$.isModified||e.$.isDeleted||e.$.dN&&Object.keys(e.$.dN)&&Object.keys(e.$.dN).length)&&store.$.cmpSet(e.$,"isPersisted",!1)}},getFromCB:function(e,r,t){var o,a=store[e];/^(adapter|serializer)$/.test(e)&&store.model.hasOwnProperty(r)&&store.model[r].extend&&(o=store.model[r].extend);for(var i=a&&a.hasOwnProperty(r)?a[r]:o&&a.hasOwnProperty(o)?a[o]:void 0,s=i?i[t]:void 0;void 0===s;)if(i&&i.$super)s=(i=i.$super)?i[t]:void 0;else{if(i||(i=a.application),!i||!i.hasOwnProperty(t)){if("adapter"==e){switch(t){case"host":s=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.host;break;case"namespace":s="";break;case"actionNamespace":s="action";break;case"batchNamespace":s="batch";break;default:s=void 0}break}break}if(s=i[t],!i&&!s)break}return s},newCB:function(e,r,t,o,a){for(var i in r.__extendedBy=[],o)r[i]=o[i];store.$.extendOptions(a,e,t,r,store),store.$.lazyExtend(e,r,t),store.$.defProp(r,"is",e),store.$.defProp(r,"__name",t)},extendOptions:function(e,r,t,o,a){e&&e.mixins&&e.mixins.length&&e.mixins.forEach(function(e){if(Lyte.Mixin.exists(e)){var i=Lyte.registeredMixins[e];for(var s in i)o[s]=i[s]}else Lyte.$.requiredMixins(e,{name:t,scope:a},r)});var i=e?e.services:[];if(store.$.extendService(i,r,t,o,a),Lyte.toBeInjectedServices){var s=Lyte.toBeInjectedServices,n=[];for(var d in s)n.push({as:d,service:s[d]});store.$.extendService(n,r,t,o,a,!0)}},extendService:function(e,r,t,o,a,i,s){Lyte.extendService({services:e,type:r,name:t,ins:o,isGlobal:i,data:s,callback:function(e,t,o,s){Lyte.$.lazyRegisterService(i?e:Lyte.$.instantiateService(s),{scope:a,type:r,name:o,key:t})}})},lazyExtend:function(e,r,t){var o=store[e];if(o.__toAddSuper&&o.__toAddSuper.hasOwnProperty(t)){for(var a=o.__toAddSuper[t],i=0;i<a.length;i++){var s,n=o[a[i]];if(n&&n.is==e)n.$super=r,r.__extendedBy.push(a[i]),"application"!=t&&(o.__toAddSuper.application&&(s=o.__toAddSuper.application.indexOf(n.__name))>-1&&o.__toAddSuper.application.splice(s,1),o.application&&(s=o.application.__extendedBy.indexOf(n.__name))>-1&&o.application.__extendedBy.splice(s,1))}delete o.__toAddSuper[t]}},cbDef:function(e,r){Object.defineProperties(e.prototype,{super:{value:function(){return store.$.super.call(this,arguments)}},extends:{value:function(e){store.$.extendCallback.call(this,store,r,e)}}})},changeRelPkMaps:function(e,r,t,o,a){var i=e.$.model,s=i.relations;for(var n in s)for(var d=s[n],l=d.length,c=0;c<l;c++){var p=d[c],f=p.relKey,y=p.relType;if(e.hasOwnProperty(f)){var u,v=e[f],h=store.model[p.relatedTo];if(h&&(u=store.$.getBackwardRel(i,p,h))&&"hasMany"==u.relType)if(P=u.opts&&u.opts.sort&&u.opts.sort.sortFn&&u.opts.sort.observes,"belongsTo"==y&&Lyte.isRecord(v))switch(o){case"sort":case"srtObsChk":if(v&&Array.isArray(v[u.relKey]))if("sort"==o)P&&-1!=u.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(v[u.relKey],"sort");else if(a!==u.relKey)return!0;break;default:v[u.relKey]&&v[u.relKey]._recMap&&v[u.relKey]._recMap.delete(r)&&v[u.relKey]._recMap.set(t,e)}else if("hasMany"==y&&Array.isArray(v))for(var m=v.length,$=0;$<m;$++){var g=v[$];switch(o){case"sort":case"srtObsChk":if(g&&Array.isArray(g[u.relKey]))if("sort"==o)P&&-1!=u.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(g[u.relKey],"sort");else if(a!==u.relKey)return!0;break;default:Lyte.isRecord(g)&&g[u.relKey]&&g[u.relKey]._recMap&&g[u.relKey]._recMap.delete(r)&&g[u.relKey]._recMap.set(t,e)}}}}var b=e.$._relationships;for(var _ in b){var R=b[_],k=store.modelFor(_);for(var f in R)for(var O=R[f],w=k.fieldList[f],P=w.opts&&w.opts.sort&&w.opts.sort.sortFn&&w.opts.sort.observes,A=O.length,L=0;L<A;L++){var j=(g=O[L])[f];if(Array.isArray(j))switch(o){case"sort":case"srtObsChk":if(Array.isArray(j))if("sort"==o)P&&-1!=w.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(j,"sort");else if(a!==w.relKey)return!0;break;default:j._recMap&&j._recMap.delete(r)&&j._recMap.set(t,e)}}}},updateNestScp:function(e,r){if(Lyte.isRecord(e)){var t=e.$.__scpObj||{};for(var o in t){if(i=(i=t[o]).split("_")[0],Lyte.nestScp&&Lyte.nestScp.hasOwnProperty(i)&&Lyte.nestScp[i].model){var a=Lyte.nestScp[i].model.get(e.$.model._name);if(a.has(r)){var i=a.get(r);a.delete(r),a.set(e.$.pK,i)}}}}},getDefaultVal:function(e,r){return"function"!=typeof r?r:r.call(e)},deepValueChange:function(e,r,t,o){var a={emit:!1,attr:[],oldRec:{}};store.$.estAttrs(e,r,t,a,o),store.$.checkAttrs(e),store.$.changeCallbck(e,a)},updateDn:function(e){var r=e.$.model.relations;for(var t in r){r[t].forEach(function(r){var t=r.opts,o=r.relKey,a=r.relType;if(t&&t.deepNest&&e.hasOwnProperty(o)){var i=e[o];"belongsTo"==a&&(i.$.isModified||i.$.dN&&Object.keys(i.$.dN).length)?store.$.setDeepNest(e,o,i.$.pK,"updated"):"hasMany"==a&&Array.isArray(i)&&i.forEach(function(r){(r.$.isModified||r.$.dN&&Object.keys(r.$.dN).length)&&store.$.setDeepNest(e,o,r.$.pK,"updated")})}})}},genUnRedoStack:function(){var e={};return store.$.defProp(e,"_order_",[],!1),e},deepCopyStack:function(e){if(e&&"object"==typeof e)for(var r in e=Object.assign({},e))if(Array.isArray(e[r])){var t=e[r]=Array.from(e[r]);t.forEach(function(e,r){t[r]=Object.assign(e)})}return e},deepCopyAttrs:function(e,r){var t=e.fieldList;r=Object.assign({},r);for(var o in r){var a=r[o];t[o]&&"relation"==t[o].type&&Array.isArray(a)&&(a=r[o]=Array.from(a)).forEach(function(e,r){a[r]=Object.assign({},e),e.hasOwnProperty("records")&&e.records&&(e.records=Array.from(e.records)),e.hasOwnProperty("_indices")&&e._indices&&(e._indices=Array.from(e._indices))})}return r},addTo_Del:function(e,r,t){var o={index:t,data:r};(e._deleted=e._deleted||new Map).set(r.$.pK,o)},scExtd:function(e,r,t,o){var a="adapter"==e?store.adapter:store.serializer;if(r)return a.hasOwnProperty(r)?(Lyte.warn("LD14",e,r),{error:Lyte.getErrorMessage("LD14",e,r),extends:function(){}}):(a[r]="adapter"==e?new Adapter(t,o,r):new Serializer(t,o,r),a.application&&"application"!=r&&(a[r].$super=a.application,a.application.__extendedBy.push(r)),a.application||"application"==r||(a.__toAddSuper=a.__toAddSuper||{},a.__toAddSuper.hasOwnProperty("application")||(a.__toAddSuper.application=[]),a.__toAddSuper.application.push(r)),a[r])},initCB:function(e,r,t,o){var a=store.$.cbScp(r,t,e),i=o.args,s={};if(a)return s.data=store.$.cB(a,i),s},cB:function(e,r){return e.func.apply(e.scope,r.concat(e.name))},cbScp:function(e,r,t){var o,a=store[t],i=a.application;/^(adapter|serializer)$/.test(t)&&store.model.hasOwnProperty(e)&&store.model[e].extend&&(o=store.model[e].extend);for(var s=a&&a.hasOwnProperty(e)?a[e]:o&&a.hasOwnProperty(o)?a[o]:void 0;;){if(s&&s[r]&&"function"==typeof s[r])return{scope:s,func:s[r],name:r};if(!s||!s.$super)return i&&i[r]&&"function"==typeof i[r]?{scope:i,func:i[r],name:r}:void 0;s=s.$super}},comparePk:function(e,r){var t=e.$.pK,o=typeof t;if("string"==o||"number"==o)return t===r;if("object"==typeof t){var a=Object.keys(t).length,i=0;for(var s in t)t[s]===r[s]&&i++;return a===i}},getpKVal:function(e,r){var t=(r=r||e.$.model)._arrPk;if(1==t.length)return e[t[0]];var o={};return t.forEach(function(r){o[r]=e[r]}),o},unredoOp:function(e,r,t){var o,a;1==e?(o=r.undoStack,a=r.redoStack):(o=r.redoStack,a=r.undoStack);var i=[],s={};if(t?(i=Array.isArray(t)?t:[t]).forEach(function(e){if(o[e].length)for(var r=o._order_.length-1;r>=0;r--){var t=o._order_[r],a=t.indexOf(e);if(a>-1){t.splice(a,1),t.length||o._order_.splice(r,1);break}}}):i=o._order_&&o._order_.length?o._order_.pop():i,i.length){for(var n=0;n<i.length;n++){var d,l=i[n];"update"==(d=o[l].pop())._type?d.hasOwnProperty("val")?store.$.setData(r,l,d.val,void 0,s):d.hasOwnProperty("records")&&store.$.setData(r,l,d.records,void 0,s):1==e&&"propAdd"==d._type?"undefined"!=typeof Lyte?(s[l]={_type:"propDelete",val:r.record[l]},d.hasOwnProperty("val")&&store.$.setData(r,l,d.val,void 0,{}),Lyte.objectUtils?Lyte.objectUtils(r.record,"delete",l):delete r.record[l]):delete r.record[l]:2==e&&"propDelete"==d._type?(s[l]={_type:"propAdd"},store.$.setData(r,l,d.val,void 0,s)):"added"==d._type?r.record.$.get(l).remove(d.records,void 0,s):"removed"==d._type&&(store.$.rllBckRecArr([d],r.record,r.model,r.model.fieldList[l]),d._type="added",s[l]=d)}var c=Object.keys(s);for(n=0;n<c.length;n++){a[l=c[n]]=a[l]||[],a[l].push(s[l])}c.length&&a._order_.push(c)}},unregisterModel:function(e,r){var t=store.modelFor(e);if(t){t.data.length&&store.unloadAll(e,void 0,r);var o=t.extendedBy;if(o&&Object.keys(o).length)for(var a in o)store.unregisterModel(a,r);var i=t.extend;if(i)delete store.modelFor(i).extendedBy[e];delete store.model[e],store.__mdlPrx&&delete store.__mdlPrx[e]}else Lyte.warn("LD02","Model ",e)},getDsrzEmpData:function(e,r){if(e.hasOwnProperty("deserializeEmptyData"))return e.deserializeEmptyData;var t=store.$.getFromCB("serializer",r,"deserializeEmptyData");return void 0!==t&&t},updateFieldValidation:function(e,r,t,o){var a=e.data,i=e.fieldList;a.forEach(function(a){var s=i[r];if(t){var n=store.$.getDsrzEmpData(s,e._name),d=!n&&a[r];a.hasOwnProperty(r)&&(d||n)&&Lyte.Transform.hasOwnProperty(s.type)&&Lyte.Transform[s.type].hasOwnProperty("deserialize")&&(a[r]=Lyte.Transform[s.type].deserialize(a[r],r,e._name,store.$.getpKVal(a,e)))}if(!o){var l=!!(a.$.error&&a.$.error.hasOwnProperty(r)&&a.$.error[r].hasOwnProperty("value")),c=l?a.$.error[r].value:void 0;store.$.clrRecErr(a.$,r),l?store.$.validateField(a,r,s,void 0,{old:!0,value:c}):store.$.validateField(a,r,s,void 0)}l&&a.$.error&&0===Object.keys(a.$.error)&&a.$.set(r,c)})},validateRelatedRecord:function(e,r,t){var o=store.model[t.relatedTo].fieldList;if(t&&t.opts&&e&&e.hasOwnProperty(r)&&t.opts&&"record"==t.opts.serialize){if("belongsTo"==t.relType&&Lyte.isRecord(e[r]))return this.validateRecord(e[r],o);if("hasMany"==t.relType&&Array.isArray(e[r])){var a=!0,i=this;return e[r].forEach(function(e,r){Lyte.isRecord(e)&&!1===i.validateRecord(e,o)&&(a=!1)}),a}}},validateRecord:function(e,r,t){var o,a=!0,i={};for(var s in r)o=this.validateField(e,s,r[s],void 0,void 0,t,i),!0===a&&!1===o&&(a=!1);if(t){var n=t.apply(e.$,[i]);if(n&&"object"==typeof n)for(var d in n)store.$.setRecErr(e.$,d,n[d]);else if(1==n)return!0}return!(!1===a||!0===e.$.isError&&e.$.error&&Object.keys(e.$.error).length)},validateField:function(e,r,t,o,a,i,s){var n,d,l=a&&a.old?a.value:e[r],c=e.$;if(i&&c.error[r]&&(l=a=c.error[r].value,d={skipValidation:!0}),"relation"==t.type){if(!1===this.validateRelatedRecord(e,r,t))return!1,!1}else if(t.mandatory&&!e.$.error.hasOwnProperty(r)&&(void 0===l||""===l||Array.isArray(l)&&0===l.length))i?s[r]={code:"ERR02",message:Lyte.errorCodes.ERR02,value:l}:store.$.setRecErr(c,r,{code:"ERR02",message:Lyte.errorCodes.ERR02,value:l});else if(n=!0,a||e.hasOwnProperty(r)&&!e.$.error.hasOwnProperty(r)){var p=t;p.any&&Array.isArray(p)||(p=[p]);for(var f=p.length,y=!0,u=0;u<f;u++){var v=p[u];for(var h in v){var m=Lyte.checkProperty(h,l,r,v[h],v,e,void 0,Lyte.isRecord(e)?e.$.model._name:void 0);if(!0!==m){!0===y&&("object"==typeof m&&(m.value=l),y=m);break}}}!0!==y&&(i?s[r]=y:store.$.setRecErr(c,r,y),n=!1),a&&n&&store.$.setData(e.$,r,l,d),n&&store.$.clrRecErr(c,r)}},partialData:function(e,r,t,o,a,i){var s=e[r];if(!s||!Array.isArray(s))return!0;s.partial||store.$.defPar(s);var n=s.partial=s.partial||new Map;n.get(t)||n.set(t,{});var d=!1;switch(n.get(t).type){case"added":"removed"==o&&(n.delete(t),d=!0);break;case"removed":if("added"==o){if(e[r]._recMap)var l=e[r]._recMap.get(t);if(!l||Lyte.isRecord(l)&&!l.$.isDirty())n.delete(t),d=!0;else n.get(t).type="modified"}break;case"modified":case"updated":if("added"==o)break;default:if(i)n.delete(t),d=!0;else{var c={type:o};a&&(c.polymorphicType=a),n.set(t,c)}}return d&&!n.size?(n.size||store.$.deleteDeepNest(e,r,t),!0):void 0},removeParentNesting:function(e,r,t){var o=e.$.model,a=e.$.pK,i=o.relations;for(var s in i){i[s].forEach(function(i){var s,n,d,l,c=store.model[i.relatedTo];c&&((s=store.$.getBackwardRel(o,i,c))&&s.opts&&(n=s.opts.deepNest,d=s.opts.hasOwnProperty("serialize"),l=i.relKey&&i!=s?e[i.relKey]:store.$.getRelatedRecord(e,i.relatedTo,i.dummy?i.dummy:i.relKey)),d&&!t&&(l&&!Array.isArray(l)&&(l=[l]),Array.isArray(l)&&l.forEach(function(e){if(s.relKey)if("belongsTo"==s.relType&&e&&e.$)e.$.partial&&e.$.partial[s.relKey]&&e.$.partial[s.relKey].has(a)&&(e.$.partial[s.relKey].delete(a),e.$.partial[s.relKey].size||delete e.$.partial[s.relKey]),n&&store.$.deleteDeepNest(e,s.relKey,a);else if("hasMany"==s.relType){var t=e[s.relKey];if(Array.isArray(t)){if(t.partial&&t.partial.has(a)){var o=t.partial.get(a).type;"modified"==r?/^(modified|updated)$/.test(o)&&t.partial.delete(a):t.partial.delete(a)}n&&store.$.deleteDeepNest(e,s.relKey,a)}}})))})}},deleteDeepNest:function(e,r,t){var o=e.$.dN;o&&(o[r]&&void 0===t?delete o[r]:o[r]&&o[r].get(t)&&(o[r].delete(t),o[r].size||delete o[r]),Object.keys(o).length||(delete e.$.dN,e.$.isModified||e.$.isNew||store.$.removeParentNesting(e),store.$.changePersist(e,!0)))},updateJSON:function(e,r,t){var o={},a=r._arrPk,i=e.$._attributes;for(var s in i)o[s]=e[s];var n=t;1==t&&(n=store.$.isDirty(e,r.relations)||[]);for(var d=0;d<n.length;d++)o[n[d]]=e[n[d]];return a.forEach(function(r){o[r]=e[r]}),o},removeDeepNest:function(e){if(Lyte.isRecord(e)&&(e.$.dN&&Object.keys(e.$.dN).length)){e.$.dN={};var r=e.$.model.relations;for(var t in r){r[t].forEach(function(r){var t=r.opts;if(t&&(t.deepNest||"partial"==t.serialize)){var o=e[r.relKey];Array.isArray(o)?o.forEach(function(e){Lyte.isRecord(e)&&(store.$.removeDeepNest(e),e.$.isNew||e.$.isModified||e.$.dN&&(!e.$.dN||0!=Object.keys(e.$.dN).length)||store.$.removeParentNesting(e))}):Lyte.isRecord(o)&&(store.$.removeDeepNest(o),o.$.isNew||o.$.isModified||o.$.dN&&(!o.$.dN||0!=Object.keys(o.$.dN).length)||store.$.removeParentNesting(o))}})}}},addDeepNest:function(e,r,t,o,a,i){a=a||new Map;var s,n=r?store.model[e.$.model.extend]:e.$.model,d=e.$.pK,l=(t=t||"updated",n.relations);for(var c in l){l[c].forEach(function(r){var l,c,p,f,y=store.model[r.relatedTo];if(y&&(l=store.$.getBackwardRel(n,r,y),s=r.relKey&&l!==r?e[r.relKey]:store.$.getRelatedRecord(e,r.relatedTo,r.dummy?r.dummy:r.relKey))){var u,v=!1;if(!a.get(l)){var h=a.set(l,new Map);v=!0}if(h=a.get(l),(v||!h.get(s))&&(h.set(s,!0),l&&l.opts&&(c=l.opts.deepNest,p="partial"==l.opts.serialize,f=!!l.opts.serialize&&l.opts.serialize),"updated"==t&&"id"==f&&(u=!0),(!i||i&&p)&&!u&&(c&&store.$.makeDirty("dirty",s,t,l,d,a),f&&e&&s&&(!o||!o||o.model!==r.relatedTo||l.relKey!==o.relKey)))){var m=s;"hasMany"==l.relType?Array.isArray(m)?m.forEach(function(e){store.$.partialData(e,l.relKey,d,/^(added|removed)$/.test(t)?t:"modified")}):Lyte.isRecord(m)&&store.$.partialData(m,l.relKey,d,/^(added|removed)$/.test(t)?t:"modified"):Array.isArray(m)?m.forEach(function(e){"added"==t&&e&&e.$&&e.$.partial&&e.$.partial[l.relKey]&&e.$.partial[l.relKey].has(d)&&delete e.$.partial}):Lyte.isRecord(m)&&"added"==t&&m&&m.$&&m.$.partial&&m.$.partial[l.relKey]&&m.$.partial[l.relKey].has(d)&&delete m.$.partial}}})}n.extend&&this.addDeepNest(e,!0)},getRelatedRecord:function(e,r,t){if(e){var o=e.$._relationships;if(o[r]&&o[r][t])return o[r][t]}},makeDirty:function(e,r,t,o,a,i){if("id"!=o.opts.serialize||"updated"!=t){var s=o.relKey;Array.isArray(r)?r.forEach(function(e){store.$.setDeepNest(e,s,a,t,i)}):Lyte.isRecord(r)&&store.$.setDeepNest(r,s,a,t,i)}},setDeepNest:function(e,r,t,o,a){var i=e.$.dN=e.$.dN||{},s=i[r]=i[r]||new Map;s.has(t)||s.set(t,{});var n=s.get(t);switch(n.type){case"added":"removed"==o&&store.$.deleteDeepNest(e,r,t);break;case"removed":"added"==o&&store.$.deleteDeepNest(e,r,t),"modified"==o&&(n.type="updated");break;default:n.type=o,store.$.changePersist(e,!1),store.$.addDeepNest(e,void 0,void 0,void 0,a)}},isDirty:function(e,r,t,o){var a=[];for(var i in r)for(var s=r[i],n=0;n<s.length;n++){if((i=s[n]).opts&&i.opts.serialize){var d=i.relKey,l=i.relType,c=e[d],p=store.model[i.relatedTo];if(t&&p)if(t==store.$.getBackwardRel(o,i,store.model[i.relatedTo])&&o._name!=i.relatedTo)continue;if("record"==i.opts.serialize){if(store.$.isRelDirty(i,c,i)){a.push(d);continue}}else if("partial"==i.opts.serialize)if("hasMany"==l){if(c&&c.partial&&c.partial.size){a.push(d);continue}}else if(Lyte.isRecord(c)&&c.$.isModified||e&&e.$&&e.$.partial&&e.$.partial.hasOwnProperty(d)){a.push(d);continue}i.opts.deepNest&&e.$.dN&&e.$.dN[d]&&a.push(d)}}return a},isRelDirty:function(e,r,t){var o=e.relType,a=store.model[e.relatedTo],i=a.relations;if(!store.$.isEmpty(r))if("hasMany"==o&&Array.isArray(r)&&r.length){for(var s=r.length,n=0;n<s;n++)if(1==r[n].$.isModified)return!0;for(var d=0;d<s;d++){var l=r[d];if(this.isDirty(l,i,t,a).length)return!0}}else if("belongsTo"==o&&Lyte.isRecord(r)){if(1==r.$.isModified)return!0;if(this.isDirty(r,i,t,a).length)return!0}return!1},handleCachedResponse:function(e,r){var t=store.$.cachedBatch=store.$.cachedBatch||{},o=0;return(t[e]||[]).forEach(function(e,t){r.splice(e.ind+o++,0,e.data)}),delete t[e],r},addToCachedBatch:function(e){var r=store.$.currentBatch,t=store.$.cachedBatch=store.$.cachedBatch||{},o=t[r]=t[r]||[],a=(store.$.batch[r]||[]).length;o.push({ind:a,data:e})},establishToRelated:function(e,r){var t=e.$.model,o={};r.forEach(function(r){var a=store.$.peekRecord(r.model,r.pkVal);if(a){var i=a.$.model;store.$.getRelations(i,r.key,t,o),store.$.establishLink(o.forward,o.backward,a,e,void 0,!0)}})},checkObjAndAddToArr:function(e,r,t){for(var o=Object.keys(t).length,a=-1,i=e.length,s=0;s<i;s++){var n=e[s],d=0;for(var l in t)n[l]==r[l]&&d++;if(d==o)return a=s,void e.splice(s,1,r)}return-1==a&&e.push(r),a},addToRelate:function(e,r,t,o){var a=t.forward.relatedTo,i=store.$.toRelate[a]=store.$.toRelate[a]||new Map;i.has(o)||i.set(o,[]);var s=i.get(o),n={model:e,pkVal:r.$.pK,key:t.forward.relKey};s.push(n)},addOnSave:function(e,r,t,o,a,i){store.$.onSave=store.$.onSave||{};var s=store.$.onSave[e]=store.$.onSave[e]||{},n=s[r[a]]=s[r[a]]||{},d=r[t]||[];"belongsTo"==o.relType&&(d=Array.isArray(r[t])?r[t]:[r[t]]),d.forEach(function(e){var r=n[o.relKey]=n[o.relKey]||[];store.$.checkAndAddToArray(r,e[i])})},addToIDBonSave:function(e,r){var t=store.model[e].fieldList,o=store.$.onSave?store.$.onSave[e]:void 0;if(o){var a=store.model[e]._pK,i=r&&a?o[r[a]]:void 0;if(i){for(var s in i){var n=i[s],d=t[s].relatedTo;n.forEach(function(e){var r=store.$.peekRecord(d,e);if(r){var t=r.$.parent;if(Lyte.isRecord(t)){var o=t.$.model,a=o._name,i=o._pK;store.$.checkAndAddToIDBQ(a,"updateRecord",store.$.peekRecord(a,t[i]).$.toJSON(!0))}else store.$.checkAndAddToIDBQ(d,"updateRecord",store.$.peekRecord(d,e).$.toJSON(!0))}})}store.$.removeOnSave(e,r[a])}}},removeOnSave:function(e,r){var t=store.$.onSave?store.$.onSave[e]:void 0;t&&t[r]&&delete t[r]},checkAndAddToIDBQ:function(e,r,t){var o={model:e,type:r,data:t};(store.$.idbQ2[e]=store.$.idbQ2[e]||[]).push(o)},checkAndRemoveKey:function(e,r,t){for(var o in e){var a=r[o];a&&"relation"==a.type&&(t&&!this.checkPresenceInArray(t,o)?delete e[o]:this.removeNotNeededKeys(a.relatedTo,e[o]))}},removeNotNeededKeys:function(e,r,t){var o=store.model[e],a=o.fieldList,i=t?t.deserializeKeys:void 0;if(o){var s=this;Array.isArray(r)?r.forEach(function(e){s.checkAndRemoveKey(e,a,i)}):this.checkAndRemoveKey(r,a,i)}return r},getIDBObj:function(e,r,t,o,a,i){if(e&&e.hasOwnProperty("idb"))return"function"==typeof e.idb?e.idb.apply(e,[{model:i||e._name,type:t,queryParams:r,key:o,customData:a}]):e.idb},idbQ2Push:function(e,r,t,o,a,i,s){try{var n=store.model[e],d=store.$.getIDBObj(n,t,o,a,s);if(d){var l={model:e,type:o,customData:s};l.queryCache=d.queryCache;n._pK;var c=store.$.idbQ2[e]=store.$.idbQ2[e]||[];switch(o){case"action":return void delete c[o];case"update":case"create":l.data=[],r.forEach(function(e){l.data.push(Lyte.isRecord(e)?e.$.toJSON(void 0,!0):e)});break;case"updateRecord":case"createRecord":case"delete":l.data=r;break;case"destroyRecord":case"deleteRecord":l.id=r;break;case"findRecord":l.key=a;var p=r[0].$.toJSON("idb");(f={})[e]=p,i&&(f.meta=i),!0===d.queryCache&&(l.queryParams=t),l.data=f;break;case"findAll":var f;p=[];r.forEach(function(e){p.push(e.$.toJSON("idb"))}),(f={})[e]=p,i&&(f.meta=i),!0===d.queryCache&&(l.queryParams=t),l.data=f;break;case"pushPayload":Lyte.isRecord(r)&&(r=r.$.toJSON("idb")),l.data=r}c.push(l)}}catch(e){Lyte.error("Error while adding to IDBQueue ",e)}},isEmpty:function(e){return void 0==e||""===e||null==e},isEmptyObj:function(e){return null!==e&&"object"==typeof e&&0==Object.keys(e).length},isEmptyArray:function(e){return!(!Array.isArray(e)||0!=e.length)},registerField:function(e,r,t,o){var a=e.fieldList[r]?Object.assign({},e.fieldList[r]):void 0;if("observer"==t.type)o.push(t);else if("callBack"==t.type){t.observes&&o.push(t.observes);for(var i=t.properties,s=0;s<i.length;s++)"didLoad"===i[s]||"init"===i[s]?(e.didLoad||(e.didLoad=[]),e.didLoad.push(t.value)):"add"!==i[s]&&"change"!==i[s]||e.on(i[s],t.value);"didLoad"==r&&(e.didLoad||(e.didLoad=[]),e.didLoad.push(t.value))}else if("didLoad"==r)e.didLoad||(e.didLoad=[]),e.didLoad.push(t);else if(Object.keys(t).length){if(t.primaryKey&&(e.fieldList.id&&0==e.fieldList.id.defined&&delete e.fieldList.id,t.hasOwnProperty("default")&&(Lyte.warn("LD23",e._name,r),delete t.default),void 0!=e._pK?(e._pK=e._pK+","+r,e.isComposite=!0):e._pK=r,t.baseKey)){if(e.bK)return void Lyte.warn("LD26");e.bK=r}if(e.fieldList.hasOwnProperty(r));if(e.fieldList[r]=t,a&&e._fldGrps&&(a.hasOwnProperty("default")&&delete e._fldGrps.default[r],a.hasOwnProperty("watch")&&delete e._fldGrps.watch[r],a.opts&&a.opts.hasOwnProperty("inherit")&&delete e._fldGrps.inherit[r]),t.hasOwnProperty("default")&&(e._fldGrps.default[r]=t),t&&t.opts&&t.opts.hasOwnProperty("inherit")&&(e._fldGrps.inherit[r]=t),t.hasOwnProperty("watch")&&(1==t.watch||Array.isArray(t.watch))&&/^(array|object)$/.test(t.type)&&(e._fldGrps.watch[r]=t),Lyte.Transform[t.type]){var n=Lyte.Transform[t.type];(/^(array|object)$/.test(n.extends)&&n.hasOwnProperty("properties")||n.hasOwnProperty("items"))&&(e._fldGrps.nested_prop[r]=t)}}if("relation"===t.type){t.relKey=r;var d=t.relatedTo,l=e.fieldList[r];e.relations[d]||(e.relations[d]=[]);var c={};c.relKey=l.relKey,store.$.checkObjAndAddToArr(e.relations[t.relatedTo],l,c),"hasMany"==t.relType&&(e._fldGrps.hasMany[r]=t),t.hasOwnProperty("opts")&&t.opts.hasOwnProperty("inverse")&&(e._fldGrps.inverse[d]=t)}},setError:function(e,r,t){e.$.hasOwnProperty("error")?Array.isArray(r)?r.forEach(function(r){store.$.cmpSet(e.$.error,r,t)}):store.$.cmpSet(e.$.error,r,t):Lyte.error("LD03",e,r)},unRegCb:function(e,r){var t=store[e][r];if(t){var o=t.__extendedBy;if(o.length){if(store[e].__toAddSuper=store[e].__toAddSuper||{},store[e].__toAddSuper[r]?o.forEach(function(t){store[e].__toAddSuper[r].push(t)}):store[e].__toAddSuper[r]=o.slice(),o.forEach(function(r){store[e][r].$super=void 0}),store[e].application&&"application"!=r){var a=store[e].application;o.forEach(function(r){store[e][r].$super=a,store[e].application.__extendedBy.push(r)})}store[e].application||(store[e].__toAddSuper.application?o.forEach(function(r){store[e].__toAddSuper.application.push(r)}):store[e].__toAddSuper.application=o.slice())}t.$super&&t.$super.__extendedBy.splice(t.$super.__extendedBy.indexOf(r),1),delete store[e][r]}else Lyte.error("LD02",e,r)},eventListeners:{add:function(e,r,t){return e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push({f:t}),r+"-"+(e.events[r].length-1)},remove:function(e,r){var t;if(r)if(/^(add|remove|change)$/.test(r))t=r,e.events&&e.events[t]&&delete e.events[t];else{var o=r?r.split("-"):void 0;if(o){var a=e.events[o[0]];a&&o[1]&&(a[o[1]]=null)}}else{var i=e.events;for(var s in i)i&&i[s]&&delete i[s]}},emit:function(e,r,t){for(var o=e.events&&e.events[r]?e.events[r]:[],a=0;a<o.length;a++)o[a]&&o[a].f.apply(null,t)}},extendCallback:function(e,r,t){var o,a,i=e[r];if(t&&"string"==typeof t&&((a=i[t])||(i.__toAddSuper=i.__toAddSuper||{},i.__toAddSuper.hasOwnProperty(t)||(i.__toAddSuper[t]=[]),i.__toAddSuper[t].push(this.__name))),a&&a.is==r&&(!this.$super||"application"==this.$super.__name)){if(this.$super=a,a.__extendedBy.push(this.__name),i.application){var s=i.application.__extendedBy.indexOf(this.__name);s>-1&&i.application.__extendedBy.splice(s,1)}if((o=i.__toAddSuper)&&o.application){var n=o.application.indexOf(this.__name);n>-1&&i.__toAddSuper.application.splice(n,1)}}return this},super:function(){var e=this.$super,r=arguments[0][0][arguments[0][0].length-1],t=[],o=arguments[0][0],a=e[r];if("function"==typeof a){for(var i in delete o[o.length-1],o)o.hasOwnProperty(i)&&t.push(o[i]);return a.apply(e,t)}if(a)return a},extendModel:function(e,r){var t=r||this;if(e&&store.model[e]){var o=Object.assign({},store.model[e].fieldList);for(var a in o)"relation"==o[a].type&&delete o[a];var i={},s="id"==t._pK&&0==t.fieldList.id.defined;for(var a in o){var n=o[a];s&&n.primaryKey&&n.defined;if(t.fieldList.hasOwnProperty(a)&&t._fldGrps){var d=t.fieldList[a];d.hasOwnProperty("default")&&delete t._fldGrps.default[a],d.hasOwnProperty("watch")&&delete t._fldGrps.watch[a]}n.hasOwnProperty("default")&&(t._fldGrps.default[a]=n),n.hasOwnProperty("watch")&&1==n.watch&&/^(array|object)$/.test(n.type)&&(t._fldGrps.watch[a]=n),n.primaryKey?i[a]=n:t.fieldList[a]=n}var l=Object.keys(i),c=l.length;if(s&&c){for(var a in delete t.fieldList.id,i)t.fieldList[a]=i[a];1==c?(t._pK=l[0],t._arrPk=Array.from(l)):(t.isComp=!0,t._arrPk=Array.from(l),t._pK=t._arrPk.toString())}var p=t._name;if(store.model[p].extend=e,store.model[e].extendedBy=store.model[e].extendedBy||{},store.model[e].extendedBy[p]=!0,store.model[e].actions){var f=t.actions=t.actions||{};for(var a in store.model[e].actions)f.hasOwnProperty(a)||(f[a]=store.model[e].actions[a])}}},demoLishObserverBindings:function(e,r,t){for(key in t||(t=e),r){if(e[key]instanceof Object){if(t&&e[key]._setterScope){var o=e[key]._setterScope.indexOf(t);-1!=o&&e[key]._setterScope.splice(o,1)}Object.keys(r[key]).length&&this.demoLishObserverBindings(e[key],r[key],e)}if(e._setterScope&&e!=t){var a=e._setterScope.indexOf(t);-1!=a&&e._setterScope.splice(a,1)}}},establishObserverBindings:function(e,r,t){for(key in t||(t=e),r){if(e[key]instanceof Object)e[key]._bindings||store.$.defProp(e[key],"_bindings",new Set,!1,!0),t&&!e[key]._setterScope&&store.$.defProp(e[key],"_setterScope",[]),-1==e[key]._setterScope.indexOf(t)&&e[key]._setterScope.push(t),e[key]._bindings.add(r[key]),Object.keys(r[key]).length&&this.establishObserverBindings(e[key],r[key],e);e._setterScope||(store.$.defProp(e,"_setterScope",[]),e._setterScope.push(e))}},setData:function(e,r,t,o,a,i,s,n){var d,l={emit:!1,attr:[],oldRec:{}},c=e.model,p=!1,f=e.record;if(s&&r){var y=e.model._fldGrps.inherit;for(var u in y)if(e.record[y[u].relKey]&&r[y[u].relKey])if("belongsTo"==y[u].relType)e.model._arrPk.forEach(function(e){delete r[y[u].relKey][e]}),this.setData(e.record[y[u].relKey].$,r[y[u].relKey],void 0,void 0,void 0,i,!0),r[y[u].relKey]=e.record[y[u].relKey].$.pK;else for(var v=r[y[u].relKey].length-1;v>=0;v--)e.model._arrPk.forEach(function(e){delete r[y[u].relKey][v][e]}),this.setData(e.record[y[u].relKey][v].$,r[y[u].relKey][v],void 0,void 0,void 0,i,!0),r[y[u].relKey][v]=e.record[y[u].relKey][v].$.pK}if(r&&"object"==typeof r)for(var h in d=[],o=t,r)d.push(h),this.setValue(e,h,r[h],o,l,i,void 0,n),c&&c._properties&&c._properties.hasOwnProperty(h)&&(p=!0);else d=r,this.setValue(e,r,t,o,l,i),c&&c._properties&&c._properties.hasOwnProperty(r)&&(p=!0);return e.emit("set",[e.record,d]),e.model.emit("set",[c._name,e.record,d]),store.emit("set",[c._name,e.record,d]),p&&store.$.establishObserverBindings(f,c._properties),!i&&l.emit&&store.$.changeCallbck(f,l,a),f},changeCallbck:function(e,r,t){var o=[e,r.attr],a=e.$;if(a.emit("change",o),a.model.emit("change",o),store.emit("change",[a.model._name,a.record,r.attr]),t)for(var i in r.oldRec)t[i]=r.oldRec[i];else{for(var s=0;s<r.attr.length;s++){i=r.attr[s];a.undoStack[i]=a.undoStack[i]||[],a.undoStack[i].push(r.oldRec[i])}a.undoStack._order_.push(r.attr)}},setValue:function(e,r,t,o,a,i,s,n){var d=e.model,l=d._pK,c=e.record;if(r!=d._pK){var p=d.fieldList[r],f=p&&p.opts?1==p.opts.watch:void 0;c.hasOwnProperty(r),c[r];if(!p)return void store.$.cmpSet(c,r,t,void 0,!0);if(!p.mandatory||void 0!=t&&null!=t&&""!==t){if(p.relType){var y,u,v=p.relType,h={},m=store.modelFor(p.relatedTo),$=m._pK,g=m._pK,b=(_=m.isComp)||m.fieldList[$].type,_=m.isComp,R=($=m._pK,b=_?"object":m.fieldList[$].type,p&&p.opts?p.opts.polymorphic:void 0);if(this.getRelations(d,p.relKey,m,h),c[r]&&"hasMany"==v){if(y=[],c[r].forEach(function(e){y.push(e.$.pK)}),c[r]===t)return;if(Array.isArray(t)&&t.length===c[r].length){for(var k,O=t.length,w=0,P=0;P<O&&(k=t[P],Lyte.isRecord(k)?u=k:k&&typeof k==b?u=store.$.peekRecord(k._type?k._type:p.relatedTo,k):k&&(_||R&&k._type)&&(u=store.$.peekRecord(k._type?k._type:p.relatedTo,store.$.getpKVal(k,store.modelFor(k._type?k._type:p.relatedTo)))),Lyte.isRecord(u)&&u.$.record===c[r][P]);P++)w++;if(w&&w==O)return}store.$.addOnSave(d._name,c,r,p,l,g),Array.from(c[r]).forEach(function(e){store.$.demolishLink(e,g,c,h.forward.relKey,void 0,void 0,void 0,!0),null!==h.backward&&store.$.demolishLink(c,d._pK,e,h.backward.relKey,h.forward)})}else if(c[r]&&Lyte.isRecord(c[r])&&"belongsTo"==v){if(y=c[r].$.pK,Lyte.isRecord(t)?u=t:t&&typeof t==b?u=store.$.peekRecord(t._type?t._type:p.relatedTo,t):t&&(_||R&&t._type)&&(u=store.$.peekRecord(t._type?t._type:p.relatedTo,store.$.getpKVal(t,store.modelFor(t._type?t._type:p.relatedTo)))),Lyte.isRecord(u)&&u.$.record===c[r])return;store.$.addOnSave(d._name,c,r,p,l,g);var A=c[r];store.$.demolishLink(A,g,c,h.forward.relKey,void 0,void 0,void 0,!0),null!==h.backward&&store.$.demolishLink(c,d._pK,A,h.backward.relKey,h.forward),store.$.cmpSet(c,r,{},o,!0)}if("hasMany"==v&&store.$.isEmpty(t)){var L=c[r]&&c[r].partial?c[r].partial:void 0;store.$.cmpSet(c,r,[],o,!0),L&&store.$.defProp(c[r],"partial",L),store.$.establishObserverBindings(c,c.$.model._properties),store.$.defArrUtls(c[r]),store.$.defPolyUtls(c[r]),store.$.defUtls(c[r],m,c,r)}if(Array.isArray(t)){if("belongsTo"==v)return this.revertToOldVal(c,r,y,h),void store.$.setRecErr(e,r,"ERR21",t)}else t=[t];var j=[];for(P=0;P<t.length;P++)if(!(this.isEmpty(t[P])||"belongsTo"==v&&this.isEmptyObj(t[P])||"hasMany"==v&&this.isEmptyArray(t[P]))){var S=t[P],K=t[P]&&t[P]._type?t[P]._type:p.relatedTo;if(!_&&t[P]&&typeof t[P]===b){if(void 0==(S=store.$.peekRecord(t[P]._type?t[P]._type:p.relatedTo,t[P])))this.addToRelate(d._name,c,h,t[P]);else if(S.$&&S.$.isError){j.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},S)});continue}}else if(t[P]&&"object"==typeof t[P]){if(S.$&&S.$.isError){j.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},S)});continue}if(Lyte.isRecord(S))S=S.$.record;else if(R&&t[P]&&t[P]._type?S=store.$.peekRecord(t[P]._type,store.$.getpKVal(t[P],store.modelFor(t[P]._type))):_&&(S=store.$.peekRecord(t[P]._type?t[P]._type:p.relatedTo,t[P]))||(S=this.newRecord(K,t[P],o?o.skipValidation:void 0)),S.$.isError){j.push({code:"ERR15",data:t[P],message:Lyte.errorCodes.ERR15,error:Object.assign({},S)});continue}}1!=(C=this.establishLink(h.forward,h.backward,c,S,void 0,!!i||void 0))?j.push({code:C,data:t[P],message:Lyte.errorCodes[C]}):store.$.addOnSave(d._name,c,r,p,l,g)}if(j.length&&j.length==t.length)return this.revertToOldVal(c,r,y,h),void("belongsTo"==p.relType?store.$.setRecErr(e,r,j[0]):store.$.setRecErr(e,r,j));if(j.length>1?store.$.setRecErr(e,r,j):store.$.clrRecErr(e,r),!i){var E=c.$._attributes;E.hasOwnProperty(r)||(E[r]=[]),E[r].push({_type:"changed",records:y}),a.emit=!0,a.attr.push(r);var D={};D.records=y,D._type="update",a.oldRec[r]=D;var T=c.$.getInitialValues(r),C=!0;if(T&&Array.isArray(c[r])&&T.length==c[r].length){C=!1;for(P=0;P<T.length;P++)if(!store.$.comparePk(c[r][P],T[P])){C=!0;break}}C||delete E[r]}}else if(t!==c[r]){if(!o||o&&!0!==o.skipValidation){(q=p).any&&Array.isArray(q)||(q=[q]);var M=q.length,N=!0;for(P=0;P<M;P++){var x=q[P];for(var B in x){!0!==(Q=Lyte.checkProperty(B,t,r,x[B],x,c,void 0,d._name))&&!0===N&&("object"==typeof Q&&(Q.value=t),N=Q)}}if(!0!==N)return void store.$.setRecErr(e,r,N)}if(i){var z=!1;if(Lyte.Transform[p.type]){var F=Lyte.Transform[p.type];(F.hasOwnProperty("properties")||F.hasOwnProperty("items"))&&(z=!0)}(f&&/^(array|object)$/.test(p.type)||z)&&Lyte.establishObjectBinding(c,r,!0),store.$.cmpSet(c,r,t,o,!0)}else store.$.estAttrs(c,r,t,a,s,o)}else if(t===c[r]&&c.$.isError&&c.$.error[r]){var q,I=!0;(q=p).any&&Array.isArray(q)||(q=[q]);for(M=q.length,N=!0,P=0;P<M;P++){x=q[P];for(var B in x){var Q;!0!==(Q=Lyte.checkProperty(B,t,r,x[B],x,c,void 0,d._name))&&(N=!1)}}!0!==N&&(I=!1),I&&store.$.clrRecErr(e,r)}}else store.$.setRecErr(e,r,{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t});store.$.checkAttrs(c)}else c[r]!==t&&store.$.setRecErr(e,r,"ERR01",t)},estAttrs:function(e,r,t,o,a,i){var s=e.$._attributes,n=e.$.model,d=s[r],l=s.hasOwnProperty(r);l?(a&&Lyte.cmpData(l?d:a.data,e[r])||t&&"object"==typeof t&&!a&&store.adapter.$.compareObjects(d,t)||d==t)&&delete s[r]:s[r]=a?a.data:this.createCopy(e[r]);var c=e.hasOwnProperty(r),p=a?a.data:e[r];if(!a){var f={};n._properties&&n._properties.hasOwnProperty(r)&&(f[r]=n._properties[r],store.$.demoLishObserverBindings(e,f)),store.$.cmpSet(e,r,t,i,!0)}store.$.clrRecErr(e.$,r),e.$.srtObs&&store.$.changeRelPkMaps(e,void 0,void 0,"sort",r);var y={_type:"update"};y.val=p,c||(y._type="propAdd"),o.emit=!0,o.attr.push(r),o.oldRec[r]=y},checkAttrs:function(e){var r=e.$.model;Object.keys(e.$._attributes).length?(store.$.cmpSet(e.$,"isModified",!0),store.$.changePersist(e,!1),store.$.addDeepNest(e),this.checkAndAddToArray(r.dirty,e.$.pK)):(store.$.cmpSet(e.$,"isModified",!1),store.$.changePersist(e,!0),e.$.isNew||e.$.hasOwnProperty("dN")&&(!e.$.dN||Object.keys(e.$.dN).length)||store.$.removeParentNesting(e),e.$.isNew||this.deleteFromArray(r.dirty,e.$.pK))},checkForCorrectRelation:function(e,r){var t=e.relatedTo;return!!Lyte.isRecord(r)&&(e.opts&&e.opts.polymorphic?!!r.$.model.extend&&e.relatedTo===r.$.model.extend:!(!e||!r)&&t===r.$.model._name)},removeKeys:function(e,r){for(var t in r)if(e.hasOwnProperty(t)){var o=e[t];("belongsTo"===o.type||"hasMany"===o.type&&r[t])&&this.removeNotDefinedKeys(o.relatedTo,r[t],!(!o.opts||!o.opts.polymorphic)||void 0)}else delete r[t]},removeNotDefinedKeys:function(e,r,t){var o=e.fieldList;if(Array.isArray(r))for(var a=0;a<r.length;a++){var i=r[a];this.removeKeys(t&&Lyte.isRecord(i)?i.$.model.fieldList:o,i)}else this.removeKeys(t&&Lyte.isRecord(r)?r.$.model.fieldList:o,r)},add:function(e,r,t,o){var a,i=this.record.$.record,s=i.$.model,n=this.key,d=s.fieldList[n],l={};store.$.getRelations(s,d.relKey,store.modelFor(d.relatedTo),l),Array.isArray(e)||(e=[e]);var c=store.modelFor(l.forward.relatedTo),p=c._pK,f=[],y=[],u=c.isComp;i.$._attributes.hasOwnProperty(n)&&i.$._attributes[n].length&&(a=i.$.getInitialValues(n));for(var v=0;v<e.length;v++){var h=e[v];if(u&&"object"==typeof h&&Object.keys(h).length===c._arrPk.length){if(this.polymorphic&&!r){f.push({code:"ERR22",data:e[v],message:Lyte.errorCodes.ERR22});continue}h=store.$.peekRecord(r||l.forward.relatedTo,h)}if(!u&&c.fieldList[p].type.toLowerCase()==typeof h||u&&"object"==typeof h&&Object.keys(h).length===c._arrPk.length){if(this.polymorphic&&!r){f.push({code:"ERR22",data:e[v],message:Lyte.errorCodes.ERR22});continue}h=store.$.peekRecord(r||l.forward.relatedTo,h)}else"object"!=typeof h||Lyte.isRecord(h)||(h=store.$.newRecord(h._type?h._type:r||d.relatedTo,h,t?t.skipValidation:void 0));var m=this.polymorphic&&r?r:h&&h._type?h._type:void 0;if(void 0==h)f.push({code:"ERR13",data:e[v],message:Lyte.errorCodes.ERR13});else if(h.$&&h.$.isError)f.push({code:"ERR15",data:e[v],message:Lyte.errorCodes.ERR15,error:h});else if(Lyte.isRecord(h)&&!store.$.hasDuplicateRelation(h,i[n],p,m,c)){h=h.$.record;var $=store.$.establishLink(l.forward,l.backward,i,h);1!=$?f.push({code:$,data:e[v],message:Lyte.errorCodes[$]}):y.push(h)}}if(y.length){var g=i.$._attributes;g[n]?store.$.hasRecordsArrayChanged(i,n,a)?g[n].push({_type:"added",records:y}):(delete i.$._attributes[n],Object.keys(i.$._attributes).length||(store.$.cmpSet(i.$,"isModified",!1),store.$.changePersist(i,!0),delete g[n],i.$.isNew||(store.$.deleteFromArray(s.dirty,i.$.pK),(!i.$.dN||i.$.dN&&!Object.keys(i.$.dN).length)&&store.$.removeParentNesting(i)))):(g[n]=[{_type:"added",records:y}],store.$.cmpSet(i.$,"isModified",!0),store.$.changePersist(i,!1),store.$.checkAndAddToArray(s.dirty,i[s._pK])),store.$.emit("change",i,[n]);var b={_type:"added",records:y};if(o)o[n]=b;else{i.$.undoStack[n]=i.$.undoStack[n]||[],i.$.undoStack[n].push(b),i.$.undoStack._order_.push([n])}}return f.length>0?store.$.setRecErr(i.$,n,f):store.$.clrRecErr(i.$,n),i},remove:function(e,r,t){var o,a=this.record.$.record,i=a.$.model,s=this.key,n=i.fieldList[s],d={};store.$.getRelations(i,n.relKey,store.modelFor(n.relatedTo),d),Array.isArray(e)||(e=[e]);var l,c=store.modelFor(d.forward.relatedTo),p=c._pK,f=c.isComp,y=[],u=[],v=[];a.$._attributes.hasOwnProperty(s)&&a.$._attributes[s].length&&(o=a.$.getInitialValues(s));for(var h=0;h<e.length;h++){var m,$=e[h];if(!f&&c.fieldList[p].type.toLowerCase()==typeof e[h]||f&&"object"==typeof $&&Object.keys($).length===c._arrPk.length){if(1==this.polymorphic&&!r){y.push({code:"ERR22",data:e[h],message:Lyte.errorCodes.ERR22});continue}l=store.$.peekRecord(r||d.forward.relatedTo,e[h]),m=r}else Lyte.isRecord(e[h])&&(l=e[h].$.record,m=r||(l&&l._type?l._type:void 0));if(l){var g=store.$.getIndex(a[s],p,l.$.get(p),m);store.$.demolishLink(l,p,store.$.peekRecord(i._name,a.$.pK),d.forward.relKey,void 0,void 0,void 0,!0),null!=d.backward&&store.$.demolishLink(a,i._pK,store.$.peekRecord(m||d.forward.relatedTo,l.$.pK),d.backward.relKey,d.forward),u.push(l),v.push(g)}}if(u.length){var b=a.$._attributes;b[s]?store.$.hasRecordsArrayChanged(a,s,o)?b[s].push({_type:"removed",records:u,_indices:v}):(delete a.$._attributes[s],Object.keys(a.$._attributes).length||(store.$.cmpSet(a.$,"isModified",!1),store.$.changePersist(a,!0),delete b[s],a.$.isNew||(store.$.deleteFromArray(i.dirty,a.$.pK),(!a.$.dN||a.$.dN&&!Object.keys(a.$.dN).length)&&store.$.removeParentNesting(a)))):(b[s]=[{_type:"removed",records:u,_indices:v}],store.$.cmpSet(a.$,"isModified",!0),store.$.changePersist(a,!1),store.$.checkAndAddToArray(i.dirty,a[i._pK])),store.$.emit("change",a,[s]);var _={_type:"removed",records:u,_indices:v};if(t)t[s]=_;else{a.$.undoStack[s]=a.$.undoStack[s]||[],a.$.undoStack[s].push(_),a.$.undoStack._order_.push([s])}}y.length>0?store.$.setRecErr(a.$,s,y):store.$.clrRecErr(a.$,s)},filter:function(e,r,t){var o=0;for(var a in r)e[a]===r[a]&&o++;if(o===t)return!0},filterBy:function(e){for(var r=Object.keys(e).length,t=[],o=0;o<this.length;o++)store.$.filter(this[o],e,r)&&t.push(this[o]);return t.filterBy||(store.$.defArrUtls(t),store.$.defUtls(t,this.model)),t},idbSerialize:function(e,r,t,o,a,i){var s=r.forward.relatedTo,n=t._pK,d=o._pK;Array.isArray(e)?e.forEach(function(t,l){Lyte.isRecord(t)&&t.$.inIDB?e[l]=t[d]:store.$.checkPresenceInArray(store.$.recStack[s],t[d])?e[l]=t[d]:(store.$.removeBackwardRel(t,r,n,a,!0),store.$.removeSelfCircularReference(o._name,t,i))}):e&&Lyte.isRecord(e)&&(Lyte.isRecord(e)&&e.$.inIDB?e[r.relKey]=e[d]:this.checkPresenceInArray(store.$.recStack[s],e[d])?e[r.relKey]=e[d]:(this.removeBackwardRel(e,r,n,a,!0),this.removeSelfCircularReference(o._name,e,i)))},idSerialize:function(e,r,t,o,a){var i=r.forward.opts?r.forward.opts.polymorphic:void 0,s=r.forward.relKey,n=e[s=r.forward.relKey],d=store.model[r.backward.relatedTo],l=store.model[r.forward.relatedTo],c=store.$.getpKVal(e,d);if(Array.isArray(n))if(i)e[s]=this.polymorphicToJSON(r.forward,n);else{var p=[];if(o)var f=o[s]=o[s]||[];n.forEach(function(e){if(e.$&&e.$.isNew&&1!=t&&"state"!=t)!0,store.$.rSerialize(e,r,l,d._pK,c,t,f,a),p.push(e);else{if(f){var o={},i="related";e.$.isDeleted&&(i="removed"),store.$.defProp(o,"$",{});var s=o.$,n=r.forward.relatedTo;Object.defineProperties(s,{pkVal:{value:e.$.pK},type:{value:i},model:{value:n},record:{value:store.$.peekRecord(n,e.$.pK)}}),e.$.isDeleted&&(o.$.onlyDetach=!0),f.push(o)}e.$&&!e.$.isDeleted&&p.push(e.$.pK&&"object"==typeof e.$.pK?Object.assign({},e.$.pK):e.$.pK)}}),e[s]=p}else if(n&&Lyte.isRecord(n))if(n.$.isNew&&1!=t&&"state"!=t){if(o)f=o[s]=o[s]||{};f=store.$.rSerialize(n,r,l,d._pK,c,t,f,a),o[s]=f}else i?e[s]=this.polymorphicToJSON(r.forward,n):n.$.isDeleted||(e[s]=n.$.pK&&"object"==typeof n.$.pK?Object.assign({},n.$.pK):n.$.pK)},recordSerialize:function(e,r,t,o,a,i,s,n,d,l){var c=a._pK;if(Array.isArray(t)){if(0==t.length)return delete e[r],0;t=Array.from(t);var p=d[r]=d[r]||[];if(t.length){for(var f=[],y=0;y<t.length;y++)t[y]&&Lyte.isRecord(t[y])&&(this.rSerialize(t[y],o,i,c,s,n,p,l),t[y].$.isDeleted&&(p[y]&&p[y].$&&(p[y].$.onlyDetach=!0),t.splice(y,1),y--));if(f.length)for(var u=0;u<f.length;u++)t.splice(u,1)}}else if(t&&Lyte.isRecord(t)){p=d[r]=d[r]||{};p=this.rSerialize(t,o,i,c,s,n,p,l),d[r]=p}},rSerialize:function(e,r,t,o,a,i,s,n){var d=r.forward.relatedTo,l=(store.model[r.backward.relatedTo],r.forward.opts?r.forward.opts.polymorphic:void 0);if(this.removeBackwardRel(e,r,o,a),s){var c,p={},f=e.$.isNew?"added":e.$.isModified?"modified":e.$.isDeleted?"removed":"related";l&&(c=e.$.model._name,e.$.polymorphicType=c,t=store.model[c]),store.$.defProp(p,"$",{});var y=p.$,u=l?c:d;Object.defineProperties(y,{pkVal:{value:e.$.pK},type:{value:f},model:{value:u},record:{value:store.$.peekRecord(u,e.$.pK)}}),Array.isArray(s)&&s.push(p)}return this.removeSelfCircularReference(t._name,e,i,void 0,p,n),p},partialSerialize:function(e,r,t,o,a,i,s,n,d,l){var c=o.forward,p=a._pK,f=o.forward.relatedTo,y=o.forward.opts?o.forward.opts.polymorphic:void 0;if("hasMany"==c.relType)if(t&&t.partial){var u=t.partial,v=i._pK;if(d&&(k=d[r]=d[r]||[],store.$.defProp(k,"partial",!0)),u){var h,m,$=[],g=this;u.forEach(function(e,r){if(m=r,/^(added|modified)$/.test((h=e).type)){var a="related",d=store.$.getIndex(t,v,m,void 0,store.model[f]);if(-1!=d){var c,u,b,_=t[d];_&&_.$&&(u=Object.assign({},_.$),_=Object.assign({},_),store.$.defProp(_,"$",u)),c=_,y&&_&&(b=_._type?_._type:_.$.model._name,i=store.model[b]);var R=store.$.peekRecord(i._name,m);if(g.removeBackwardRel(_,o,p,s),_.$.isNew)a="added";else if(_.$.isModified){a="modified";var O=store.$.isDirty(R,i.relations);c=store.$.updateJSON(_,i,O)}else{O=store.$.isDirty(R,i.relations);c=store.$.updateJSON(_,i,O)}if(k){var w={};store.$.defProp(w,"$",{});var P=w.$,A=y?b:f;Object.defineProperties(P,{pkVal:{value:m},type:{value:a},model:{value:y?b:f},record:{value:store.$.peekRecord(A,m)}}),k.push(w)}g.removeSelfCircularReference(i._name,c,n,void 0,w,l),Lyte.isRecord(c)?c.$.partialType=h.type:(store.$.defProp(c,"$",{}),store.$.defProp(c.$,"partialType",h.type),c.$.hasOwnProperty("pK")||store.$.defProp(c.$,"pK",m)),y&&(c.$.polymorphicType=b),$.push(c)}}else if("removed"==h.type){var L={};m&&"object"==typeof m?Object.assign(L,Object.assign({},m)):L[v]=m;R=store.$.peekRecord(i._name,m)||store.$.peekRecord(i._name,m,!0);if(k){w={};store.$.defProp(w,"$",{});P=w.$;if(Object.defineProperties(P,{pkVal:{value:m},type:{value:"removed"},model:{value:y&&h.polymorphicType?h.polymorphicType:f},record:{value:R}}),l){var j="rec"+ ++l.size;L[l.refKey]=j,l.set(j,w)}k.push(w)}store.$.defProp(L,"$",{}),L.$.partialType="removed",y&&h.polymorphicType&&(L.$.polymorphicType=h.polymorphicType),L.$.hasOwnProperty("pK")||(L.$.pK=m),$.push(L)}}),$.length?t=e[r]=$:delete e[r]}}else delete e[r];else if("belongsTo"==c.relType&&t&&Lyte.isRecord(t)){var b;y&&t&&(b=t._type?t._type:t.$.model._name,i=store.model[b]),this.removeBackwardRel(t,o,p,s);var _,R=t;if(t.$.isNew?this.removeBackwardRel(t,o,p,s):(_=store.$.isDirty(t,i.relations),R=store.$.updateJSON(t,i,_)),d){var k=d[r]=d[r]||{},O=t.$.isNew?"added":t.$.isModified?"modified":"related";store.$.defProp(k,"$",{});var w=k.$,P=y?b:f;Object.defineProperties(w,{pkVal:{value:t.$.pK},type:{value:O},model:{value:P},record:{value:store.$.peekRecord(P,t.$.pK)}})}y&&(R.$||store.$.defProp(R,"$",{}),R.$.polymorphicType=b),this.removeSelfCircularReference(i._name,R,n,void 0,k,l),t=e[r]=R}},removeSelfCircularReference:function(e,r,t,o,a,i,s,n){var d=store.model[e],l=d.fieldList,c=(d.extend,store.$.getpKVal(r,d));store.$.recStack[e]=store.$.recStack[e]||[];store.$.checkAndAddToArray(store.$.recStack[e],c);var p,f=store.$.peekRecord(e,c),y=Lyte.isRecord(f)?f.$.partial:void 0,u=r&&r.$?r.$.polymorphicType:void 0,v=new Map;if(v.set(r,c),i){p="rec"+ ++i.size;var h={};store.$.defProp(h,"$",{pkVal:f.$.pK,model:f.$.model._name}),i.set(p,h)}var m=store.$.getFromCB("serializer",e,"serializeEmptyRelation");for(var $ in r){var g,b,_,R,k,O=l[$],w=!1;if(!(!("create"==o||Lyte.isRecord(r)&&r.$.isNew)||d._pK!=$)&&1!=t)delete r[$];else if(O)if(O&&"relation"!=O.type&&!t&&Lyte.Transform[O.type]&&Lyte.Transform[O.type].serialize&&r.hasOwnProperty($))r[$]=Lyte.Transform[O.type].serialize(r[$],$,f);else{if(y&&y.hasOwnProperty($)){var P={},A=store.model[O.relatedTo]._pK,L=!1;if(y[$].forEach(function(e,t){if((!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&O.opts&&/^(id|record)$/.test(O.opts.serialize)?(r[$]=null,L=!0):"partial"==O.opts.serialize&&(P[A]=t,store.$.defProp(P,"$",{}),store.$.defProp(P.$,"partialType","removed"),store.$.defProp(P.$,"pK",t),r[$]=P,L=!0),a){var o=a[$]=a[$]||{};store.$.defProp(o,"$",{});var i=o.$;Object.defineProperties(i,{pkVal:{value:t},type:{value:"removed"},model:{value:O.relatedTo},parent:{value:f},record:{value:store.$.peekRecord(O.relatedTo,t)}}),O&&O.opts&&/^(id|record)$/.test(O.opts.serialize)&&Object.defineProperties(i,{onlyDetach:{value:!0},relKey:{value:$}})}}),L)continue}if(1!=t&&"state"!=t||!r[$]||"object"!=typeof r[$]||!O||"relation"==O.type){if(t&&"isClone"==t.type&&r[$]&&O&&"relation"==O.type&&((k=!(!O.opts||!O.opts.inherit))||delete r[$]),r[$]&&O&&"relation"==O.type){if(b=O.relatedTo,R=O.relType,k=!(!O.opts||!O.opts.inherit),void 0==(_=store.modelFor(b)))continue;var j=O.relKey,S={};w?this.getRelations(g,O.relKey,_,S):this.getRelations(d,j,_,S);var K=O.opts,E=K?K.serialize:void 0,D=r[j];if("idb"==t)store.$.idbSerialize(D,S,d,_,c,t);else if(s&&k)store.$.toChildJSON(b,R,r[$],$,e,v,n,t),"belongsTo"==R&&(r[$]=Object.assign({},r[$]),r[$][store.modelFor(b)._pK]==c&&b==e&&(r[$]=c));else if(t&&!s||s&&!k||"id"==E)store.$.idSerialize(r,S,t,a,i);else if("record"===E){if(0==store.$.recordSerialize(r,$,D,S,d,_,c,t,a,i)&&"hasMany"===R&&(!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&Array.isArray(f[$])&&f[$].partial&&f[$].partial.size){var T=!0;if(f[$].partial.forEach(function(e){"removed"!==e.type&&(T=!1)}),T){r[$]=[];continue}}}else{if("partial"!==E){delete r[j];continue}store.$.partialSerialize(r,$,D,S,d,_,c,t,a,i)}((D=r?r[j]:void 0)&&"hasMany"==R&&Array.isArray(D)&&0==D.length||"belongsTo"==R&&"object"==typeof D&&0==Object.keys(D).length)&&((!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&"hasMany"==R&&O.opts&&/^(id|record)$/.test(O.opts.serialize)?r[j]=[]:delete r[j])}}else r[$]=Lyte.deepCopyObject(r[$])}else u&&(g=store.modelFor(u),O=g.fieldList[$],w=!0),n||delete r[$]}if("state"==t){var C=f.$.model.fieldList;for(var $ in C)f.hasOwnProperty($)||("relation"==C[$].type&&"hasMany"==C[$].relType?r[$]=[]:r[$]=void 0)}if(i){var M=i.refKey;r[M]=p}},removeBackwardRel:function(e,r,t,o,a){if(a)delete e[r.backward.relKey];else if(null!=r.backward){var i=e[r.backward.relKey];if(Array.isArray(i)){for(var s=0;s<i.length;s++)if(this.comparePk(i[s],o))return i.splice(s,1),void(0==i.length&&delete e[r.backward.relKey])}else i&&Lyte.isRecord(i)&&this.comparePk(i,o)&&delete e[r.backward.relKey]}},polymorphicToJSON:function(e,r){var t=e.opts;if(t&&t.polymorphic){if(Array.isArray(r)){var o=[];return r.forEach(function(e){o.push(store.$.polyToJSON(e))}),o}return store.$.polyToJSON(r)}},polyToJSON:function(e){var r=e.$.model;!r.hasOwnProperty("fieldList")&&r._name&&(r=store.model[r._name]);var t=r?r._pK:void 0,o={},a=e.$.pK;return"object"==typeof a?o=Object.assign({},a):o[t]=a,o._type=e._type?e._type:e.$.model._name,o},toChildJSON:function(e,r,t,o,a,i,s,n){var d=store.modelFor(e),l=d.fieldList,c={};Array.isArray(t)||(t=[t]);for(var p=0;p<t.length;p++){if(!i.get(t[p])){var f=store.$.getpKVal(t[p],d);i.set(t[p],f)}if(!s)for(var y in t[p])l.hasOwnProperty(y)||delete t[p][y];for(var u in d.relations)for(var v=0;v<d.relations[u].length;v++){var h=d.relations[u][v].relKey?d.relations[u][v].relKey:void 0;if(h&&l[h]&&"relation"==l[h].type&&t[p][l[h].relKey])if(t[p][l[h].relKey]&&l[h].opts&&l[h].opts.inherit){if("hasMany"==l[h].relType&&t[p][l[h].relKey])for(var m=0;m<t[p][l[h].relKey].length;m++)if(f=store.$.getpKVal(t[p][l[h].relKey][m],store.modelFor(l[h].relatedTo)),i.get(t[p][l[h].relKey][m])){if(Lyte.isRecord(t[p][l[h].relKey][m])&&i.get(t[p][l[h].relKey][m])){if("object"==typeof f)t[p][l[h].relKey][m]=f;else{var $={};$[store.modelFor(l[h].relatedTo)._pK]=f,t[p][l[h].relKey][m]=$}(g={})[store.modelFor(l[h].relatedTo)._pK]=f,t[p][l[h].relKey][m]="object"==typeof f?f:g}}else i.set(t[p][l[h].relKey][m],f),store.$.toChildJSON(l[h].relatedTo,l[h].relType,t[p][l[h].relKey][m],l[h].relKey,l[h].relatedTo,i,s),"object"==typeof t[p][l[h].relKey][m]&&(t[p][l[h].relKey][m]=Object.assign({},t[p][l[h].relKey][m]));else if("belongsTo"==l[h].relType&&t[p][l[h].relKey]){var g;if(f=store.$.getpKVal(t[p][l[h].relKey],store.modelFor(l[h].relatedTo)),i.get(t[p][l[h].relKey]))(g={})[store.modelFor(l[h].relatedTo)._pK]=f,t[p][l[h].relKey]="object"==typeof f?f:g;else i.set(t[p][l[h].relKey],f),store.$.toChildJSON(l[h].relatedTo,l[h].relType,t[p][l[h].relKey],l[h].relKey,l[h].relatedTo,i,s),t[p][l[h].relKey]=Object.assign({},t[p][l[h].relKey])}0==Object.keys(t[p][l[h].relKey]).length&&delete t[p][l[h].relKey]}else(Lyte.isRecord(t[p][l[h].relKey])||"hasMany"==l[h].relType&&Lyte.isRecord(t[p][l[h].relKey][0]))&&(!n||n&&"isClone"!=n.type?(this.getRelations(d,l[h].relKey,store.modelFor(l[h].relatedTo),c),store.$.idSerialize(t[p],c,!0)):delete t[p][l[h].relKey])}Lyte.isRecord(t[p])&&(t[p]=Object.assign({},t[p]))}},toJSONObj:function(e,r,t,o,a,i,s){var n,d,l=e._name,c=(e._pK,e._fldGrps.inherit&&Object.keys(e._fldGrps.inherit).length);if(n=1!=t&&"state"!=t||i&&(!i||c)?Lyte.deepCopyObject(r):Object.assign({},r),Lyte.isRecord(n))d=n.$.pK;else{if(!store.$.getpKVal(n,e))return;if(!store.$.peekRecord(l,store.$.getpKVal(n,e)))return;d=store.$.peekRecord(l,store.$.getpKVal(n,e)).$.pK}var p,f=a?a.obj:void 0;return f&&!f.has(d)&&(f.set(d,{}),p=f.get(d)),this.removeSelfCircularReference(l,n,t,o,p,a&&a.ref?a.ref:void 0,i,s),"idb"==t&&this.removeNotNeededKeys(l,n,e.idb),n},toJSON:function(e,r,t,o,a,i,s){var n,d=store.model[e];if(store.$.recStack={},Array.isArray(r)){for(var l=[],c=0;c<r.length;c++)n=this.toJSONObj(d,r[c],t,o,a,i,s),l.push(n);return l}return r&&("object"==typeof r||Lyte.isRecord(r))&&(n=this.toJSONObj(d,r,t,o,a,i,s)),store.$.recStack={},n},createCopy:function(e){if(Array.isArray(e)){if(e.save){for(var r=[],t=0;t<e.length;t++){var o=Lyte.deepCopyObject(e[t]);r.push(o)}return r}}else if(e&&(Lyte.isRecord(e)||"object"==typeof e))return Lyte.deepCopyObject(e);return e},compareRecords:function(e,r,t,o,a){t=a._arrPk;if(Lyte.isRecord(e)&&Lyte.isRecord(r)&&t.length){if(o&&e._type&&o!==e._type)return!1;for(var i=t.length,s=0;s<i;s++){var n=t[s];if(e[n]&&r[n]&&e[n]!==r[n])return!1}return!0}return!1},hasRecordInArray:function(e,r,t,o,a){if(Lyte.isRecord(r)&&t)for(var i=e.length,s=0;s<i;s++){var n=e[s];if(!o||n._type===o)if(a){if(this.compareRecords(n,r,t,void 0,r.$.model))return!0}else if(o&&n._type&&o===r._type&&n[t]===r[t]||n[t]===r[t])return!0}return!1},hasDuplicateRelation:function(e,r,t,o,a){var i=a.isComp;return Array.isArray(r)?i||r.isPolymorphic||!r._recMap?this.hasRecordInArray(r,e,t,o,i):r._recMap.get(e[t]):!(!r||!Lyte.isRecord(r))&&this.compareRecords(e,r,t,o,a)},checkPresenceInArray:function(e,r){return e&&e.some(function(e){return e===r})},checkAndAddToArray:function(e,r){if(this.checkPresenceInArray(e,r))return-1;e.push(r)},deleteFromArray:function(e,r){var t=e.indexOf(r);-1!=t&&e.splice(t,1)},genPk:function(e,r,t){var o;e.forEach(function(e){o=t[e].type;var a=r[e]=Math.floor(1e5*Math.random()+1);"string"==o&&(r[e]=a.toString())})},generateRandomPk:function(e,r,t,o){for(this.genPk(t,r,o);this.isDuplicateRecord(e,r,t.toString());)this.genPk(t,r,o)},pkPresence:function(e,r){var t=!0;return r.forEach(function(r){e.hasOwnProperty(r)&&e[r]||(t=!1)}),t},newRecord:function(e,r,t){var o=store.modelFor(e);if(void 0===o)return Lyte.warn("LD02","Model",e),new error1(void 0,void 0,Lyte.getErrorMessage("LD02","Model",e));if(void 0===r&&(r={}),r&&"object"!=typeof r)return Lyte.warn("LD25",r),new error1(void 0,void 0,Lyte.getErrorMessage("LD25",r));var a=o.fieldList,i={},s=new error1,n=o._arrPk;for(var d in this.pkPresence(r,n)?this.isDuplicateRecord(o,r,n)&&store.$.setError(s,n,{code:"ERR16",message:Lyte.errorCodes.ERR16}):this.generateRandomPk(o,r,n,a),a){"hasMany"==(w=a[d]).relType&&(i[d]=[]);var l=r[d];if("relation"!=w.type&&(void 0!==l&&""!==l||w.hasOwnProperty("default")&&(l=i[d]=store.$.getDefaultVal(i,w.default)),!t)){var c=w;c.any&&Array.isArray(c)||(c=[c]);for(var p=c.length,f=!0,y=0;y<p;y++){var u=c[y];for(var v in u){1!=(O=Lyte.checkProperty(v,l,d,u[v],u,r,i,e))&&!0===f&&("object"==typeof O&&(O.value=l),f=O)}}!0!==f&&store.$.setError(s,d,f)}}for(var h in r)i[h]=r[h];i=new Record(e,i),store.$.cmpSet(i.$,"isNew",!0),store.$.changePersist(i,!1);var m=o.relations;for(var $ in m){var g=m[$];for(y=0;y<g.length;y++){var b=g[y],_=b.relKey,R=b.opts?b.opts.polymorphic:void 0;if(i&&i[_]){var k=r[_];i[_]=void 0;var O,w=g[y],P={};if(1!=(O=this.getRelations(o,w.relKey,store.modelFor(w.relatedTo),P))){store.$.setError(s,w.relKey,{code:O,data:g,message:Lyte.errorCodes[O]});continue}var A=store.modelFor(w.relatedTo),L=A._pK,j=A.isComp,S=j?void 0:A.fieldList[A._pK].type;if(Array.isArray(k)){if("belongsTo"==g[y].relType){store.$.setError(s,w.relKey,{code:"ERR21",data:k,message:Lyte.errorCodes.ERR21});continue}}else k=[k];s[w.relKey]=[];for(var K=0;K<k.length;K++){var E=void 0,D=w.relatedTo;if(k[K]&&Lyte.isRecord(k[K]))E=k[K].$.record;else if(j&&"object"==typeof k[K]){var T;if(-1!=(T=store.$.getIndex(A.data,L,store.$.getpKVal(k[K],A))))E=A.data[T];else{if(R){if(!k[K]||!k[K].hasOwnProperty("_type")){store.$.setError(s,w.relKey,{code:"ERR22",data:k[K],message:Lyte.errorCodes.ERR22});continue}D=k[K]._type}E=this.newRecord(D,k[K])}}else if(k[K]&&typeof k[K]==S.toLowerCase())E=store.$.peekRecord(D,k[K]);else if(k[K]&&"object"==typeof k[K]){if(R){if(!k[K]||!k[K].hasOwnProperty("_type")){store.$.setError(s,w.relKey,{code:"ERR22",data:k[K],message:Lyte.errorCodes.ERR22});continue}D=k[K]._type}E=this.newRecord(D,k[K])}E&&E.$&&E.$.isError?store.$.setError(s,w.relKey,{code:"ERR15",data:k[K],message:Lyte.errorCodes.ERR15,error:Object.assign({},E)}):E&&E.$&&!E.$.isError&&1!=(O=this.establishLink(P.forward,P.backward,i,E,void 0,!1))&&store.$.setError(s,w.relKey,{code:O,data:k[K],message:Lyte.errorCodes[O]})}if(0==s[w.relKey].length&&delete s[w.relKey],"hasMany"==g[y].relType){var C=_;void 0==i[C]&&(i[C]=[]),i[C].add||(R&&store.$.defProp(i[C],"polymorphic",!0),store.$.defArrUtls(i[C]),store.$.defUtls(i[C],store.modelFor(g[y].relatedTo),i,C),store.$.defPolyUtls(i[C]))}}}}if(s&&s.$&&Object.keys(s.$.error).length>0)return s;var M=store.$.toRelate[o._name],N=i.$.pK;if(M&&M.has(N)&&(store.$.establishToRelated(i,M.get(N)),M.delete(N)),o.didLoad){var x=o.didLoad;for(y=0;y<x.length;y++)x[y].apply(i)}return this.handleArrOp(o.data,"push",i),this.checkAndAddToArray(o.dirty,i.$.pK),o.emit("add",[i]),store.emit("add",[o._name,i]),t&&(i.$.validatedOnCreate=!1),i},toInsertData:function(e,r,t,o){var a=store.model[e],i=this.insertIntoStore(e,r[e],t,!0,void 0,void 0,void 0,void 0,o);return a&&delete a.rel,i},insertIntoStore:function(e,r,t,o,a,i,s,n,d,l){if(Array.isArray(r)){m=[];for(var c=0;c<r.length;c++)m[c]=this.insertIntoStore(e,r[c],t,o,a),m[c]&&m[c].$&&m[c].$.isError&&(m.$=m.$||store.$.defProp(m,"$",{}),store.$.cmpSet(m.$,"isError",!0))}else if(r&&"object"==typeof r&&Object.keys(r).length){var p=store.modelFor(e);if(r._type&&p.extendedBy&&(p=p.extendedBy[r._type]?store.modelFor(r._type):void 0),!p){var f=store.modelless,y=f[e]=f[e]||{};if(d){if(y._pK&&y._pK!==d)return void Lyte.error("");y._pK=d,y._arrPk=[d]}else y._pK=d="id",y._arrPk=[d];y.data=y.data||[],y.data.modelless||(store.$.defProp(y.data,"modelless",!0),store.$.defProp(y.data,"pK",y._pK));var u=store.$.getInd(y.data,d,r[d]);return-1==u?store.$.handleArrOp(y.data,"push",r):store.$.handleArrOp(y.data,"replaceAt",r,u),r}if(Lyte.isRecord(r)&&!n)return;if(s&&r&&p){var v=p.relations;for(var h in v){v[h].forEach(function(e){var t=e.relKey,o=e.relType;if("hasMany"==o&&r.hasOwnProperty(t)&&Array.isArray(r[t])&&r[t].length){var a=[];r[t].forEach(function(e){Lyte.isRecord(e)?a.push(e.$.pK):a.push(e)}),r[t]=a}else"belongsTo"==o&&r.hasOwnProperty(t)&&Lyte.isRecord(r[t])&&(r[t]=r[t].$.pK)})}}if(n){$=new Record(p._name,r,p._pK,n);var m=this.validateAndPush(p,$,void 0,n)}else if(this.isDuplicateRecord(p,r,p._pK))(m=this.validateAndMerge(p,r,a,void 0,l))&&m.data?m=m.data:m&&m.type&&Lyte[m.type].apply(Lyte,m.args||[]);else{var $=new Record(p._name,r);p.data.push($);var g=store.$.toRelate[p._name],b=$.$.pK;t&&(store.$.saveParent=$),m=this.validateAndPush(p,$,a,void 0,l),g&&g.has(b)&&(store.$.establishToRelated($,g.get(b)),g.delete(b))}t&&(store.$.saveParent=void 0),o&&(store.$.recStack={})}return m},removeFromStore:function(e,r,t,o,a,i,s,n){var d=e.data,l=e._name;if(0!=d.length){Array.isArray(r)||(r=[r]);for(var c=e._pK,p=0;p<r.length;p++){var f=this.getIndex(d,c,r[p]);if(-1!=f){var y,u=d[f],v=u.$.pK,h=e.relations;if(u.$.isNew&&(i=a=void 0,t=!0),Object.keys(h).length&&this.toDemolishRelation(e,f,o,i,a,s),!0!==a&&!1!==i&&(y=this.handleArrOp(d,"removeAt",void 0,f,1),e._properties&&store.$.demoLishObserverBindings(u,e._properties)),!0===t){store.$.cmpSet(u.$,"isUnloaded",!0);var m=u.$.__scpObj;for(var $ in m){var g=m[$].split("_"),b=Lyte.nestScp[g[0]];b&&Lyte.removeNestScp(b._data,g[0],g[1],void 0,u,void 0,void 0,{model:l,pK:u.$.pK,attr:$})}if(R=store.model.cachedQueries){if((O=R[l])&&O.length)for(var _=O.length-1;_>=0;_--){if((w=O[_]).hasDeletedRecords)if(w.data)-1!==(P=w.data[l].indexOf(u))&&O.splice(_,1)}}n&&!u.$.isNew&&u.$.persist()}if(1!=i){var R,k=y?y[0]:u;if(!t)if(store.$.cmpSet(k.$,"isDeleted",!0),store.$.changePersist(k,!0),!0!==a&&!1!==i&&(k.$.isNew||k.$.isModified)&&store.$.deleteFromArray(e.dirty,k.$.pK),k.$.isNew||store.$.addTo_Del(e,k,f),R=store.model.cachedQueries){var O;if((O=R[l])&&O.length)for(_=O.length-1;_>=0;_--){var w,P;if((w=O[_])&&w.data)-1!=(P=w.data[l].indexOf(u))&&(w.hasDeletedRecords=!0)}}Array.isArray(e.dirty)&&-1!=(P=e.dirty.indexOf(v))&&e.dirty.splice(P,1),!0!==a&&!1!==i&&(e.emit("remove",[y[0]]),store.emit("remove",[e._name,y[0]]))}else e.emit("remove",[y[0]]),store.emit("remove",[e._name,y[0]])}}}},getIndex:function(e,r,t,o,a){return(a?a.isComp:r.split(",").length>1)?this.getCompInd(e,t,o,a):this.getInd(e,r,t,o)},getCompInd:function(e,r,t,o){for(var a=0;e&&a<e.length;a++){var i=e[a];if((!t||e[a]._type===t)&&store.adapter.$.compareObjects(store.$.getpKVal(i,o),r))return a}return-1},getInd:function(e,r,t,o){for(var a=0;e&&a<e.length;a++){var i=e[a];if(!o||i._type===o){if(i[r]==t)return a;if(r&&"string"==typeof r&&-1!=r.search(/[.]/g)&&i&&i.$&&i.$.record&&i.$.get(r)==t)return a}}return-1},isDuplicateRecord:function(e,r){var t=e.data,o=e._pK,a=e.isComposite;if(t.length){if(!a&&e.data._recMap){var i=r[o];return void 0!==i&&void 0!==e.data._recMap.get(i.toString())}return t.some(function(t){if(store.adapter.$.compareObjects(store.$.getpKVal(r,e),store.$.getpKVal(t)))return!0})}return!1},validateAndPush:function(e,r,t,o,a){e.rel||(e.rel={});for(var i=e._arrPk,s=i.length,n=0;n<s;n++){var d=i[n];if(!r.hasOwnProperty(d))return c=e.data.indexOf(r),e.data.splice(c,1),new error1(d,{code:"ERR23",data:r,message:Lyte.errorCodes.ERR23});if(void 0==r[d]||null==r[d])return c=e.data.indexOf(r),e.data.splice(c,1),new error1(d,{code:"ERR26",data:r,message:Lyte.errorCodes.ERR26})}if(o)return r=this.validateJSON(e,r,void 0,void 0,void 0,o);var l=void 0==r.$.pK||"object"==typeof r.$.pK?r.$.pK:r.$.pK.toString();e.data._recMap.set(l,r),r=this.validateJSON(e,r,void 0,void 0,t,void 0,a);var c=e.data.indexOf(r);if(e.data.splice(c,1),this.handleArrOp(e.data,"push",r),e.didLoad){var p=e.didLoad;for(n=0;n<p.length;n++)p[n].apply(r)}return e.emit("add",[r]),store.emit("add",[e._name,r]),r},validateAndMerge:function(e,r,t,o,a){if(e.rel||(e.rel={}),void 0===store.$.getpKVal(r,e))return{type:"error",args:["LD28",e._name,Lyte.isRecord(r)?r:JSON.stringify(r)]};var i=store.$.peekRecord(e._name,store.$.getpKVal(r,e));if(!i||!Lyte.isRecord(i))return{type:"error",args:["LD04",Lyte.isRecord(r)?r:JSON.stringify(r)]};if(this.mergeData(i,r,t,o,a),e.didLoad)for(var s=e.didLoad,n=0;n<s.length;n++)s[n].apply(i);return{data:i}},mergeData:function(e,r,t,o,a){if(e&&r){var i,s=e.$.model,n=!1,d=0!=a||a;for(var l in o&&store.adapter.$.mergeError(s,e,r),r)if(i=s.fieldList[l]){if("relation"!=i.type){var c=store.$.getDsrzEmpData(i,s._name),p=!c&&r[l];r.hasOwnProperty(l)&&(p||c)&&Lyte.Transform.hasOwnProperty(i.type)&&Lyte.Transform[i.type].hasOwnProperty("deserialize")&&d&&(r[l]=Lyte.Transform[i.type].deserialize(r[l],l,s._name,store.$.getpKVal(r,s)));var f={};s._properties&&s._properties.hasOwnProperty(l)&&(f[l]=s._properties[l],store.$.demoLishObserverBindings(e,f)),store.$.cmpSet(e,l,r[l],void 0,!0),s._properties&&s._properties.hasOwnProperty(l)&&(n=!0)}else if(i&&"relation"==i.type){var y={},u={};store.$.getRelations(e.$.model,l,store.modelFor(i.relatedTo),u);var v=store.model[u.forward.relatedTo];if("hasMany"==i.relType&&t&&t[l]&&t[l].replace){var h=[];e[l]._recMap.forEach(function(e,r){h.push(r)}),h.forEach(function(r){store.$.peekRecord(i.relatedTo,r).$.isNew?store.$.removeFromStore(store.modelFor(i.relatedTo),r,!0):(store.$.demolishLink(store.$.peekRecord(i.relatedTo,r),store.$.peekRecord(i.relatedTo,r).$.model._pK,e,u.forward.relKey,void 0,void 0,!0,!0),null!=u.backward&&store.$.demolishLink(e,s._pK,store.$.peekRecord(i.relatedTo,r),u.backward.relKey,u.forward,void 0,!0,!0))}),delete t[l]}var m=this.compareRelations(e,r,l,i,t?t[l]:void 0,y,o);this.mergeRecords(y,m,s,v,e,l,r,u,t,o)}}else"$"!=l&&store.$.cmpSet(e,l,r[l],void 0,!0);n&&store.$.establishObserverBindings(e,s._properties)}},mergeRecords:function(e,r,t,o,a,i,s,n,d,l){if(!n){n={};store.$.getRelations(t,i,o,n)}var c=t._pK;if(("hasMany"==n.forward.relType&&store.$.isEmptyArray(s[i])&&Array.isArray(e.remove)&&a&&a[i]&&e.remove.length!=a[i].length||a&&!a[i]&&Array.isArray(s[i]))&&(store.$.cmpSet(a,i,[],void 0,!0),store.$.establishObserverBindings(a,a.$.model._properties),store.$.defArrUtls(a[i]),store.$.defPolyUtls(a[i]),store.$.defUtls(a[i],o,a,i)),Array.isArray(e.add)&&e.add.forEach(function(e){store.$.createAndRelate(t,o,a,i,e,n,d)}),Array.isArray(e.remove)&&e.remove.forEach(function(e){var r=e.pK,t=e.model;store.$.demolishLink(a,c,store.$.peekRecord(t,r),n.backward.relKey,n.forward,n.backward,!0),store.$.demolishLink(store.$.peekRecord(t,r),store.modelFor(t)._pK,a,n.forward.relKey,n.backward,n.forward,!0)}),a&&a.hasOwnProperty(i)&&(store.$.deleteDeepNest(a,i),Array.isArray(a[i])&&a[i].hasOwnProperty("partial"))){var p=[];a[i].partial.forEach(function(e,r){p.push(r),a[i].partial.delete(r)})}switch(r){case 0:Lyte.isRecord(a[i])&&(store.$.demolishLink(a,c,a[i],n.backward.relKey,n.forward,n.backward,!0),store.$.demolishLink(a[i],o._pK,a,n.forward.relKey,n.backward,n.forward,!0)),store.$.createAndRelate(t,o,a,i,s[i],n,d);break;case 1:break;case 2:this.mergeData(a[i],s[i],void 0,l)}},compareRelations:function(e,r,t,o,a,i,s){var n=store.modelFor(o.relatedTo),d=n._pK;if("belongsTo"==o.relType)return a&&"removed"===a.$.type&&(!r||r&&store.$.comparePk(e,store.$.getpKVal(r,n)))?1:this.compareRecordWithObj(e[t],r[t],d,a,s);var l=!1;if(a&&a.partial&&(l=!0),!l&&(!e.hasOwnProperty(t)||e&&e.hasOwnProperty(t)&&(store.$.isEmpty(e[t])||store.$.isEmptyArray(e[t]))))return i?void(r[t]||[]).forEach(function(e){(i.add=i.add||[]).push(e)}):0;for(var c=r[t]?r[t].length:0,p=[],f=0;f<c;f++){var y=r[t][f];if(!a||!a[f]||"removed"!=a[f].$.type){var u=this.getIndex(e[t],d,"object"==typeof y?store.$.getpKVal(y,n):y);if(-1!=u){p.push(e[t][u].$.pK);var v=this.compareRecordWithObj(e[t][u],y,d,a?a[f]:void 0,s);1==v&&0,2==v?this.mergeData(e[t][u],y,a?a[f]:void 0,s):0==v&&0}else{i&&(i.add=i.add||[]).push(y),0}}}i&&!l&&(e[t]||[]).forEach(function(e){var r=e.$.pK;-1==p.indexOf(r)&&(i.remove=i.remove||[]).push({pK:r,model:e.$.model._name})})},compareRecordWithObj:function(e,r,t,o,a){if(!e||!Lyte.isRecord(e))return 0;var i=e.$.model,s=(i._pK,i.isComp),n=i.fieldList;if(!s&&typeof r==(l=i.fieldList[t]).type)return e[t]==r?1:0;if(r&&"object"==typeof r){if(!store.$.comparePk(e,store.$.getpKVal(r,i)))return 0;if(Lyte.isRecord(r)&&r===e)return 1;for(var d in r){var l;if(l=n[d]){if("relation"==l.type){var c={},p=this.compareRelations(e,r,d,l,o?o[d]:void 0,c,a);this.mergeRecords(c,p,i,store.modelFor(l.relatedTo),e,d,r,void 0,o)}else if(e[d]!=r[d])return 2}else if(e[d]!=r[d])return 2}return 1}return 0},validateJSON:function(e,r,t,o,a,i,s){var n=o?o.toValidate:void 0,d=0!=s||s,l=n&&Object.keys(n).length?n:e.fieldList,c=!!e.extend;for(var p in r)if(!t||-1!=t.indexOf(p)){var f=l[p];if(f){if("relation"==f.type&&r[p]){var y=o&&o.toPartialAdd?o.toPartialAdd[p]:void 0;if(1!=(g=this.handleRelation(p,e,f,r,y,a,i)))return new error1(p,{code:g,data:r,message:Lyte.errorCodes[g]});"hasMany"!=f.relType||r[p].add||(store.$.defArrUtls(r[p]),store.$.defPolyUtls(r[p]),store.$.defUtls(r[p],store.model[f.relatedTo],r,p))}else if(f.type){var u=f;void 0===r[p]&&u.default&&(r[p]=store.$.getDefaultVal(r,u.default));var v=store.$.getDsrzEmpData(f,e._name),h=!v&&r[p];r.hasOwnProperty(p)&&(h||v)&&Lyte.Transform.hasOwnProperty(u.type)&&Lyte.Transform[u.type].hasOwnProperty("deserialize")&&d&&(r[p]=Lyte.Transform[u.type].deserialize(r[p],p,e._name,store.$.getpKVal(r,e)))}}else if(c){var m=store.modelFor(e.extend),$=m.fieldList[p];if($&&"relation"==$.type){var g;y=o&&o.toPartialAdd?o.toPartialAdd[p]:void 0;if(1!=(g=this.handleRelation(p,m,$,r,y)))return new error1(p,{code:g,data:r,message:Lyte.errorCodes[g]});"hasMany"!=$.relType||r[p].add||(store.$.defArrUtls(r[p]),store.$.defPolyUtls(r[p]),store.$.defUtls(r[p],m,r,p))}}}return r},handleRelation:function(e,r,t,o,a,i,s){var n={};if(r.rel.hasOwnProperty(e))n=r.rel[e];else{var d=this.getRelations(r,e,store.modelFor(t.relatedTo),n);if(!0!==d)return d;r.rel[e]=n}return this.solveRelation(n,r,store.modelFor(t.relatedTo),e,o,a,i,s)},getRelations:function(e,r,t,o){if(void 0==t)return Lyte.error("LD05",e.fieldList[r].relatedTo,r,e._name),"ERR11";if(o.forward=e.fieldList[r],o.backward=this.getBackwardRel(e,o.forward,t),void 0===o.backward){var a={type:"relation",relatedTo:e._name,dummy:o.forward.relKey,relKey:void 0};t.relations[e._name]=t.relations[e._name]||[],t.relations[e._name].push(a),o.backward=a}return!0},getBackwardRel:function(e,r,t){var o,a,i;if(r.opts){if(o=r.opts.inverse,a=r.opts.polymorphic,null===o)return;if(a){var s=t.extendedBy;if(s)for(var n in s){var d=store.modelFor(n);if(d.relations[e._name]){t=d;break}}}}if(o&&""!=o)i=o;else{var l,c=t.relations[e._name],p=store.modelFor(e.extend);!c&&p&&t.relations[p._name]&&(c=t.relations[p._name],l=!0),i=!c||1!=c.length||c[0].opts&&c[0].opts.inverse&&c[0].opts.inverse!==r.relKey||l&&!(l&&c[0].opts&&c[0].opts.polymorphic)?void 0:c[0].relKey}if(!i){var f=t.relations[e._name],y=store.modelFor(e.extend);if(!f&&y&&t.relations[y._name]&&t.relations[y._name].opts&&t.relations[y._name].opts.polymorphic&&(f=t.relations[y._name]),r.dummy&&f){for(var u=0;u<f.length;u++)if(f[u]&&f[u].relKey&&f[u].relKey==r.dummy){i=f[u].relKey;break}}else if(f)for(u=0;u<f.length;u++){if(f[u]&&f[u].opts&&f[u].opts.inverse&&f[u].opts.inverse===r.relKey){i=f[u].relKey;break}if(f[u]&&f[u].dummy&&f[u].dummy==r.relKey){i=f[u];break}}}return i&&i.dummy?i:i&&e._fldGrps.inverse.hasOwnProperty(r.relatedTo)&&!r.dummy&&i&&e.relations[r.relatedTo]&&e.relations[r.relatedTo].length>1&&!o&&(!t.fieldList[i].opts||t.fieldList[i].opts&&!t.fieldList[i].opts.inverse)?void 0:i&&t?t.fieldList[i]:void 0},solveRelation:function(e,r,t,o,a,i,s,n){e.backward;var d=e.forward,l=s?s[o]:void 0,c=l&&l.partial,p=(r._pK,[]);if(i)p=i;else if(c){if(Array.isArray(a[o]))p=a[o].splice(0,a[o].length)}else{if(a[o]&&(a[o].add||Lyte.isRecord(a[o])))return!0;if(Array.isArray(a[o])){if("belongsTo"==d.relType)return"ERR21"}else a[o]=[a[o]];p=a[o].splice(0,a[o].length),"belongsTo"==d.relType&&(a[o]=void 0)}for(var f=0;f<p.length;f++){var y;if(1!=(y=this.createAndRelate(r,t,a,o,p[f],e,l,n)))return y}return!0},createAndRelate:function(e,r,t,o,a,i,s,n){if(!i.backward&&(i.forward.relatedTo===e._name&&(i.backward=i.forward),void 0===i.backward))return"ERR12";var d,l=e._pK,c=r.isComp,p=i.forward&&i.forward.opts?i.forward.opts.polymorphic:void 0,f=s&&s.hasOwnProperty(a[l])?s[a[l]]:s;if(c||typeof a!=r.fieldList[r._pK].type||n?"object"!=typeof a||Lyte.isRecord(a)||(d=this.insertIntoStore(r._name,a,void 0,void 0,f,void 0,void 0,n)):d=store.$.peekRecord(r._name,a),d&&d.$&&d.$.isError){store.$.cmpSet(t.$,"isError",!0);var y={code:"ERR24",message:Lyte.errorCodes.ERR24,data:t,error:d.$.error};store.$.cmpSet(t.$.error,o,y)}else d?this.hasDuplicateRelation(d,t[o],r._pK,p?a._type:void 0,r)||this.establishLink(i.forward,i.backward,t,d,void 0,!0,!1):this.addToRelate(e._name,t,i,a);return!0},singleEstablishLink:function(e,r,t){var o=t.$._relationships,a=r.$.model._name,i=e.relKey;o[a]=o[a]||{},o[a][i]=o[a][i]||[],this.hasDuplicateRelation(r,o[a][i],r.$.model._pK,void 0,r.$.model)||o[a][i].push(r)},establishLink:function(e,r,t,o,a,i,s,n){if(!o)return"ERR13";if(!this.checkForCorrectRelation(e,o))return"ERR14";var d=e.relKey,l=e.opts&&e.opts.polymorphic,c=l?o._type:void 0,p={},f=!1;if("belongsTo"==e.relType)t[d]!==o&&(store.$.cmpSet(t,d,o,void 0,!0),t.$.partial&&Object.keys(t.$.partial).length&&t.$.partial[d]&&delete t.$.partial[d],f=!0);else if("hasMany"===e.relType){if(t[d]||store.$.cmpSet(t,d,[],void 0,!0),!t[d].model){var y=o.$.model;l&&c&&(store.$.defProp(t[d],"polymorphic",!0),y=store.modelFor(y.extend)),store.$.establishObserverBindings(t,t.$.model._properties),store.$.defArrUtls(t[d]),store.$.defPolyUtls(t[d]),store.$.defUtls(t[d],y,t,d)}var u,v=e?store.modelFor(e.relatedTo):void 0;if(0==s||!this.hasDuplicateRelation(o,t[d],e?v._pK:void 0,c,v))void 0!=a?this.handleArrOp(t[d],"insertAt",o,a):this.handleArrOp(t[d],"push",o),(!i||n)&&e.opts&&e.opts.serialize&&(u=store.$.partialData(t,d,o.$.pK,"added",void 0,n),p.relKey=d,p.model=t.$.model._name),f=!0}var h=!1;if(i||1!=f||(h=!u),null===r)return o.hasOwnProperty(m)&&delete o[m],!0;if(r.dummy||e==r)this.singleEstablishLink(e,t,o);else{var m=r.relKey,$=o.$.model;if(!this.checkForCorrectRelation(r,t))return"ERR14";if("belongsTo"==r.relType)void 0!=o[m]&&o[r.relKey]!==t&&this.toDemolishLink($,o,r,i),o[m]!==t&&(store.$.cmpSet(o,m,t,void 0,!0),o.$.partial&&Object.keys(o.$.partial).length&&o.$.partial[m]&&delete o.$.partial[m],!0);else if("hasMany"===r.relType){o[m]||store.$.cmpSet(o,m,[],void 0,!0),o[m].model||(store.$.defArrUtls(o[m]),store.$.defPolyUtls(o[m]),store.$.defUtls(o[m],t.$.model,o,m));var g,b,_=r?store.modelFor(r.relatedTo):void 0;this.hasDuplicateRelation(t,o[m],r?_._pK:void 0,c,_)||(this.handleArrOp(o[m],"push",t),(!i||n)&&r.opts&&r.opts.serialize&&(g=store.$.partialData(o,m,t.$.pK,"added",void 0,n)),i||(b=!g))}}if(h){if(e.opts&&e.opts&&e.opts.deepNest){c="added";t[e.relKey].partial&&t[e.relKey].partial.get(o.$.pK)&&(c=t[e.relKey].partial.get(o.$.pK).type),store.$.setDeepNest(t,e.relKey,o.$.pK,c),b=!1}b&&r&&r.opts&&r.opts.deepNest&&store.$.setDeepNest(o,r.relKey,t.$.pK,"added")}return!0},toDemolishRelation:function(e,r,t,o,a,i){var s=e.data[r],n=e.relations;for(var d in n)for(var l=n[d],c=0;c<l.length;c++){var p=l[c],f=store.modelFor(p.relatedTo);if(f){var y=store.$.getBackwardRel(e,p,f);if(!s[p.relKey]&&!p.dummy&&p!==y)continue;this.toDemolishLink(e,s,p,t,o,a,i)}}},toDemolishLink:function(e,r,t,o,a,i,s){var n=r[t.relKey],d=e._pK,l=store.modelFor(t.relatedTo);if(l){l._pK,t.relatedTo;var c=this.getBackwardRel(e,t,l);t.opts&&t.opts.serialize;(t.dummy||t===c)&&(n=this.getRelatedRecord(r,t.relatedTo,t.dummy?t.dummy:t.relKey));if(c)if(Array.isArray(n))for(var p=0;p<n.length;p++)this.demolishLink(r,d,n[p],c.relKey,t,c,o,void 0,a,i,s);else Lyte.isRecord(n)&&this.demolishLink(r,d,n,c.relKey,t,c,o,void 0,a,i,s)}},demolishSingleRelation:function(e,r,t,o,a,i,s){var n,d;Lyte.isRecord(e)&&(n=e.$._relationships)&&n[r]&&n[r][t]&&!1!==i&&!0!==s&&(n=n[r][t],(d=this.getIndex(n,a,o[a]))>-1&&n.splice(d,1))},demolishLink:function(e,r,t,o,a,i,s,n,d,l,c){var p,f=t[o],y=t.$.model,u=e.$.pK,v=f?f.polymorphic:void 0;if(Array.isArray(f)){var h=this.getIndex(f,r,u,v?e._type:void 0),m=t.$._attributes,$=m.hasOwnProperty(o)&&m[o]&&m[o].length?t.$.getInitialValues(o):void 0,g=!(!f.partial||!f.partial.has(u)||"added"!=f.partial.get(u).type);-1!=h&&(g||!1!==d&&!0!==l)&&(v&&(p=f[h].$.model._name),this.handleArrOp(t[o],"removeAt",void 0,h,1)),!n&&$&&(store.$.hasRecordsArrayChanged(t,o,$)||(delete t.$._attributes[o],Object.keys(t.$._attributes).length||(store.$.cmpSet(t.$,"isModified",!1),store.$.changePersist(t,!0),t.$.isNew||(store.$.deleteFromArray(y.dirty,t[y._pK]),(!t.$.dN||t.$.dN&&!Object.keys(t.$.dN).length)&&store.$.removeParentNesting(t)))))}else f&&("object"==typeof f||Lyte.isRecord(f))&&!1!==d&&!0!==l?void 0!=Lyte&&void 0!=Lyte.objectUtils?Lyte.objectUtils(t,"delete",o,void 0,void 0,!0):delete t[o]:this.demolishSingleRelation(t,e.$.model._name,a.relKey,e,r,d,l);if(i||(i=y.fieldList[o]),(!s||c)&&!0!==d){var b,_;if(i){i.opts&&("partial"==i.opts.serialize,_=!!i.opts.serialize,b=i.opts.deepNest);var R=i?i.relType:void 0}if("belongsTo"==R&&_&&!e.$.isNew){var k=t.$.partial=t.$.partial||{};c?(k&&k.hasOwnProperty(o)&&k[o].has(u)&&k[o].delete(u),b&&store.$.deleteDeepNest(t,o,u),b=!1):((k=k[o]=k[o]||new Map).has(u)||k.set(u,{}),(k=k.get(u)).type="removed")}i&&i.opts&&i.opts.serialize&&(b=(!store.$.partialData(t,o,u,"removed",p,c)||"hasMany"!=R)&&b),b&&(store.$.makeDirty("dirty",t,"removed",i,u),store.$.addDeepNest(t))}},rllBckRecArr:function(e,r,t,o){var a={},i=t._pK,s=store.modelFor(o.relatedTo)._pK;store.$.getRelations(t,o.relKey,store.modelFor(o.relatedTo),a);for(var n=e.length-1;n>=0;n--){var d=e[n].records;if("added"==e[n]._type)for(var l=0;l<d.length;l++){(y=d[l])&&y.$&&y.$.hasOwnProperty("pK")&&(this.demolishLink(y,s,r,a.forward.relKey),null!=a.backward&&this.demolishLink(r,i,y,a.backward.relKey,a.forward))}else if("removed"==e[n]._type)for(l=d.length-1;l>=0;l--){(y=d[l])&&y.$&&y.$.hasOwnProperty("pK")&&this.establishLink(a.forward,a.backward,r,y,e[n]._indices[l])}else if("changed"==e[n]._type){var c=r[o.relKey];Array.isArray(c)||(c=[c]);for(var p=c.length,f=0;f<p;f++){(y=c[0])&&y.$&&y.$.hasOwnProperty("pK")&&(this.demolishLink(y,s,r,a.forward.relKey),null!=a.backward&&this.demolishLink(r,i,y,a.backward.relKey,a.forward))}Array.isArray(d)||(d=[d]);for(l=0;l<d.length;l++){var y;"string"==typeof(y=d[l])&&(y=store.$.peekRecord(a.forward.relatedTo,y)),y&&y.$&&y.$.hasOwnProperty("pK")&&this.establishLink(a.forward,a.backward,r,y,void 0)}}}},sortBy:function(e,r){var t=store.$.mapBy.call(this,e),o=this.model.fieldList[e];o&&"string"==o.type?(t.sort(),"desc"==r&&t.reverse()):(t.sort(function(e,r){return e-r}),"desc"==r&&t.sort(function(e,r){return r-e}));for(var a=this.slice(0),i=[],s=0;s<t.length;s++)if(void 0!=t[s]){var n=store.$.getIndex(a,e,t[s]);i.push(a[n]),a.splice(n,1)}return a.length>0&&(i="desc"==r?i.concat(a):a.concat(i)),store.$.defArrUtls(i),store.$.defUtls(i,this.model),i},mapBy:function(e){return this.map(function(r){return r.$.get(e)})},revertToOldVal:function(e,r,t,o){if(void 0!=t&&0!=t.length){Array.isArray(t)||(t=[t]);for(var a=0;a<t.length;a++){var i=o.forward.relatedTo,s=store.$.peekRecord(i,t[a]);this.establishLink(o.forward,o.backward,e,s,void 0)}}},removePartial:function(e,r){var t=e.$.partial;t&&t[r]&&delete t[r]},findCurrentInd:function(e,r){var t,o,a=!1;return e._deleted.forEach(function(e,i){a&&e.index<t&&o--,i==r&&(a=!0,o=t=e.index)}),o},modifyDelInd:function(e,r){var t,o=!1;e._deleted.forEach(function(e,a){o&&e.index>=t&&(e.index=e.index+1),a==r&&(o=!0,t=e.index)})},rollBackDelete:function(e,r,t,o){var a=[],i=e._name;if(r){var s=e._deleted.get(r),n=e._pK;a=[s]}else e._deleted.forEach(function(e){a.push(e)});for(var d=this,l=a.length-1;l>=0;l--){var c=(s=a[l]).data,p=e.data._recMap?e.data._recMap.get(c.$.pK):-1!==e.data.indexOf(c);if(Lyte.isRecord(c)){store.$.cmpSet(c.$,"isDeleted",!1),store.$.changePersist(c,!0);var f=store.$.isDuplicateRecord(e,c);if(p)store.$.addDeepNest(c,void 0,"added");else{t?d.handleArrOp(e.data,"insertAt",c,s.index):d.handleArrOp(e.data,"push",c),e.emit("add",[c]),store.emit("add",[e._name,c]);var y=e.relations;if(y)for(var u in y){(y[u]||[]).forEach(function(r){var t,o,a;r.relKey;o=store.modelFor(r.relatedTo),t=d.getBackwardRel(e,r,o),a=r.relKey&&r!=t?c[r.relKey]:store.$.getRelatedRecord(c,r.relatedTo,r.dummy?r.dummy:r.relKey),Array.isArray(a)?a.forEach(function(e,o){r==t?d.establishLink(t,r,e,c,void 0,!1):d.establishLink(r,t,c,e,void 0,!1)}):r==t?d.establishLink(t,r,a,c,void 0,!1):d.establishLink(r,t,c,a,void 0,!1)})}}var v=store.model.cachedQueries;if(v){var h=v[i];if(h&&h.length)for(var m=h.length-1;m>=0;m--){if((s=h[m])&&s.hasDeletedRecords)-1!=s.data[i].indexOf(c)&&delete s.hasDeletedRecords}}(c.$.isNew||c.$.isModified)&&this.checkAndAddToArray(e.dirty,c[e._pK]),store.$.clrRecErr(c.$,n,"ERR17"),f||e.data._recMap.set("object"==typeof c.$.pK?c.$.pK:c.$.pK.toString(),c),e._deleted.delete(c.$.pK)}}},rollBackNew:function(e,r,t,o){store.$.removeFromStore(e,r.$.pK,!0,o)},emit:function(e,r,t,o){r.$.emit(e,[r,t,o]),r.$.model.emit(e,[r,t,o]),store.emit(e,[r.$.model._name,r,t,o])},hasRecordsArrayChanged:function(e,r,t){var o=t||e.$.getInitialValues(r),a=!0;e.$.model._pK;if(o&&o.length==e[r].length){a=!1;for(var i=0;i<o.length;i++)if(-1==e[r].indexOf(o[i]))return!0}return a},setRecErr:function(e,r,t,o){store.$.cmpSet(e,"isError",!0);var a=t;if("object"==typeof a)store.$.cmpSet(e.error,r,a);else{if("string"==typeof t)a=Lyte.errorCodes[t]?{code:t,message:Lyte.errorCodes[t]}:t;store.$.cmpSet(e.error,r,a),o&&store.$.cmpSet(e.error[r],"value",o)}store.$.emit("error",e.record,r,a)},clrRecErr:function(e,r,t){var o=Lyte.objectUtils,a=e.error;if(t)e.error.code==t&&(void 0!==o?o(a,"delete",r):delete a[r]);else if(r)void 0!==o?o(a,"delete",r):delete a[r];else if(void 0!==o)for(var i in a)o(a,"delete",i);else e.error={};0==Object.keys(e.error).length&&store.$.cmpSet(e,"isError",!1)},cacheQuery:function(e,r,t,o){var a=store.model.cachedQueries;(a=(a=store.model.cachedQueries=a||{})[e]=a[e]||[]).push({cacheQuery:r,data:t,status:o})},cacheRecordQuery:function(e,r,t,o,a){var i=store.model.cachedRecordQueries;(i=(i=(i=store.model.cachedRecordQueries=i||{})[e]=i[e]||{})[r]=i[r]||[]).push({cacheQuery:t,data:o,status:a})},isModelDataArray:function(e){if(Array.isArray(e)&&(e.modelless||e.model&&e.model instanceof Model&&!e.polymorphic))return!0},handleArrOp:function(e,r,t,o,a){a=void 0!=a?a:0;var i,s,n=void 0!==Lyte.arrayUtils;if(e.key&&e.record){var d=e.record.$.model.fieldList[e.key],l=!1;d&&d.opts&&d.opts.sort&&(d.opts.sort.sortFn?(s=d.opts.sort.sortFn,d.opts.sort.observes&&(l=!0)):s={sortBy:d.opts.sort.sortBy||"$.created_Time",sortOrder:d.opts.sort.sortOrder})}else e.model&&e.model.sort&&(s=e.model.sort.sortBy?{sortBy:e.model.sort.sortBy,sortOrder:e.model.sort.sortOrder}:{sortBy:"$.created_Time",sortOrder:e.model.sort.sortOrder,defaultSort:!0});switch(r){case"push":this.isModelDataArray(e)&&(void 0==e._recMap&&store.$.defProp(e,"_recMap",new Map),e.modelless?e._recMap.set(t[e.pK],t):e._recMap.set("object"==typeof t.$.pK?t.$.pK:t.$.pK.toString(),t)),i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.push(t):n?Lyte.arrayUtils(e,r,t):e.push(t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"removeAt":if(this.isModelDataArray(e))for(var c=a,p=0;p<c;p++){var f=void 0;if(e.modelless)f=e[o+p][e.pK];else{var y=e[o+p]?e[o+p].$.pK:void 0;f=y="object"==typeof y?y:y.toString()}void 0!==f&&e._recMap&&e._recMap.delete(f)}var u=e[o];l&&u&&u.$&&!store.$.changeRelPkMaps(u,void 0,void 0,"srtObsChk",e.key)&&u.$.hasOwnProperty("srtObs")&&(u.$.srtObs=!1),i=n?Lyte.arrayUtils(e,r,o,a):e.splice(o,a);break;case"insertAt":this.isModelDataArray(e)&&(void 0==e._recMap&&store.$.defProp(e,"_recMap",new Map),e.modelless?e._recMap.set(t[e.pK],t):e._recMap.set("object"==typeof t.$.pK?t.$.pK:t.$.pK.toString(),t)),i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.splice(o,a,t):n?Lyte.arrayUtils(e,r,o,t):e.splice(o,a,t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"replaceAt":i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.splice(o,a,t):n?Lyte.arrayUtils(e,r,o,t):e.splice(o,a,t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"sort":i=Lyte.arrayUtils(e,"sort",s);break;default:Lyte.error("LD07",r)}return i},defpayObjUtls:function(e){Object.defineProperties(e,{set:{value:store.$.payloadSet},remove:{value:store.$.payloadRemove}})},defPayArrUtls:function(e){Object.defineProperties(e,{add:{value:store.$.payloadAdd},remove:{value:store.$.payloadRemove}})},defArrUtls:function(e){Object.defineProperties(e,{filterBy:{value:store.$.filterBy},sortBy:{value:store.$.sortBy},mapBy:{value:store.$.mapBy}})},defPolyUtls:function(e){Object.defineProperties(e,{add:{value:store.$.add},remove:{value:store.$.remove}})},defUtls:function(e,r,t,o){r&&store.$.defProp(e,"model",r),t&&store.$.defProp(e,"record",t,!1,!0),o&&store.$.defProp(e,"key",o)},defPar:function(e){store.$.defProp(e,"partial",new Map)},cmpSet:function(e,r,t,o,a){void 0!==Lyte.Component?Lyte.Component.set(e,r,t,o,a):e[r]=t},defProp:function(e,r,t,o,a){o=!!o,a=!!a,Object.defineProperty(e,r,{value:t,enumerable:o,writable:a})},removeChildRecords:function(e,r,t,o){if(!t.get(r)&&e){t.set(r,!0);var a=r?r.$.pK:void 0,i=[],s=e._fldGrps.inherit;for(var n in s){var d=s[n].relKey?s[n].relKey:void 0;if(r&&d)if("belongsTo"==e.fieldList[d].relType&&r[e.fieldList[d].relKey])this.removeChildRecords(store.modelFor(e.fieldList[d].relatedTo),r[e.fieldList[d].relKey],t);else if("hasMany"==e.fieldList[d].relType&&r[e.fieldList[d].relKey])for(var l=r[e.fieldList[d].relKey].length-1;l>=0;l--)this.removeChildRecords(store.modelFor(e.fieldList[d].relatedTo),r[e.fieldList[d].relKey][l],t)}i.push(a),this.removeFromStore(e,i,!0,!0,void 0,void 0,o)}},rBinherit:function(e,r){var t=e.record,o=e.model._fldGrps.inherit;for(var a in o){if(o[a].opts&&o[a].opts.inherit&&t[o[a].relKey])if("belongsTo"===o[a].relType)(n=t[o[a].relKey])&&!r.get(n)&&(r.set(n,!0),this.rollBackRecord(n.$,{inherit:!0}),store.$.rBinherit(n.$,r));else if("hasMany"===o[a].relType){var i=t[o[a].relKey].length;if(0!=i)for(var s=i-1;s>=0;s--){var n;(n=t[o[a].relKey][s])&&!r.get(n)&&(r.set(n,!0),this.rollBackRecord(n.$,{inherit:!0}),store.$.rBinherit(n.$,r))}}}},rollBackRecord:function(e,r){var t=e.model,o=t._pK;e.isModified&&(e.rollBackAttributes(e.getDirtyAttributes(),r),delete e._savedState),e.isDeleted?store.$.rollBackDelete(t,e.get(o),void 0,r):e.isNew?store.$.rollBackNew(t,e.record,o,r):e.isError&&store.$.clrRecErr(e),store.$.removeOnSave(e.model._name,e.record.$.pK)},buildVariables:function(e,r,t,o){for(var a in e=e||{},r){if(-1!=r[a].search(/!/g)&&!e[a]&&!t)return{LdEr:"LD30",LyteError:"ERR30",key:a};-1!=r[a].search(/!/g)&&(r[a]=r[a].replace(/!/g,"")),t&&-1==r[a].search(/\./g)&&("ID"!=r[a]&&"ID!"!=r[a]||(e[a]=t));var i={LdEr:"LD31",LyteError:"ERR30",key:a};if(e&&e[a])switch(r[a]){case"Int":if("number"!=typeof e[a])return i;break;case"String":if("string"!=typeof e[a])return i;break;case"Float":if("number"!=typeof e[a])return i;break;case"Boolean":if("boolean"!=typeof e[a])return i;break;case"Object":if("object"!=typeof e[a])return i}}for(var s in e)"string"!=typeof e[s]&&"object"!=typeof e[s]||(e[s]=store.$.LyteStringfy(e[s],""));return e},buildQuery:function(e,r,t,o,a,i,s,n,d,l){var c="",p=!1;for(var f in t)if("object"==typeof t[f]){if(c+=Object.keys(t)[0]+" ",s){for(var y in c+="( ",s)if(-1==y.search(/[.]/g)&&""==a)c+=y+":"+s[y]+" ";else if(""!=a&&-1!=y.search(/[.]/g)&&a==y.match(/.*(?=\..*$)/g)[0]){var u=y.split(".");c+=u[u.length-1]+":"+s[y]+" "}c=(c+=") ").replace(/\([ ]*\)/g,"")}c+="{ ";for(var v=0;v<t[f].length;v++){var h=t[f][v];p=!1,d&&(p=!("string"!=typeof h||!d.includes(h)||""!=a)||!("object"!=typeof h||!d.includes(Object.keys(h)[0])||""!=a)),p||("string"==typeof h?c=c+h+" ":(a=(a?a+".":"")+Object.keys(h)[0],c+=store.$.buildQuery(e,r,h,o,a,i,s,n,d,l),a=f==i?"":f))}c+=" } "}return c},QueryCallback:function(e,r,t,o,a,i,s,n,d){var l;if("object"==typeof o){for(var c=Object.keys(o)[0],p=0;p<o[c].length;p++){var f=o[c][p];"object"==typeof f&&store.modelFor(e).fieldList[Object.keys(f)[0]]&&store.modelFor(e).fieldList[Object.keys(f)[0]].relatedTo&&(l=store.modelFor(e).fieldList[Object.keys(f)[0]].relatedTo,store.$.QueryCallback(l,r,t,f,a,i,s,n,d))}var y=store.$.initCB("serializer",e,"serializeSelfQuery",{args:[e,r,d,o,a,i]});if(y){var u=y.data[Object.keys(o)[0]];o[Object.keys(o)[0]]=u}}},buildFields:function(e,r,t,o,a,i){var s=store.modelFor(e),n=s.fieldList,d=s.gql&&s.gql.localAttrs?s.gql.localAttrs:[];i?n=i:a.set(e,!0);var l={},c=[];for(var p in n)if(!d.includes(p)){if("relation"==n[p].type){if(store.modelFor(n[p].relatedTo)&&n[p].relatedTo!=o&&n[p].relatedTo!=e){var f=store.$.getBackwardRel(store.modelFor(e),n[p],store.modelFor(n[p].relatedTo));if(f&&f.relatedTo==r&&void 0==f.dummy)continue;a.has(n[p].relatedTo)||c.push(store.$.buildFields(n[p].relatedTo,n[p].relatedTo,p,o,a))}continue}"object"==n[p].type&&n[p].properties?c.push(store.$.buildFields(e,r,p,o,a,n[p].properties)):c.push(p)}return l[t]=c,a.delete(e),l},parseQuery:function(e,r,t,o,a,i,s,n,d,l,c){var p,f,y,u={},v={};if("object"==typeof i){var h,m;"variables"!=(m=Object.keys(i.query))[0]?m[0]:m[1];f=Object.assign({},i.query.variables),v["variables"!=m[0]?m[0]:m[1]]=Object.assign(i.query["variables"!=m[0]?m[0]:m[1]]),"object"==typeof v&&(h=v)}if("string"==typeof i&&-1!=i.search(/[ ]/g)){var $=i,g={};$=($=($=($=($=($=($=($=($=($=($=($=($=($=($=$.replace(new RegExp("\n","g")," ")).replace(/ *[ ]*\(/g,":{variables:[")).replace(/ *\) *{/g,"],attrs:[")).replace(/\w+/g,'"$&"')).replace(/"!/g,'!"')).replace(/" +"/g,'", "')).replace(/\S+{"variables"/g,"{$&")).replace(/} *"/g,'}, "')).replace(/" *{/g,'" :{"attrs" :[')).replace(/\} *\}/g,"]}}")).replace(/" *}/g,'"]} }')).replace(/]}}/g,"]}}]}}")).replace(/]}}]}} *}/g,"]}}]}}]}}")).replace(/} *{/g,"},{")).replace(/\S+ *:{"attrs"/g,"{$&"),$=JSON.parse($),h=store.$.buildQueryFields($,g,"",Object.keys($)[0]),f=g}if("object"==typeof h){store.$.QueryCallback(e,t,e,h,s,h,f,o,n),a.query=h,s&&(a.variables=s);var b=Object.keys(f)[0];"Mutation"!=a.type||1!=Object.keys(f).length||"Object"!=f[b]&&"Object!"!=f[b]?a.variables:a.variables[b]=l;var _=store.$.initCB("serializer",e,"serializeGqlQuery",{args:[e,t,r,a,n,l,c]});if(_&&(h=_.data.query,_.data.variables&&(s=_.data.variables)),(y=store.$.buildVariables(s,f,r,n.type))&&y.LdEr)return y;n.gqlObj=a,p="{ "+(p=store.$.buildQuery(e,t,h,f,"",Object.keys(h)[0],0!=Object.keys(y).length?y:void 0,r,d,e))+" }"}return"Query"==a.type?u.query=p:u.query="mutation "+p,u},graphQlconfig:function(e,r,t,o,a,i,s,n,d){var l,c,p={},f=store.modelFor(e),y={},u=new Map,v=f.gql&&f.gql.localAttrs?f.gql.localAttrs:[];if("findAll"==t||"findRecord"==t){if(y.type="Query",void 0===(c=f.gql&&f.gql.query&&f.gql.query[a]?f.gql.query[a]:a)){var h=store.$.buildFields(e,null,e,e,u);(l={}).query=h,y.queryType="default"}else if("string"==typeof a&&-1!=a.search(/[ ]/g))l=a,y.queryType="query";else if("object"==typeof a)l=a;else if("object"==typeof c)l=c;else{if("string"!=typeof c||-1==c.search(/[ ]/g))return{LdEr:"LD32",LyteError:"ERR31",key:a};l=c,y.queryType="namedQuery",y.queryName=a}i=i?Object.assign({},i):void 0}else if(y.type="Mutation",c=f.gql&&f.gql.mutation&&f.gql.mutation[a]?f.gql.mutation[a]:a,"string"==typeof a&&-1!=a.search(/[ ]/g))l=a,y.mutationType="customMutation";else{if("string"!=typeof c||-1==c.search(/[ ]/g))return{LdEr:"LD32",LyteError:"ERR31",key:a};l=c,y.mutationType="namedMutation",y.MutationName=a}var m=store.$.parseQuery(e,r,t,o,y,l,i,s,v,n,d);return m.LdEr?m:(p.data=JSON.stringify(m),p.data)},setQuery:function(e,r,t,o){var a=e;a.gql?(a.gql[t]=a.gql[t]?a.gql[t]:{},a.gql[t][r]=a.gql[t][r]?a.gql[t][r]:{}):(a.gql={},a.gql[t]={},a.gql[t][r]={}),a.gql[t][r]=o},buildQueryFields:function(e,r,t,o){var a=Object.keys(e)[0],i=[],s={};if(e[a].variables)for(var n=0;n<e[a].variables.length;n+=2)r[(t?t+".":"")+e[a].variables[n]]=e[a].variables[n+1];for(var d=0;d<e[a].attrs.length;d++)"object"==typeof e[a].attrs[d]?(t=(t?t+".":"")+Object.keys(e[a].attrs[d])[0],i.push(this.buildQueryFields(e[a].attrs[d],r,t,o)),t=a!=o?a:""):i.push(e[a].attrs[d]);return s[a]=i,s},LyteStringfy:function(e,r,t){if("string"==typeof e)return'"'+e+'" ';if(Array.isArray(e)){r+="[";var o=0,a=e.length;e.forEach(function(t){o++,"string"==typeof t?r=r+'"'+t+'" ':"object"==typeof t?r=store.$.LyteStringfy(t,r):"number"==typeof t&&(r+=e.toString()),r=o!=a?r+",":r}),r+="]"}else{if(!e||Array.isArray(e)||"object"!=typeof e)return e.toString();r+="{";var i=0;for(var o in e)i++,"string"==typeof e[o]?r=r+o+' : "'+e[o]+'" ':"object"==typeof e[o]?(r=r+o+" : ",r=store.$.LyteStringfy(e[o],r)):r=r+o+" : "+e[o].toString(),Object.keys(e).length!=i&&(r+=", ");r+="}"}return r},cpdGql:function(e,r,t,o,a,i){o.gql&&("object"==typeof o.gql?mutName=o.gql.mutation:1==o.gql&&(mutName=void 0),o.data=store.$.graphQlconfig(e,void 0,r,t,mutName,[],o,a,i))},payloadAdd:function(e,r){Array.isArray(e)||(e=[e]);for(var t=this._model,o=this._partialObj,a=this._payloadObj,i={opts:{serialize:this._serialize}},s={},n={},d=0;d<e.length;d++){if(o._removedRecords&&o._removedRecords.hasOwnProperty(e[d]))s=o._removedRecords[e[d]]._payload,n=o._removedRecords[e[d]]._partial,delete o._removedRecords[e[d]];else{var l=store.$.peekRecord(t,e[d]),c=store.$.PayloadSerialize(i,s,l,void 0,store.modelFor(t),n);s=c.payload,n=c.partial}this.partRecMap.get(e[d])||(void 0!=r&&"number"==typeof r?(Lyte.arrayUtils(o,"insertAt",r,n),Lyte.arrayUtils(a,"insertAt",r,_pK),r=r++):(Lyte.arrayUtils(o,"push",n),Lyte.arrayUtils(a,"push",s)),this.partRecMap.set(e[d],!0))}},payloadRemove:function(e){this._model;var r=this._partialObj,t=this._payloadObj;Array.isArray(e)||(e=[e]);for(var o=0;o<e.length;o++)if(Array.isArray(t)){var a=t.length;if(this._serialize&&"id"==this._serialize){if(t.includes(e[o])){var i=t.indexOf(e[o]);t.splice(i,1)}}else for(var s=0;s<a;s++)if(r[s]&&r[s].$.pkVal==e[o]){if(r.hasOwnProperty("_removedRecords"))r._removedRecords[r[s].$.pkVal]={_partial:r[s],_payload:t[s]};else{var n={};n[r[s].$.pkVal]={_partial:r[s],_payload:t[s]},Object.defineProperties(r,{_removedRecords:{value:n}})}Lyte.arrayUtils(r,"removeAt",s,1),Lyte.arrayUtils(t,"removeAt",s,1),this.partRecMap.delete(e[o])}}else t[e[o]]&&(r.hasOwnProperty("_removedAttr")&&!r._removedAttr.hasOwnProperty(e[o])?r._removedAttr[e[o]]={_partial:r[e[o]],_payload:t[e[o]]}:r.hasOwnProperty("_removedAttr")||Object.defineProperties(r,{_removedAttr:{value:{_partial:r[e[o]],_payload:t[e[o]]}}}),r[e[o]]&&(r._removedAttr[e[o]]._partial=r[e[o]],Lyte.objectUtils(r,"delete",e[o])),Lyte.objectUtils(t,"delete",e[o]))},payloadSet:function(e){Array.isArray(e)||(e=[e]);for(var r=this._model,t=this._pkVal,o=store.modelFor(r),a=this._payloadObj,s=store.$.peekRecord(r,t),n=this._partialObj,d=0;d<e.length;d++){var l=e[d];if(!this._payloadObj[l]){if(n.hasOwnProperty("_removedAttr")&&n._removedAttr.hasOwnProperty(l)&&1!=n._removedAttr[l])return a[l]=n._removedAttr[l]._payload,n._removedAttr[l]._partial&&(n[l]=n._removedAttr[l]._partial),void Lyte.objectUtils(n._removedAttr,"delete",l);var c=o.fieldList[l];if(s[l]&&"relation"==c.type)if("hasMany"==c.relType){if(n[l]=[],a[l]=[],c.opts&&"id"==c.opts.serialize&&store.$.payLoadIdSerialize(a,l,s,o,c,n),store.$.defProp(a[l],"$",{}),store.$.defPayArrUtls(a[l].$),Object.defineProperties(a[l].$,{_key:{value:c.relKey},_partialObj:{value:n[l]},_model:{value:c.relatedTo},_payloadObj:{value:a[l]},replace:{value:store.$.replaceCheck,writable:!0},partRecMap:{value:new Map}}),c.opts&&c.opts.serialize&&!a[l].$.serialize&&Object.defineProperty(a[l].$,"_serialize",{value:c.opts.serialize}),c.opts&&"id"!=c.opts.serialize||!c.opts){if("record"==c.opts.serialize)for(i=0;i<s[l].length;i++)a[l].$.add(s[l][i].$.pK);if("partial"==c.opts.serialize)s[l].partial.forEach(function(e,r){a[l].$.add(r)})}}else{n[l]={},a[l]={};var p=store.$.PayloadSerialize(c,a[l],s[l],l,store.modelFor(c.relatedTo),n[l]);a[l]=p.payload,n[l]=p.partial}else a[l]=s[l],n[l]=s[l]}}},payLoadIdSerialize:function(e,r,t,o,a,i){var s={};e[r]=Lyte.deepCopyObject(t[r]),store.$.getRelations(o,r,store.modelFor(a.relatedTo),s),store.$.idSerialize(e,s,void 0,i)},PayloadSerialize:function(e,r,t,o,a,i){var s={};s[t.$.model._pK]=t.$.pK;var n,d="object"==typeof t.$.pK?t.$.pK:s,l=a,c=!1;if(e.opts&&e.opts.serialize){if(n=store.adapter.$.initPartialObj(a._name),"record"==e.opts.serialize&&(d=store.$.toJSON(a._name,t,void 0,void 0,n)),"partial"==e.opts.serialize){var p=store.$.isDirty(t,l.relations),f=t;f.$.isModified||p&&p.length?(y=store.$.updateJSON(f,l,p),d=store.$.toJSON(a._name,y,void 0,void 0,n),c=!0):n.obj.set(t.$.pK,i)}i=n.obj.get(t.$.pK)||i;var y,u={pkVal:{value:t.$.pK},type:{value:"related"},model:{value:l._name},record:{value:t[o]||t}};if(1==c&&(u.type.value="modified"),d&&(r=store.adapter.$.serializeRecords(a._name,d,t,void 0,"serializeRecord",void 0,n.obj)),e.opts&&"id"==e.opts.serialize&&(d=t.$.pK),"object"==typeof r){i&&!i.$&&store.$.defProp(i,"$",{});var v=i.$;Object.defineProperties(v,u),e.opts&&e.opts.serialize&&r.$&&!r.$._serialize&&"belongsTo"==e.relType&&Object.defineProperty(r.$,"_serialize",{value:e.opts.serialize})}return y={payload:r,partial:i}}},replaceCheck:function(e){store.$.defProp(this._partialObj,"replace",e)},savingDonorRecord:function(e){var r=e.donor,t=e.getDirtyAttributes();if(store.$.isDirty(e.record,e.model.relations).length||t.length){var o=e.toJSON("state");store.$.setData(r.$,o,void 0,void 0,void 0,void 0,!0),e.persist()}return r.$},peekRecord:function(e,r,t,o){var a,i=store.modelFor(e),s=store.$.getFromCB("adapter",e,"modelless");if(i=s?e:i){if(1==s&&i){if(!(i=store.modelless[i]))return;a=!0}if(!0===t){var n=i._deleted.get(r);if(n&&n.data)return n.data&&Lyte.getConfig("mutable")?Lyte.mut(n.data):n.data}else{var d=i.isComp;if(r=void 0==r?"":r,!d&&i.data._recMap){var l=i.data._recMap.get(r.toString());return o&&Lyte.getConfig("mutable")?Lyte.mut(l):l}var c,p=i.data;if((c=1!=a?p.filter(function(e){if(store.$.comparePk(e,r))return o&&Lyte.getConfig("mutable")?Lyte.mut(e):e}):p.filter(function(e){if(e[i._pK]===r)return e}))[0])return o&&Lyte.getConfig("mutable")?Lyte.mut(c[0]):c[0]}}else Lyte.warn("LD02","Model ",e)},getCreatedTime:function(e){var r,t=(new Date).getTime().toString(),o=1;switch(e.get(t)?(o=e.get(t),o+=1,e.set(t,o)):(e.clear(),e.set(t,o)),o.toString().length){case 1:r="000"+o;break;case 2:r="00"+o;break;case 3:r="0"+o;break;case 4:r=""+o;break;default:r="9999"}return t+r}}};function Adapter(e,r,t){Object.defineProperty(this,"$lg",{value:Lyte.__gl}),store.$.newCB("adapter",this,t,e,r)}function Serializer(e,r,t){Object.defineProperty(this,"$lg",{value:Lyte.__gl}),store.$.newCB("serializer",this,t,e,r)}store.$.cbDef(Adapter,"adapter"),store.adapter={$:{buildURL:function(e,r,t,o,a,i,s,n,d,l){var c=store.$.getAdapter({name:t}),p=store.$.getFromCB("adapter",t,"host"),f=(d=d||"",store.$.makeBatch),y={method:r};if(!(d=d||""))if(f||void 0!==p&&(d+=p,"/"!=p[p.length-1]&&(d+="/")),l){y.method="POST",y.gql=l,r=y.method;var u=store.$.getFromCB("adapter",t,"gqlNamespace");d+=u||""}else{var v=store.$.getFromCB("adapter",t,"namespace");if(""!==v&&"/"!=v[v.length-1]?d+=v+"/":d+=v,"batch"!=e&&(d+=t,o&&"object"!=typeof o&&(d+="/"+o)),"action"==e){d+="/"+store.$.getFromCB("adapter",t,"actionNamespace");var h=store.modelFor(t).actions;d+="/"+(h[s].endPoint?h[s].endPoint:s)}else"batch"==e&&(d+=store.$.getFromCB("adapter","application","batchNamespace"));y.method=r||""}if(i||(i={}),(g=store.$.initCB("adapter",t,"headersForRequest",{args:[e,i,n,s,o]}))&&(y.headers=g.data),(g=store.$.initCB("adapter",t,"buildURL",{args:[t,e,i,a,d,s,n,o]}))&&(d=g.data),(g=store.$.initCB("adapter",t,"methodForRequest",{args:[r,e,i,n,s,o]}))&&(y.method=g.data),!f&&i&&Object.keys(i).length){d+="?";var m=0;for(var $ in i){var g;0!==m&&(d+="&"),(g=i[$])&&"object"==typeof g&&(g=JSON.stringify(g)),d+=$+"="+encodeURIComponent(g),m++}}return c&&1==c.withCredentials&&(y.withCredentials=!0),y.url=d,y.qP=i,y},get:function(e,r,t,o,a,i,s,n,d){var l,c=store.modelFor(r),p=store.$.makeBatch,f=d||n?{}:void 0,y=store.$.getFromCB("adapter",r,"modelless");if(y&&"string"==typeof r){var u=store.modelless,v=r;def=u[v]=u[v]||{},def._name=v}if(c||r&&y){i=void 0==i?store.$.getFromCB("adapter",r,"customData"):i,n&&(f.query=n),d&&(f.variables=d),l=store.$.initCB("adapter",r,"gql",{args:[r,e,o,t,f,i]});var h=this.buildURL(e,"GET",r,t,void 0,o,void 0,i,void 0,l?l.data:void 0),m=this;if(o=h.qP,toCheckParams=a&&"boolean"!=typeof a?a:o&&"object"==typeof o?o:void 0,h.gql&&("object"==typeof h.gql?(n=h.gql.query,d=h.gql.variables):!0===h.gql&&(n=d=void 0),h.data=store.$.graphQlconfig(r,t,e,o,n,d,h),h.data.LdEr))return Lyte.warn(h.data.LdEr,h.data.key,r),Promise.reject({code:h.data.LyteError,message:Lyte.errorCodes[h.data.LyteError],data:h.data.key});if("findAll"==e&&toCheckParams&&store.model.cachedQueries&&store.model.cachedQueries[r]){for(var $=store.model.cachedQueries[r],g=0;g<$.length;g++){var b=$[g];if(!b.hasDeletedRecords){var _=b.cacheQuery;if(this.compareData(_,toCheckParams,!0)){R=[b.data,"cache",void 0,b.status];break}}}if(R)return new Promise(function(e){p&&store.$.addToCachedBatch(Array.isArray(R)?R[0][r]:R),e(R)})}else if("findRecord"==e&&toCheckParams&&store.model.cachedRecordQueries&&store.model.cachedRecordQueries[r]&&store.model.cachedRecordQueries[r][t]){var R;for($=store.model.cachedRecordQueries[r][t],g=0;g<$.length;g++){_=$[g].cacheQuery;if(this.compareData(_,toCheckParams,!0)){R=[$[g].data,"cache",void 0,$[g].status];break}}if(R)return new Promise(function(e){p&&store.$.addToCachedBatch(Array.isArray(R)?R[0][r]:R),e(R)})}else{var k=store.$.cbScp(r,"findRecord"==e?"reloadRecord":"reloadAll","adapter");if(k){var O,w=!1;if("findRecord"==e?(O=store.$.peekRecord(r,t),w=!!Lyte.isRecord(O)):"findAll"==e&&(w=!(!(O=store.peekAll(r))||!O.length)),w&&!store.$.cB(k,[O,o,i,r])){var P={};return P[r]=O,new Promise(function(e){p&&store.$.addToCachedBatch(P[r]),e([P,"cache"],"success",void 0,!0)})}}}if("POST"==h.method){var A=store.$.initCB("serializer",r,"serialize",{args:[e,h?h.data:void 0,void 0,i,r,o,void 0,h?h.gqlObj:void 0]});A&&(h.data=A.data,!h.data||"object"!=typeof h.data&&!Lyte.isRecord(h.data)&&!Array.isArray(h.data)||h.data instanceof FormData||(h.data=JSON.stringify(h.data)))}return new Promise(function(n,d){var l,c=store.modelFor(r),f=store.$.getIDBObj(c,o,e,t,i),y=store.$.getFromCB("adapter",r,"processRequest"),u=!0,v=!1,$=[r,e,t,h,n,d,"get",void 0,i],g={cacheQuery:a,cacheData:s,customD:i};if(y){u=!1;var b=m.callGeneric(e,r,void 0,void 0,i,o,t,h.url,void 0,h.method,h.headers);b instanceof Promise?(v=!0,b.then(function(o){o=""==o?JSON.parse("{}"):JSON.parse(o),l=m.getResponse(o,r,e,t,h,void 0,i,g),n([l])},function(e){d(e)})):u=!0}p&&!v?store.adapter.$.constructBatch.apply(store.adapter.$,$).then(function(o){var a=o.content;store.adapter.$.getSuccess(r,e,t,h,void 0,n,d,a,o,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,void 0,n,d,g,o.content,o.code,o)}):f?store.adapter.$.getFromIDB(f,r,e,o,t,h,i).then(function(a){var i=store.$.initCB("serializer",r,"idbResponse",{args:[r,e,o,t,a]});i&&(a=i.data),0==a?store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)}):store.adapter.$.getSuccess(r,e,t,h,void 0,n,d,a,void 0,"idb",g)},function(o){store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)})}):u&&store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)})})}return Lyte.warn("LD02","Model",r),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:r})},constructBatch:function(e,r,t,o){return new Promise(function(e,r){var t=store.$.currentBatch,a=store.$.batch[t]=store.$.batch[t]||[],i=store.$.batchPromise[t]=store.$.batchPromise[t]||[],s={};s.method=o.method,s.uri="/"+o.url,s.parameters=o.qP,s.content="string"==typeof o.data?JSON.parse(o.data):void 0,a.push(s),i.push({resolve:e,reject:r})})},getFromIDB:function(e,r,t,o,a,i,s){return new Promise(function(i,n){var d=e.queryCache?"getCachedData":"findAll"==t?"getAll":"get",l={resolve:i,reject:n,type:d,model:r,req:t,key:a};"getCachedData"==d&&(l.queryParams=o),l.queryCache=e.queryCache,l.customData=s,LyteIDB.postMessage(l)})},sendXHR:function(e,r,t,o,a,i,s,n,d){var l=new XMLHttpRequest,c=new Promise(function(a,i){for(var s in l.open(o.method,o.url,!0),o.headers)l.setRequestHeader(s,o.headers[s]);l.withCredentials=!!o.withCredentials,store.$.initCB("adapter",e,"parseRequest",{args:[r,e,l,o?o.qP:void 0,t,d,o.method,o.headers,o.url,!!o.withCredentials,o.data]}),store.emit("beforeRequest",[l,e,r,t,o.qP,o.method,o.headers,o.url,!!o.withCredentials,d,o.data]),l.send(o.data),l.onreadystatechange=function(){if(4==l.readyState)return store.emit("afterRequest",[l,e,r,t,o.qP,o.method,o.headers,o.url,!!o.withCredentials,d,o.data]),"2"==l.status.toString()[0]||"3"==l.status.toString()[0]?a(l):i(l)}});return c.xhr=l,c},getSuccess:function(e,r,t,o,a,i,s,n,d,l,c){var p,f,y=n,u=a,v=c.customD;a&&a.status;if("idb"!=l){if(u&&(y=(y=u.responseText)&&0!=y.length?JSON.parse(y):JSON.parse("{}")),d&&(p=d.index,f=d.batch,u=d.resp),u){var h=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,u,y,o?o.qP:void 0,t,v,c]});if(h&&(y=h.data),y instanceof Promise)return this.handleParseResponsePromise(y,e,r,t,o,a,void 0,p,f,i,s,c)}return this.findParseRequestPromise(y,e,r,t,o,a,p,f,i,c)}i(a?[y,a.statusText,a]:void 0!=p?[y,"batch",{index:p,batch:f}]:l?[y,"idb"]:[y])},getFailure:function(e,r,t,o,a,i,s,n,d,l,c){var p=n.customD;if(a){var f,y=a.responseText;if(y)try{y=""==y?JSON.parse("{}"):JSON.parse(y)}catch(e){Lyte.warn("LD24",e)}f=y;var u=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,a,y,o?o.qP:void 0,t,p,n]});if(u&&(f=u.data),f instanceof Promise)return this.handleParseResponsePromise(f,e,r,t,o,a,void 0,void 0,void 0,i,s,n)}else if(d){var v,h;c&&(h=c.index,v=c.batch),store.$.batchResponse[v][h]={code:l,status:"requestFailure",data:d},s({code:l,status:"requestFailure",data:d})}s(a)},getResponse:function(e,r,t,o,a,i,s,n){if(!0===(void 0===n.cacheData||null===n.cacheData||"object"!=typeof n.cacheData||!n.cacheData.hasOwnProperty("normalize")||n.cacheData.normalize)){var d,l,c,p,f=e=store.serializer.$.normalizeResponse(r,t,e,o,i?i.status:i,a,s,n),y=a?a.qP:void 0;"object"!=typeof f&&(f=JSON.parse(f)),(c=store.$.initCB("serializer",r,"extractMeta",{args:[f,r,t,y,s,n]}))&&(p=c.data,store.$.isEmpty(p)||(f.meta=p));var u=Object.keys(f),v=u.length;if(v){var h;if((c=store.$.initCB("serializer",r,"payloadKey",{args:[r,t,o,y,s,n]}))&&(h=c.data)&&h!=r){var m=f[h];f[r]=m,delete f[h]}if(d=store.$.cbScp(r,"deserializeKey","serializer")){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),v>2&&Lyte.error("LD09");var $=0;2==v&&"meta"==u[0]&&($=1),l=[r,t];var g=store.$.cB(d,l),b=f[u[$]];delete f[u[$]],f[g]=b}store.serializer.$.normalize(r,t,f,o,i?i.status:i,a.headers,s,n,a)}return f}return"object"!=typeof e&&(e=JSON.parse(e)),(c=store.$.initCB("serializer",r,"extractMeta",{args:[e,r,t,y,s,n]}))&&(p=c.data,store.$.isEmpty(p)||(e.meta=p)),e},initPartialObj:function(e,r,t,o,a,i){return{obj:new Map}},create:function(e,r,t,o,a,i){var s=t?"createRecord":"create",n=i?{mutation:i}:void 0,d=store.$.initCB("adapter",e,"gql",{args:[e,s,a,void 0,n,o]});o=void 0==o?store.$.getFromCB("adapter",e,"customData"):o;var l=this.buildURL(s,"POST",e,void 0,r,a,void 0,o,void 0,d?d.data:void 0);a=l.qP;var c=this.initPartialObj(e,s,a,void 0,l.url,o),p=store.$.toJSON(e,r,void 0,"create",c);return this.sendingData(e,p,l,s,o,r,c.obj),l.gql&&store.$.cpdGql(e,s,a,l,p,o),this.handleRequest(l,e,r,s,p,o,c.obj,void 0,void 0,c.ref)},put:function(e,r,t,o,a,i,s){var n=store.model[e],d=n.bK,l=n.isComp,c=s?{mutation:s}:void 0,p=o?"updateRecord":"update",f=(new Map,o?l&&d?t[d]:t.$.pK:void 0),y=store.$.initCB("adapter",e,"gql",{args:[e,p,i,void 0,c,a]});a=void 0==a?store.$.getFromCB("adapter",e,"customData"):a;var u=this.buildURL(p,"PATCH",e,f,r,i,void 0,a,void 0,y?y.data:void 0);i=u.qP;var v=this.initPartialObj(e,p,i,f,u.url,a),h=store.$.toJSON(e,r,void 0,void 0,v);return this.sendingData(e,h,u,p,a,t,v.obj),u.gql&&store.$.cpdGql(e,p,i,u,h,a),this.handleRequest(u,e,t,p,h,a,v.obj,void 0,void 0,v.ref)},del:function(e,r,t,o,a,i,s){var n=store.model[e],d=n.bK,l=n.isComp,c=s?{mutation:s}:void 0,p=o||"deleteRecord",f=t?l&&d?r[d]:r.$.pK:void 0;a=void 0==a?store.$.getFromCB("adapter",e,"customData"):a;var y=store.$.initCB("adapter",e,"gql",{args:[e,p,i,void 0,c,a]}),u=this.buildURL(p,"DELETE",e,f,r,i,void 0,a,void 0,y?y.data:void 0);i=u.qP;this.initPartialObj(e,p,i,f,u.url,a);var v=[];t||(v=r.map(function(e){return e.$.pK}));var h=t?r?r.$.pK:void 0:v;return this.sendingData(e,h,u,p,a,r),u.gql&&store.$.cpdGql(e,p,i,u,h,a),this.handleRequest(u,e,r,p,h,a,void 0,f)},sendingData:function(e,r,t,o,a,i,s){var n,d=e,l={},c=t?t.qP:void 0,p={};for(var f in t)p[f]=t[f];p.type=o,p.model=e,(n=store.$.initCB("serializer",e,"serializeKey",{args:[e,o,a,c]}))&&(d=n.data),r=this.serializeRecords(e,r,i,p,"serializeRecord",a,s),d?(Array.isArray(r)||"object"==typeof r||Lyte.isRecord(r))&&(l[d]=r):l=r,(n=store.$.initCB("serializer",e,"serialize",{args:[o,l,i,a,e,c,t?t.gqlObj:void 0]}))&&(l=n.data),t.data=l},serializeRecords:function(e,r,t,o,a,i,s){store.$.getFromCB("adapter",e,"modelless");var n=store.modelFor(e);if(!n)return r;var d,l=n.relations;if(t||"normalizeRecord"==a||(t=store.$.peekRecord(n._name,r.$.pK)),Array.isArray(r)){d=[];for(var c=0;c<r.length;c++){var p=r[c];p&&"object"==typeof p?d.push(this.serializeSingleRecord(n._name,p,t?t[c]:void 0,o,l,a,i,s)):d.push(p)}}else r&&(d=r,"object"==typeof r&&(d=this.serializeSingleRecord(n._name,r,t,o,l,a,i,s)));return d},serializeSingleRecord:function(e,r,t,o,a,i,s,n){var d;if("serializeRecord"==i&&"object"==typeof r&&void 0==r.$&&store.$.defProp(r,"$",{}),"normalizeRecord"==i&&Lyte.isRecord(r))return r;if("object"==typeof n&&t&&t.$&&t.$.pK){var l;if(d=n.get?n.get(t.$.pK):n,r.$&&r.$._partialObj)l=Object.assign({},r.$),r=Object.assign({},r),store.$.defProp(r,"$",l);var c=store.$.isDirty(t,t.$.model.relations);if(t.$.isModified||Array.isArray(c)&&0!=c.length){var p=t.$.getDirtyAttributes();Array.isArray(c)&&p.concat(c);var f=Object.keys(r);d.hasOwnProperty("_removedAttr")||Object.defineProperties(d,{_removedAttr:{value:{}}}),p.forEach(function(e){f.includes(e)||t.$.model._arrPk.includes(e)||(d._removedAttr[e]=!0)})}Object.defineProperties(r.$,{_partialObj:{value:d},_pkVal:{value:t.$.pK},_model:{value:e},_payloadObj:{value:r}})}"serializeRecord"==i&&store.$.defpayObjUtls(r.$);var y,u=store.$.cbScp(e,i,"serializer");u&&(y="serializeRecord"==i?[o,r,t,e,s]:[o,r,e,s],r=store.$.cB(u,y));for(var v in a)for(var h=a[v],m=h.length,$=0;$<m;$++){var g,b,_,R,k=h[$],O=r[k.relKey];if("relation"==k.type&&O&&("normalizeRecord"==i||"serializeRecord"==i&&k.opts&&k.opts.serialize&&"id"!=k.opts.serialize))if(g=t?t[k.relKey]:void 0,b=k.relatedTo,_=k.opts?k.opts.serialize:void 0,R=k.opts?k.opts.polymorphic:void 0,"hasMany"===k.relType){Array.isArray(O)||(O=[O]);var w=O.length,P=[];"serializeRecord"==i&&(store.$.defProp(P,"$",{}),store.$.defPayArrUtls(P.$),d&&d[k.relKey]&&(Object.defineProperties(P.$,{_key:{value:k.relKey},_partialObj:{value:d[k.relKey]},_model:{value:b},_payloadObj:{value:P},replace:{value:store.$.replaceCheck,writable:!0},partRecMap:{value:new Map}}),k.opts&&k.opts.serialize&&Object.defineProperty(P.$,"_serialize",{value:k.opts.serialize})));for(var A=0;A<w;A++){var L=b;if(R&&("normalizeRecord"==i?L=O[A]&&O[A]._type?O[A]._type:b:"serializeRecord"==i&&("record"==_?L=g&&Lyte.isRecord(g[A])?g[A].$.model._name:b:"partial"==_&&(L=O[A]&&O[A].$?O[A].$.polymorphicType:b))),"serializeRecord"==i){var j=store.modelFor(b)._pK;P.$.partRecMap.set(O[A][j],!0)}P.push(this.serializeRecords(L,O[A],void 0,o,i,s,d?d[k.relKey][A]:void 0))}r[k.relKey]=P}else{L=b;R&&("normalizeRecord"==i?L=r[k.relKey]&&r[k.relKey]._type?r[k.relKey]._type:b:"serializeRecord"==i&&(L=Lyte.isRecord(t[k.relKey])?t[k.relKey].$.model._name:b)),O&&"object"==typeof O&&!O.$&&k.opts&&k.opts.serialize&&(store.$.defProp(O,"$",{}),Object.defineProperty(O.$,"_serialize",{value:k.opts.serialize})),r[k.relKey]=this.serializeRecords(L,r[k.relKey],t?t[k.relKey]:void 0,o,i,s,d?d[k.relKey]:void 0)}else"serializeRecord"==i&&k.opts&&k.opts.serialize&&"id"==k.opts.serialize&&"relation"==k.type&&"hsaMany"==k.relType&&(store.$.defProp(r[k.relKey],"$",{}),store.$.defPayArrUtls(r[k.relKey].$),d&&d[k.relKey]&&(Object.defineProperties(r[k.relKey].$,{_key:{value:k.relKey},_partialObj:{value:d[k.relKey]},_model:{value:b},_payloadObj:{value:r[k.relKey]},replace:{value:store.$.replaceCheck,writable:!0}}),k.opts&&k.opts.serialize&&Object.defineProperty(P.$,"_serialize",{value:k.opts.serialize})))}return r},handleAjax:function(e){if(e.url&&!e.model)return Lyte.error("Please pass model param to ajax call"),Promise.reject("Please pass model param to ajax call");var r=store.adapter.$.buildURL("ajax",e.type,e.model,e.index,void 0,e.queryParams,void 0,e.customData,e.url);r.data=e.data;var t=r.qP;store.$.initCB("serializer",e.model,"serialize",{args:["ajax",r.data,void 0,e.customData,e.model,t,void 0]});return store.adapter.$.handleRequest(r,e.model,void 0,"ajax",void 0,e.customData,void 0,void 0,void 0,void 0)},handleAction:function(e,r,t,o,a,i,s){var n;t&&Lyte.isRecord(t)&&(n=t.$.get(r._pK));var d=r._name;o=void 0==o?store.$.getFromCB("adapter",r._name,"customData"):o;var l=this.buildURL("action",i||"POST",r._name,n,t,a,e,o);l.data=s,a=l.qP;var c=store.$.initCB("serializer",r._name,"serialize",{args:["action",s,t,o,d,a,e]});return c&&(l.data=c.data),this.handleRequest(l,r._name,void 0,"action",void 0,o,void 0,void 0,e)},handleRequest:function(e,r,t,o,a,i,s,n,d,l){if(e.data&&e.data.LdEr)return Lyte.warn(e.data.LdEr,e.data.key,r),Promise.reject({code:e.data.LyteError,message:Lyte.errorCodes[e.data.LyteError],data:e.data.key});!e.data||"object"!=typeof e.data&&!Lyte.isRecord(e.data)&&!Array.isArray(e.data)||e.data instanceof FormData||(e.data=JSON.stringify(e.data));var c=this;return new Promise(function(a,p){var f=store.$.getFromCB("adapter",r,"processRequest"),y=!0,u=store.$.makeBatch,v=!1;if(f){y=!1;var h,m=c.callGeneric(o,r,e.data,t,i,e?e.qP:void 0,n,e.url,d,e.method,e.headers);m instanceof Promise?(v=!0,m.then(function(n){if("action"==o||"ajax"==o)try{n=JSON.parse(n)}catch(e){n=n}else n=JSON.parse(n);h=c.genericResponse(n,r,o,t,e,void 0,s,i),a(h)},function(e){p(e)})):y=!0}if(u&&!v)store.adapter.$.constructBatch(r,o,n,e).then(function(s){var c=s.content;store.adapter.$.handleSuccess(r,o,void 0,t,e,a,c,s,void 0,p,n,i,d,l)},function(s){store.adapter.$.handleFailure(r,o,void 0,t,e,a,s.content,void 0,p,n,i,s.code,d,s)});else if(y){var $=[r,o,n,e,a,p,"other",t,i];store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(c){store.adapter.$.handleSuccess(r,o,c,t,e,a,void 0,void 0,s,p,n,i,d,l)},function(l){store.adapter.$.handleFailure(r,o,l,t,e,a,void 0,s,p,n,i,void 0,d)})}})},handleSuccess:function(e,r,t,o,a,i,s,n,d,l,c,p,f,y){var u,v,h,m=t?t.responseText:void 0;t&&t.status;if(s)m=s;else if(m&&0!=m.length)if("action"==r)try{s=JSON.parse(m)}catch(e){s=m}else s=JSON.parse(m);else s=JSON.parse("{}");t&&(u=t),n&&(v=n.index,h=n.batch,u=n.resp);var $={customD:p};if(u){var g=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,u,s,a?a.qP:void 0,c,p,void 0,f]});if(g&&(s=g.data)instanceof Promise)return this.handleParseResponsePromise(s,e,r,o,a,t,d,v,h,i,l,$)}return this.otherParseRequestPromise(s,e,r,o,a,t,d,v,h,i,l,p,y,c)},handleFailure:function(e,r,t,o,a,i,s,n,d,l,c,p,f,y){if(t){store.$.cbScp(e,"parseResponse","adapter");var u,v=t.responseText;if(v)try{v=""==v?JSON.parse("{}"):JSON.parse(v)}catch(e){Lyte.warn("LD24",e)}var h=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,t,v,a?a.qP:void 0,l,c,void 0,f]});if(h&&(u=h.data)instanceof Promise)return this.handleParseResponsePromise(u,e,r,o,a,t,n,void 0,void 0,i,d,c)}else if(s){var m,$;y&&($=y.index,m=y.batch),store.$.batchResponse[m][$]={code:p,status:"requestFailure",data:s},d({code:p,status:"requestFailure",data:s})}d(t)},updateIDB:function(e,r,t,o,a,i){t&&!Array.isArray(t)&&(t=[t]);var s=store.model[e],n=store.$.getIDBObj(s,a&&a.qP?a.qP:void 0,r,i,o);if(s&&n&&(!n||n.hasOwnProperty("queryCache"))){var d=store.$.idbQ2[e]=store.$.idbQ2[e]||[],l=n.queryCache;if(t)switch(r){case"update":case"updateRecord":t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;r.$.inIDB&&r.$.inIDB.self&&d.push({type:"updateRecord",model:e,data:r.$.toJSON("idb"),queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o),store.$.addToIDBonSave(e,r)}});break;case"delete":case"deleteRecord":case"destroyRecord":var c=store.modelFor(e)._arrPk;t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;r.$.parent;for(var i={},s=0;s<c.length;s++)i[c[s]]=r[c[s]];r.$.inIDB&&r.$.inIDB.self&&d.push({type:"deleteRecord",model:e,key:i,queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o),store.$.removeOnSave(e,r.$.pK)}});break;case"create":case"createRecord":t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;d.push({type:"createRecord",model:e,data:r.$.toJSON("idb"),queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o,"create"),store.$.addToIDBonSave(e,r)}})}}else t.forEach(function(t,a){t&&Lyte.isRecord(t)&&store.adapter.$.updateRelationsIDB(t,store.model[e].relations,o,r)})},updateRelationsIDB:function(e,r,t,o){switch(o){case"create":case"createRecord":for(var a in r){r[a].forEach(function(r){var o,a=r.relKey,i=r.relatedTo;store.$.idbQ2[i]=store.$.idbQ2[i]||[],e.$.inIDB;(o=r.dummy?store.$.getRelatedRecord(e,r.relatedTo,r.dummy):e[a])&&!Array.isArray(o)&&(o=[o]),o&&o.forEach(function(e){var r=e.$.model,o=store.$.idbQ2[r._name]=store.$.idbQ2[r._name]||[];for(var a in e.$.inIDB.self&&o.push({type:"updateRecord",model:r._name,data:e.$.toJSON("idb"),customData:t}),e.$.inIDB){var i=e.$.inIDB[a],s=store.$.idbQ2[a]=store.$.idbQ2[a]||[];i.forEach(function(e,r){s.push({type:"updateRecord",model:a,data:store.$.peekRecord(a,r).$.toJSON("idb"),customData:t})})}})})}break;default:var i=e.$.inIDB;if(i)for(mKey in i){i[mKey].forEach(function(e,r){var o=store.$.peekRecord(mKey,r);(store.$.idbQ2[mKey]=store.$.idbQ2[mKey]||[]).push({type:"updateRecord",model:mKey,data:o.$.toJSON("idb"),customData:t})})}}},callGeneric:function(e,r,t,o,a,i,s,n,d,l,c){var p=store.$.initCB("adapter",r,"processRequest",{args:[e,r,t,o,a,i,s,n,d,l,c]});return p?p.data:void 0},genericResponse:function(e,r,t,o,a,i,s,n,d){var l,c,p=e,f=(i&&i.status,a?a.qP:void 0);if(l=store.$.cbScp(r,"extractMeta","serializer"))if(p){var y=store.$.cB(l,[p,r,t,f,n]);store.$.isEmpty(y)||(p.meta=y),c=!0}else c=!1;if(p&&"action"!=t&&"ajax"!=t){if(p=store.serializer.$.buildJSON(r,t,p,Lyte.isRecord(o)?o[store.modelFor(r)._pK]:void 0,i?i.status:void 0,a,n,f),0==c&&l&&p){y=store.$.cB(l,[p,r,t,f,n]);store.$.isEmpty(y)||(p.meta=y)}var u=Object.keys(p),v=u.length;if(l=store.$.cbScp(r,"deserializeKey","serializer")){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),v>2&&Lyte.error("LD09");var h=0;"meta"==u[0]&&(h=1);var m=store.$.cB(l,[r,t]),$=p[u[h]];delete p[u[h]],p[m]=$}this.handleResponse(o,p,store.modelFor(r),t,s,void 0,d)}return p},removePartialKeys:function(e,r,t){var o=r.relations,a=e.$.pK;for(var i in o){o[i].forEach(function(t){var o;if(bMod=store.model[t.relatedTo],bMod&&(o=store.$.getBackwardRel(r,t,bMod))&&"hasMany"==o.relType&&o.opts&&o.opts.serialize){var i=t.relKey,s=o.relKey,n=e[i];if(n)if(Array.isArray(n))n.forEach(function(e){var r=e[s];r&&r.partial&&r.partial.get(a)&&r.partial.delete(a)});else if(n[s]){var d=n[s];d&&d.partial&&d.partial.get(a)&&d.partial.delete(a)}}})}},mergeError:function(e,r,t){if(t&&t.$&&t.$.isError){if(t.$.error){var o=t.$.error;for(var a in o)e.fieldList.hasOwnProperty(a)&&store.$.setRecErr(r.$,a,o[a])}return delete t.$.error,delete t.$.isError,!0}},mergeResponse:function(e,r,t,o,a,i){if(this.removePartialKeys(e,r,o),a&&Object.keys(a).length&&this.mergeNewDataKeys(a,e,t,i),!this.mergeError(r,e,t)){var s=store.$.peekRecord(e.$.model._name,e.$.pK),n=!1;e.$.isDeleted&&this.mergeDeletedRec(a,e,i),e.$.isNew&&s&&(n=this.mergeNewRecord(a,e,t,!0,i)),e.$.isModified&&s&&this.mergeModifiedRec(a,e,t,!0,n,i),r.dirty.length&&store.$.deleteFromArray(r.dirty,void 0),a&&Object.keys(a).length&&t&&!n&&t&&(s?(result=store.$.validateAndMerge(r,t,a,!0),result&&result.data?result=result.data:result&&result.type&&Lyte[result.type].apply(Lyte,result.args||[])):result=store.$.insertIntoStore(r._name,t,void 0,void 0,a)),store.adapter.$.removeDirtyStack(e,a)}},removeDirtyStack:function(e,r){if(r&&r._removedAttr&&0!=Object.keys(r._removedAttr).length)for(var t in e.$._attributes)r._removedAttr.hasOwnProperty(t)||delete e.$._attributes[t];else e.$._attributes={};e.$.undoStack=store.$.genUnRedoStack(),e.$.redoStack=store.$.genUnRedoStack(),delete e.$._savedState,store.$.clrRecErr(e.$)},removeBackwardRelDirty:function(e,r){var t=e.$.model,o=t.relations;for(var a in o){o[a].forEach(function(o){var a;e.hasOwnProperty(o.relKey)&&(store.modelFor(o.relatedTo)&&(a=store.$.getBackwardRel(t,o,store.modelFor(o.relatedTo))),a&&a.opts&&a.opts.serialize&&("hasMany"==a.relType?store.adapter.$.removeRelPartial(e[o.relKey],a,r):"belongsTo"==a.relType&&store.adapter.$.removeRelPartial(e[o.relKey],a,r)))})}},removeRelPartial:function(e,r,t){if(Array.isArray(e))e.forEach(function(e){var o=e[r.relKey];o&&("hasMany"==r.relType?o.partial&&(o.partial.delete(t),o.partial.size||store.$.deleteDeepNest(e,r.relKey,t)):store.$.deleteDeepNest(e,r.relKey,t))});else if(Lyte.isRecord(e)){var o=e[r.relKey];o&&("hasMany"==r.relType?o.partial&&(o.partial.delete(t),o.partial.size||store.$.deleteDeepNest(e,r.relKey,t)):store.$.deleteDeepNest(e,r.relKey,t))}},mergeNewRecord:function(e,r,t,o,a){var i,s=e.$?e.$.model:r.$.model._name,n=store.model[s],d=n._arrPk,l=r.$.pK,c=store.$.peekRecord(s,l),p=e.$?e.$.record:void 0;if(!Lyte.isRecord(p)||p===c){if(c){var f="object"==typeof l?l:l.toString(),y=!1;if(!0!==a){d.forEach(function(e){t&&t.hasOwnProperty(e)?(store.$.cmpSet(r,e,t[e],void 0,!0),y=!0):Lyte.error("LD16",s,Lyte.isRecord(r)?"object"==typeof r.$.pK?JSON.stringify(r.$.pK):r.$.pK:void 0)});var u=store.$.getpKVal(r);store.$.cmpSet(r.$,"pK",store.$.getpKVal(r));var v="object"==typeof u?u:u.toString();n.data._recMap&&(n.data._recMap.delete(f),n.data._recMap.set(v,r)),store.$.changeRelPkMaps(r,f,v),store.$.updateNestScp(r,l)}if(y&&e&&e.$&&(e.$.processed=!0),o&&!0!==a&&((i=store.$.validateAndMerge(n,t,e,!0))&&i.data?i=i.data:i&&i.type&&Lyte[i.type].apply(Lyte,i.args||[])),store.$.cmpSet(r.$,"isNew",!1),e.hasOwnProperty("_removedAttr")&&0!=Object.keys(e._removedAttr).length)return i;store.$.cmpSet(r.$,"isModified",!1),store.$.changePersist(r,!0),store.$.deleteFromArray(n.dirty,l),store.adapter.$.removeBackwardRelDirty(r,l),(!r.$.dN||r.$.dN&&0==Object.keys(r.$.dN).length)&&store.$.removeParentNesting(r)}return i}},mergeModifiedRec:function(e,r,t,o,a,i){var s,n=n||r.$.pK;return r.$.isDeleted||!t||a||!0===i||(t&&o&&((s=store.$.validateAndMerge(r.$.model,t,e,!0))&&s.data?s=s.data:s&&s.type&&Lyte[s.type].apply(Lyte,s.args||[])),a=!0),e&&e.hasOwnProperty("_removedAttr")&&Object.keys(e._removedAttr).length?s:(store.$.cmpSet(r.$,"isModified",!1),store.$.changePersist(r,!0),store.$.deleteFromArray(r.$.model.dirty,r.$.pK),store.adapter.$.removeBackwardRelDirty(r,r.$.pK),(!r.$.dN||r.$.dN&&0==Object.keys(r.$.dN).length)&&store.$.removeParentNesting(r),s)},mergeDeletedRec:function(e,r){var t,o,a;e?(t=e.$.model,o=e.$.pkVal):r&&(t=r.$.model._name,o=r.$.pK);var i=(u=(a=store.model[t])._deleted.get(o))?u.data:void 0,s=store.$.peekRecord(t,o);if(i){store.$.cmpSet(i.$,"isDeleted",!1),store.$.cmpSet(i.$,"isUnloaded",!0),store.$.cmpSet(i.$,"isPersisted",!0);var n=i.$.__scpObj;for(var d in n){var l=n[d].split("_"),c=Lyte.nestScp[l[0]];c&&Lyte.removeNestScp(c._data,l[0],l[1],void 0,i,void 0,void 0,{model:t,pK:o,attr:d})}a._deleted.delete(o),store.$.removeParentNesting(i)}if(s)store.$.removeFromStore(a,o,!0,void 0,void 0,!0),store.$.removeParentNesting(s);else{var p=store.model.cachedQueries;if(p){var f=p[t];if(f&&f.length)for(var y=f.length-1;y>=0;y--){var u;if((u=f[y]).hasDeletedRecords)if(u.data)-1!==u.data[t].indexOf(i)&&f.splice(y,1)}}}e&&e.$&&e.$.parent&&(e.$.parent.$.partial={}),e&&e.$&&(e.$.processed=!0)},mergePartialObj:function(e,r,t,o,a){var i,s=store.$.peekRecord(e.$.model,e.$.pkVal),n=(r=r||s,!!s);if(!(e&&e.$&&e.$.processed||this.mergeError(store.model[e.$.model],r,t)))if("removed"!=e.$.type){if(("added"==e.$.type||r&&r.$&&1==r.$.isNew)&&n?i=this.mergeNewRecord(e,r,t,o,a):("modified"==e.$.type||"related"==e.$.type||r&&r.$&&1==r.$.isModified)&&n&&this.mergeModifiedRec(e,r,t,o,i,a),n){if("removed"!=e.$.type)for(var d in e){var l=e[d];this.mergeNewDataKeys(l,r[d],t?t[d]:void 0,a)}r.$.partial&&Object.keys(r.$.partial)&&(r.$.partial=new Map),store.adapter.$.removeDirtyStack(r,e)}}else this.mergeDeletedRec(e,r,a)},mergeNewDataKeys:function(e,r,t,o){if(e&&(r&&r.partial&&r.partial.size||1==e.partial)){var a=this;if(Array.isArray(e)){var i=!!e.replace&&e.replace;if(e.forEach(function(e,s){if(e.$){var n=store.model[e.$.model]._pK,d=store.$.getIndex(r,n,e.$.pkVal);!0===e.$.onlyDetach?(r.record&&r.key&&store.$.deleteDeepNest(r.record,r.key,e.$.pkVal),store.$.handleArrOp(r,"removeAt",void 0,d,1)):(i&&e.$.record&&e.$.record.$.isNew?i=!0:a.mergeNewDataKeys(e,-1!=d?r[d]:void 0,t?t[s]:void 0,o),r.partial&&r.partial.delete(e.$.pkVal)),(!e._removedAttr||e._removedAttr&&Object.keys(e._removedAttr).length)&&r.partial&&r.partial.delete(e.$.pkVal)}}),Array.isArray(r)&&r.partial&&r.partial.size&&r.record&&r.key&&r.record.$.model){var s=r.record.$.model.fieldList[r.key],n=[];s.opts&&/^(id|record)$/.test(s.opts.serialize)&&(r.partial.forEach(function(e,r){"removed"==e.type&&n.push(r)}),n.forEach(function(e){var t=store.$.peekRecord(r.model._name,e)||store.$.peekRecord(r.model._name,e,!0);r.partial.delete(e),t&&store.$.removeParentNesting(t)}))}}}else if(e&&e.$&&e.$.type)if(e.$.onlyDetach){var d=e.$.parent;if(d&&d.$.partial&&d.$.partial[e.$.relKey]&&d.$.partial[e.$.relKey].has(e.$.pkVal)&&"removed"==d.$.partial[e.$.relKey].get(e.$.pkVal).type){var l=store.$.peekRecord(e.$.model,e.$.pkVal)||store.$.peekRecord(e.$.model,e.$.pkVal,!0);d.$.partial[e.$.relKey].delete(e.$.pkVal),d.$.partial[e.$.relKey].size||(delete d.$.partial[e.$.relKey],Object.keys(d.$.partial).length||delete d.$.partial),l&&store.$.removeParentNesting(l)}}else this.mergePartialObj(e,r,t,void 0,o);else if(Array.isArray(e)){a=this;e.forEach(function(e,i){a.mergeNewDataKeys(e,r[i],t?t[i]:void 0,o)})}else if("object"==typeof e)for(var c in e){e[c];this.mergeNewDataKeys(e[c],r[c],t?t[c]:void 0,o)}},handleResponse:function(e,r,t,o,a,i,s){var n,d,l,c=t._pK;if(r=r[t._name],Array.isArray(e))for(var p=0;p<e.length;p++)l=(d=e[p]).$.pK,n=a&&d&&l?a.get(l):void 0,this.mergeResponse(e[p],t,Array.isArray(r)?r[p]:r,c,n);else l=e.$.pK,n=a&&e&&l?a.get(l):void 0,this.mergeResponse(e,t,r,c,n)},compareData:function(e,r,t){if(!store.$.isEmpty(e)&&!store.$.isEmpty(r)){var o=typeof e;if(o!==typeof r)return!1;switch(o){case"string":case"number":case"boolean":if(e===r)return!0;break;case"object":return this.compareObjects(e,r,t)}}return!1},compareObjects:function(e,r,t){if(!(e instanceof Object&&r instanceof Object))return!1;if(Object.keys(e).length!=Object.keys(r).length)return!1;for(var o in e){var a=e[o],i=r[o];if(t&&Array.isArray(a)&&Array.isArray(i)){if(a.length!=i.length)return!1;for(var s=a.length,n=0;n<s;n++){if(!store.adapter.$.compareData(a[n],i[n],t))return!1}}else if(void 0===i||!store.adapter.$.compareData(a,i,t))return!1}return!0},handleBatchPromise:function(e){var r=e.response,t=e.batch;if(e.fail){store.$.batchPromise[t].forEach(function(e,r){e.reject({content:{},index:r,batch:t,code:"400",resp:{}})})}else{var o=store.$.initCB("serializer","application","normalizeResponse",{args:[void 0,"batch",e.response]});o&&(r=o.data),r.batch_requests.forEach(function(e,r){var o=store.$.batchPromise[t][r],a=e.status.toString(),i=a[0];"2"==i?o.resolve({content:e.content,index:r,batch:t,resp:e}):"4"!=i&&"5"!=i||(store.$.batchResponse[t][r]=void 0,o.reject({content:e.content,index:r,batch:t,resp:e,code:a}))})}delete store.$.batch[t],delete store.$.batchPromise[t]},handleParseResponsePromise:function(e,r,t,o,a,i,s,n,d,l,c,p){e.then(function(e){"findRecord"==t||"findAll"==t?store.adapter.$.findParseRequestPromise(e,r,t,o,a,i,n,d,l,p):store.adapter.$.otherParseRequestPromise(e,r,t,o,a,i,s,n,d,l,c,p?p.customD:void 0,void 0,o)},function(e){c(i)})},findParseRequestPromise:function(e,r,t,o,a,i,s,n,d,l){var c=Object.assign({},l);delete c.customD;var p=this.getResponse(e,r,t,o,a,i,l?l.customD:void 0,c);d(i?[p,i.statusText,i]:void 0!=s?[p,"batch",{index:s,batch:n}]:[p])},otherParseRequestPromise:function(e,r,t,o,a,i,s,n,d,l,c,p,f,y){var u=this.genericResponse(e,r,t,o,a,i,s,p,f);void 0!=n&&(store.$.batchResponse[d][n]=u),"action"!=t&&"ajax"!=t&&this.updateIDB(r,t,o,p,a,y),l(u)}}},store.$.defProp(store.adapter,"extends",function(e,r,t){return store.$.scExtd("adapter",e,r,t)},!1),Lyte.$.requiredMixins.serializer=Lyte.$.requiredMixins.adapter=function(e,r,t){Object.keys(e).length&&r.forEach(function(r,o){var a=r.scope,i=r.name,s=a[t][i];if(s)for(var n in e)s[n]=e[n]})},Lyte.$.injectServices&&(Lyte.$.injectServices.adapter=Lyte.$.injectServices.serializer=function(e,r,t,o,a,i){var s=store[t],n={};for(var d in n.as=e,n.service=r,s){var l=s[d];store.$.extendService([n],t,d,l,store,!0,i)}}),store.$.cbDef(Serializer,"serializer"),store.serializer={$:{buildJSON:function(e,r,t,o,a,i,s,n){var d=i?i.headers:void 0,l=t,c=store.$.initCB("serializer",e,"normalizeResponse",{args:[e,r,l,o,a,d,i?i.qP:void 0,s,void 0,i?i.gqlObj:void 0]});c&&(l=c.data);var p,f=/^(findRecord|findAll)$/.test(r);if(!f&&l&&"object"==typeof l&&(c=store.$.initCB("serializer",e,"payloadKey",{args:[e,r,void 0,n,s]}))){var y=c.data;if(y&&y!=e){var u=l[y];l[e]=u,delete l[y]}}if(f||l&&l[e]){if(p=l[e],!0,scope=store.$.cbScp(e,"normalize","serializer"),scope)if(Array.isArray(p))for(var v=0;v<p.length;v++)p[v]=store.$.cB(scope,[e,r,p[v],s]);else p=store.$.cB(scope,[e,r,p,s]);var h="pushPayload"!=r?{url:i.url,method:i.method,headers:i.headers,type:r,qP:i.qP,withCredentials:i.withCredentials,model:e}:void 0;p=store.adapter.$.serializeRecords(e,p,void 0,h,"normalizeRecord",s),l[e]=p}return l},normalizeResponse:function(e,r,t,o,a,i,s,n){var d=i?i.headers:void 0,l=t,c=store.$.initCB("serializer",e,"normalizeResponse",{args:[e,r,l,o,a,d,i?i.qP:void 0,s,n,i?i.gqlObj:void 0]});return c&&(l=c.data),l},normalize:function(e,r,t,o,a,i,s,n,d){var l=t,c=!1;(/^(findRecord|findAll)$/.test(r)||l[e])&&(l=l[e],c=!0);var p=store.$.cbScp(e,"normalize","serializer");if(p&&l)if(Array.isArray(l))for(var f=0;f<l.length;f++)l[f]=store.$.cB(p,[e,r,l[f],s,n]);else l=store.$.cB(p,[e,r,l,s,n]);c&&l&&(l=store.adapter.$.serializeRecords(e,l,void 0,{url:d.url,method:d.method,headers:d.headers,type:r,qP:d.qP,withCredentials:d.withCredentials,model:e},"normalizeRecord",s),t[e]=l)}}},store.$.defProp(store.serializer,"extends",function(e,r,t){return store.$.scExtd("serializer",e,r,t)}),Object.defineProperties(store,{modelless:{value:{}},registerModel:{get:()=>(Lyte._preRegister(),store.$.registerModel)},ajax:{value:function(e){if(!e.model)return Promise.reject("Model name is mandatory for ajax method");if(1!=store.$.getFromCB("adapter",e.model,"modelless"))return Promise.reject("Modelless behaviour is not enabled. Please enable it to make ajax call for models that are not defined");if(!e.type)return Promise.reject(e.type+" is not a valid HTTP method");var r="string"==typeof e.model?this.model[e.model]:void 0;return r&&r.fieldList?Promise.reject(e.model+" is a defined model. ajax is supported only for a model which is not defined"):store.adapter.$.handleAjax(e)}},triggerUpdate:{value:function(e,r,t,o,a,i){var s,n=[],d=[];if(void 0==(p=store.modelFor(e)))return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});s=Array.isArray(r)?r:[r];for(var l=0;l<s.length;l++){var c=store.$.peekRecord(e,s[l]);if(!c)return Promise.reject("No such record found");var p,f={},y=(p=c.$.model)._arrPk;(t||Object.keys(p.fieldList)).forEach(function(e){f[e]=c[e]}),y.forEach(function(e){f[e]=c[e]}),n.push(f),d.push(c)}var u=!1;return Array.isArray(r)||(n=n[0],d=d[0],u=!0),store.adapter.$.put(e,n,d,u,a,o,i)}},batch:{value:function(e){return new Promise(function(r,t){store.$.makeBatch=!0,store.$.batch=store.$.batch||{},store.$.batchPromise=store.$.batchPromise||{};var o,a,i=void 0===store.$.currentBatch?Object.keys(store.$.batch).length:store.$.currentBatch+1,s=store.$.currentBatch=i;e&&"function"==typeof e?o=e:e&&"object"==typeof e&&(o=e.method,a=e.customData);try{o()}catch(e){throw store.$.makeBatch=!1,e}store.$.makeBatch=!1;var n={batch:store.$.batch[s]},d=store.adapter.$.buildURL("batch","POST","application",void 0,n,void 0,void 0,a),l=n.batch;if(store.$.isEmpty(l)){if(store.$.cachedBatch&&store.$.cachedBatch[s]&&store.$.cachedBatch[s].length){var c=store.$.handleCachedResponse(s,[]);return r(c)}return r()}var p=store.$.initCB("serializer","application","serialize",{args:["batch",n,void 0,a]});p&&(n=p.data);var f=new XMLHttpRequest;for(var y in f.open("POST",d.url,!0),d.headers)f.setRequestHeader(y,d.headers[y]);f.withCredentials=!!d.withCredentials,f.send(JSON.stringify(n)),f.onreadystatechange=function(){if(4==f.readyState)if("2"==f.status.toString()[0]||"3"==f.status.toString()[0]){var e=JSON.parse(f.responseText);store.$.batchResponse=store.$.batchResponse||{},store.$.batchResponse[s]=[],store.adapter.$.handleBatchPromise({response:e,batch:s,resolve:r}),setTimeout(function(){var e=store.$.handleCachedResponse(s,store.$.batchResponse[s]);r(e),store.$.batchResponse[s]=[]},0)}else store.$.batchResponse[s]=[],store.adapter.$.handleBatchPromise({batch:s,resolve:r,fail:!0}),setTimeout(function(){var e=store.$.handleCachedResponse(s,store.$.batchResponse[s]);t(e)},0)}})}},pushPayload:{value:function(e,r,t,o,a){var i=store.modelFor(e);if(i=store.$.getFromCB("adapter",e,"modelless")?e:i){var s,n=r;if(t){r=store.serializer.$.buildJSON(e,"pushPayload",r);var d=store.$.cbScp(e,"deserializeKey","serializer");if(s=r?Object.keys(r).length:void 0,d){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),s>2&&Lyte.error("LD09");var l=Object.keys(r),c=0;2==l.length&&"meta"==l[0]&&(c=1);var p=store.$.cB(d,[e,"pushPayload"]),f=r[l[c]];delete r[l[c]],r[p]=f}n=r[e]}var y=(r=store.$.insertIntoStore(e,n,!0,void 0,void 0,c,!0,void 0,o,a))||[];Array.isArray(y)||(y=[y]);var u=i&&i.hasOwnProperty("idb");return window.LyteIDB&&y.forEach(function(r){Lyte.isRecord(r)&&(u&&store.$.idbQ2Push(e,r,void 0,"pushPayload"),r.$.isError||r.$.inIDB&&Object.keys(r.$.inIDB).length&&store.adapter.$.updateRelationsIDB(r,r.$.model.relations))}),i&&delete i.rel,r&&Lyte.getConfig("mutable")?Lyte.mut(r):r}Lyte.warn("LD02","Model",e)}},unregisterModel:{value:function(e,r){r=!1!==r,Array.isArray(e)?e.forEach(function(e){store.$.unregisterModel(e,r)}):store.$.unregisterModel(e,r)}},unregisterAdapter:{value:function(e){Array.isArray(e)?e.forEach(function(e){store.$.unRegCb("adapter",e)}):store.$.unRegCb("adapter",e)}},unregisterSerializer:{value:function(e){Array.isArray(e)?e.forEach(function(e){store.$.unRegCb("serializer",e)}):store.$.unRegCb("serializer",e)}},addField:{value:function(e,r,t,o,a,i){var s,n=store.modelFor(e),d=[];if(n.fieldList.hasOwnProperty(r)&&"relation"==n.fieldList[r].type){var l=n.fieldList[r],c=n.relations[l.relatedTo];if(Array.isArray(c)){var p=c.indexOf(l);c.splice(p,1)}"hasMany"==l.relType&&delete n._fldGrps.hasMany[r]}if(t&&"object"==typeof t){store.$.registerField(n,r,t,d),s="relation"==t.type?"relation":"attr";i=arguments[4],a=void 0===a?arguments[3]:a}else{var f=Lyte.attr(t,o);store.$.registerField(n,r,f,d)}"relation"!=s&&(a&&!i||store.$.updateFieldValidation(n,r,i,a))}},modelFor:{value:function(e){return store.model[e]}},createRecord:{value:function(e,r,t){var o=this.$.newRecord(e,r,t);return o&&Lyte.getConfig("mutable")?Lyte.mut(o):o}},deleteRecord:{value:function(e,r){this.$.removeFromStore(store.modelFor(e),r,void 0)}},findAll:{value:function(e,r,t,o,a,i,s,n){return store.adapter.$.get("findAll",e,void 0,r,t,a,o,i,s).then(function(){var i,s,d,l=arguments,c=l[0][0],p=l[0][2],f=p?p.status:l[0][3],y="cache"==l[0][1],u="batch"==l[0][1]?l[0][2]:void 0,v="idb"==l[0][1],h=store.$.getFromCB("adapter",e,"modelless");if(i=store.model[e],s=t&&!0!==t?t:!0===t&&r&&"object"==typeof r&&Object.keys(r).length?r:void 0,i||void 0!=o?h&&!i&&1==o&&(d=!0):o=!1,void 0!==o&&"object"==typeof o&&null!==o&&(o=!o.hasOwnProperty("cache")||o.cache),!1===o)return!y&&s&&store.$.cacheQuery(e,s,c,f),void 0!=u&&(store.$.batchResponse[u.batch][u.index]=c),c;if(c&&!c.save){if(!y){if(!c||!c.hasOwnProperty(e))return void Lyte.error("LD13","findAll",e,r&&"object"==typeof r?",queryParams-"+JSON.stringify(r):"");var m=c[e];if(void 0===m||null===m||store.$.isEmptyArray(m))c[e]=[];else{Array.isArray(m)||Lyte.warn("LD19");var $=d&&void 0!=n?n:d?"id":void 0,g=store.$.toInsertData(e,c,!0,$),b=g;g&&!Array.isArray(g)&&(b=[g]),window.LyteIDB&&!v&&(b&&!b.$||g&&g.$&&!g.$.isError)&&(i&&i.hasOwnProperty("idb")&&store.$.idbQ2Push(e,b,r,"findAll",void 0,void 0,a),b.forEach(function(e){e&&e.$&&e.$.inIDB&&Object.keys(e.$.inIDB).length&&store.adapter.$.updateRelationsIDB(e,e.$.model.relations)})),window.LyteIDB&&v&&b&&Array.isArray(b)&&b.forEach(function(e){LyteIDB.changeIDBState(e)}),c[e]=g}c.hasOwnProperty("meta")&&(c[e].$||store.$.defProp(c[e],"$",{}),c[e].$.meta=c.meta),s&&store.$.cacheQuery(e,s,c)}return void 0!=u&&(store.$.batchResponse[u.batch][u.index]=c[e]),Lyte.getConfig("mutable")?Lyte.mut(c[e]):c[e]}return arguments},function(e){return Promise.reject(e)})}},findRecord:{value:function(e,r,t,o,a,i,s,n,d){return void 0==r?Promise.reject({code:"ERR20",message:Lyte.errorCodes.ERR20}):store.adapter.$.get("findRecord",e,r,t,o,i,a,s,n).then(function(){var s,n=arguments[0][0],l="cache"==arguments[0][1],c=arguments[0][2],p=c?c.status:arguments[0][3],f="batch"==arguments[0][1]?arguments[0][2]:void 0,y="idb"==arguments[0][1],u=store.model[e],v=o&&!0!==o?o:!0===o&&t&&"object"==typeof t&&Object.keys(t).length?t:void 0,h=store.$.getFromCB("adapter",e,"modelless");if(u||void 0!=a?h&&!u&&1==a&&(s=!0):a=!1,void 0!==a&&"object"==typeof a&&null!==a&&(a=!a.hasOwnProperty("cache")||a.cache),!1===a)return!l&&v&&store.$.cacheRecordQuery(e,r,v,n,p),void 0!=f&&(store.$.batchResponse[f.batch][f.index]=n),n;if(n){if(!l){var m;if(!n||!n.hasOwnProperty(e))return void Lyte.error("LD13","findRecord",e,",key-"+("object"==typeof r?JSON.stringify(r):r)+(t&&"object"==typeof t?", queryParams-"+JSON.stringify(t):""));if(!Lyte.isRecord(n)){var $=n[e];if((store.$.isEmpty($)||store.$.isEmptyObj($))&&(n[e]={},m=!0),("object"!=typeof $||Array.isArray($))&&Lyte.warn("LD11"),!m){var g,b=s&&void 0!=d?d:s?"id":void 0,_=store.$.insertIntoStore(e,$,!0,!0,void 0,void 0,void 0,void 0,b);window.LyteIDB&&!y&&Lyte.isRecord(_)&&!_.$.isError&&(Array.isArray(_)||(g=[_]),u&&u.hasOwnProperty("idb")&&store.$.idbQ2Push(e,g,t,"findRecord",r,n&&n.meta?n.meta:void 0,i),g.forEach(function(e){e&&e.$&&e.$.inIDB&&Object.keys(e.$.inIDB).length&&store.adapter.$.updateRelationsIDB(e,e.$.model.relations)})),window.LyteIDB&&y&&g&&Array.isArray(g)&&g.forEach(function(e){LyteIDB.changeIDBState(e)}),n[e]=_}n.hasOwnProperty("meta")&&(Lyte.isRecord(_)?_.$.meta=n.meta:(($=n[e]).$||store.$.defProp($,"$",{}),$.$.meta=n.meta))}!l&&v&&store.$.cacheRecordQuery(e,r,v,n)}return void 0!=f&&(store.$.batchResponse[f.batch][f.index]=n[e]),Lyte.getConfig("mutable")?Lyte.mut(n[e]):n[e]}return arguments},function(e){return Promise.reject(e)})}},peekRecord:{value:function(e,r,t){return store.$.peekRecord(e,r,t,!0)}},peekAll:{value:function(e){var r=this.modelFor(e),t=store.$.getFromCB("adapter",e,"modelless");if(r=t?e:r){if(1!=t||!r||(r=store.modelless[r]))return arr=r.data,t?arr:Lyte.getConfig("mutable")?Lyte.mut(arr):arr}else Lyte.warn("LD02","Model ",e)}},deleteMany:{value:function(e,r){this.$.removeFromStore(store.modelFor(e),r,void 0)}},unloadRecord:{value:function(e,r,t,o){var a,i=this.modelFor(e),s=store.$.getFromCB("adapter",e,"modelless");if(i=s?e:i){if(1==s&&i){if(!(i=store.modelless[i]))return;a=!0}void 0==r&&Lyte.warn("LD18","key");var n,d=store.$.peekRecord(e,r);if(1==a)-1!=(v=store.$.getInd(i.data,i._pK,r))&&store.$.handleArrOp(i.data,"removeAt",void 0,v,1);else if(d){var l=i._fldGrps.inherit&&Object.keys(i._fldGrps.inherit).length;if(t=!1!==t,n=d.$.pK,t&&l){var c=new Map;store.$.removeChildRecords(i,d,c,!0)}else this.$.removeFromStore(i,n,!0,!0,void 0,void 0,!0,o);i._deleted.delete(r);var p=this.model.cachedRecordQueries;p&&p[e]&&p[e][r]&&(p[e][r]=[]);var f=store.model.cachedQueries;if(f){var y=f[e];if(y&&y.length)for(var u=y.length-1;u>=0;u--){var v,h=y[u];if(h&&h.data)-1!=(v=h.data[e].indexOf(d))&&y.splice(u,1)}}}}else Lyte.warn("LD02","Model ",e)}},unloadAll:{value:function(e,r,t,o){var a,i=this.modelFor(e),s=store.$.getFromCB("adapter",e,"modelless");if(i=s?e:i){if(1==s&&i){if(!(i=store.modelless[i]))return;a=!0}var n=[],d=r||store.peekAll(e);if(1==a)store.$.handleArrOp(i.data,"removeAt",void 0,0,i.data.length);else{if(d)for(var l=0;l<d.length;l++)n.push(d[l].$.pK);var c=i._fldGrps.inherit&&Object.keys(i._fldGrps.inherit).length;if((t=!1!==t)&&c)for(l=n.length-1;l>=0;l--){var p=d[l],f=new Map;store.$.removeChildRecords(i,p,f,!0)}else this.$.removeFromStore(i,n,!0,!0,void 0,void 0,!0,o);this.model[e].dirty=[],this.model[e]._deleted=new Map;var y=store.model.cachedQueries;y&&y[e]&&(y[e]=[]);var u=this.model.cachedRecordQueries;u&&u[e]&&(u[e]=[])}}else Lyte.warn("LD02","Model ",e)}},triggerAction:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);return void 0==s?(Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e})):(s.actions?s.actions[r]:void 0)?store.adapter.$.handleAction(r,s,store.peekAll(e),t,o,a,i).then(function(e){return e},function(e){return Promise.reject(e)}):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18})}},rollBack:{value:function(e){var r=this.modelFor(e);r.relations;if(void 0!=r){for(var t=r._pK,o=Array.from(r.dirty),a=o.length,i=0;i<a;i++){var s=this.peekRecord(e,o[i]);s&&s.$.isDeleted||(s&&s.$.isNew?this.$.rollBackNew(r,s,t):s&&s.$.isModified&&s.$.rollBackAttributes(s.$.getDirtyAttributes()))}this.$.rollBackDelete(r,void 0,!0)}else Lyte.warn("LD02","Model",e)}},create:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);if(void 0==s)return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});if(Array.isArray(r)){var n=this;r.forEach(function(r){var t=n.$.newRecord(e,r);if(t.$.isError)return Promise.reject(t)})}else if(r&&"object"==typeof r){var d=this.$.newRecord(e,r);if(d.$.isError)return Promise.reject(d)}for(var l,c=s.dirty,p=c.length,f=[],y=0;y<p;y++){var u=store.peekRecord(e,c[y]);if(u&&u.$.isNew){if(a&&-1==a.indexOf(u))continue;if(l=new error1,store.$.validateRecord(u,s.fieldList),u.$.isError&&Object.keys(u.$.error).length>0)return Promise.reject(l);f.push(u.$.record)}}return f.length?store.adapter.$.create(e,f,!1,t,o,i):Promise.resolve()}},update:{value:function(e,r,t,o,a){if(void 0==(i=this.modelFor(e)))return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});var i,s=[],n=[],d=o||store.peekAll(e),l=(i=store.model[e]).relations;return d.forEach(function(r){if(Lyte.isRecord(r)&&r.$.model._name==e){var t=r,o=store.$.isDirty(t,l);if(t&&!t.$.isNew&&!t.$.isDeleted&&(t.$.isModified||o&&o.length)){var a=store.$.updateJSON(t,i,o);s.push(a),n.push(t.$.record)}}}),s.length?store.adapter.$.put(e,s,n,!1,r,t,a):Promise.resolve()}},delete:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);if(void 0==s)return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});r&&this.deleteRecord(e,r);var n=[];if(s._deleted.forEach(function(e,r){n.push(e.data)}),a){var d=[];a.forEach(function(e){-1!=n.indexOf(e.$.record)&&d.push(e.$.record)}),n=d}return n.length?store.adapter.$.del(e,n,void 0,"delete",t,o,i).then(function(e){return e},function(e){return Promise.reject(e)}):Promise.resolve()}},registerAdapter:{value:store.adapter.extends},registerSerializer:{value:store.serializer.extends},clearCachedQuery:{value:function(e,r,t){var o,a;!(!e||"object"!=typeof e)?(e=(a=e).modelName,r=a.key,o=t=a.cacheQuery):r&&"object"==typeof r?(o=r,r=void 0):t&&"object"==typeof t&&(o=t);var i=[];if(o){if(o){if(void 0==r)(n=this.model.cachedQueries)&&n[e]&&(i=n[e]);else(d=this.model.cachedRecordQueries)&&d[e]&&d[e][r]&&(i=d[e][r]);for(var s=0;s<i.length;s++)if(this.adapter.$.compareData(i[s].cacheQuery,o,!0)){i.splice(s,1);break}}}else if(e){var n=this.model.cachedQueries,d=this.model.cachedRecordQueries;n&&n.hasOwnProperty(e)&&delete n[e],d&&d.hasOwnProperty(e)&&(r?delete d[e][r]:delete d[e])}else this.model.cachedQueries=[],this.model.cachedRecordQueries={}}},getErrorMessage:{value:function(e){return Lyte.errorCodes[e]}},setErrorMessages:{value:function(e){Object.assign(Lyte.errorCodes,e)}},addEventListener:{value:function(e,r){return store.$.eventListeners.add(store,e,r)}},removeEventListener:{value:function(e){store.$.eventListeners.remove(store,e)}},emit:{value:function(e,r){store.$.eventListeners.emit(store,e,r)}},getPrimaryKey:{value:function(e){var r=store.model[e];if(r)return r._pK;Lyte.warn("LD02","Model ",e)}},getDirtyRecords:{value:function(e,r,t){var o=store.modelFor(e);if(o){for(var a=o.dirty,i=[],s={isNew:[],isModified:[],isDeleted:[]},n=0;n<a.length;n++){var d=store.$.peekRecord(e,a[n]);d&&(d.$.isNew?s.isNew.push(d):s.isModified.push(d))}if(o._deleted.size)o._deleted.forEach(function(e){s.isDeleted.push(e.data)});if((o.dirty||o._deleted.size)&&(void 0!=r&&1!=r||(i=i.concat(s.isNew,s.isModified,s.isDeleted)),Array.isArray(r)&&r.forEach(function(e){i=i.concat(s[e])}),"string"==typeof r&&(i=s[r])),t)store.peekAll(e).forEach(function(e){!e||e.$.isNew||e.$.isDeleted||!e.$.isDirty()||i.includes(e)||i.push(e)});return i}Lyte.warn("LD02","Model ",e)}}});var error1=function(e,r,t){Object.defineProperties(this,{$:{value:{isError:!0,error:t||{}}}}),e&&store.$.setError(this,e,r)}; 
 Lyte.developmentVariables =  { production :undefined}